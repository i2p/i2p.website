{{ define "main" }}

<section class="papers-hero">
    <div class="container">
        <h1>{{ .Title }}</h1>
        <p class="papers-description">{{ .Description }}</p>

        <!-- Filter Controls -->
        <div class="papers-controls">
            <div class="filter-controls">
                <label for="year-filter">{{ i18n "papers.filterByYear" }}</label>
                <select id="year-filter">
                    <option value="all">{{ i18n "papers.allYears" }}</option>
                </select>

                <button id="sort-toggle" class="sort-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M12 5v14M5 12l7-7 7 7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span id="sort-label">{{ i18n "papers.newestFirst" }}</span>
                </button>
            </div>
        </div>

        <p class="papers-count" id="papers-count"></p>
    </div>
</section>

<section class="papers-content">
    <div class="container">
        <div id="papers-list" class="papers-list">
            {{ .Content }}
        </div>

        <div id="no-results" class="no-results" style="display: none;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="11" cy="11" r="8" stroke-width="2"/>
                <path d="m21 21-4.35-4.35" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <p>{{ i18n "papers.noResultsFound" }}</p>
        </div>
    </div>
</section>

<section class="papers-footer">
    <div class="container">
        <p><strong>{{ i18n "papers.submitEntries" }}</strong> {{ i18n "papers.submitEmail" }} <a href="mailto:research@i2p.net">research@i2p.net</a>, {{ i18n "papers.preferBibtex" }}</p>
        <p class="text-muted">{{ i18n "papers.bibSource" }} <a href="https://freehaven.net/anonbib/" target="_blank">{{ i18n "papers.freeHavenBib" }}</a>.</p>
    </div>
</section>

<style>
.papers-hero {
    background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
    color: white;
    padding: var(--spacing-xl) 0 var(--spacing-lg);
}

[data-theme="dark"] .papers-hero {
    background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
}

.papers-hero h1 {
    font-size: 2rem;
    margin-bottom: var(--spacing-sm);
    color: white;
}

.papers-description {
    font-size: 1rem;
    margin-bottom: var(--spacing-lg);
    opacity: 0.95;
}

.papers-controls {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: flex-start;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
    flex-wrap: wrap;
}

.filter-controls {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.filter-controls label {
    font-weight: 600;
}

.filter-controls select {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-md);
    background: rgba(255, 255, 255, 0.95);
    color: #1f2937;
    font-size: 0.9375rem;
    cursor: pointer;
}

.filter-controls select:focus {
    outline: none;
    border-color: white;
}

.sort-btn {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-sm) var(--spacing-md);
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-md);
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.sort-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    border-color: white;
}

.sort-btn svg {
    transition: transform var(--transition-fast);
}

.sort-btn.reversed svg {
    transform: rotate(180deg);
}

.papers-count {
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.9375rem;
    margin: 0;
}

.papers-content {
    padding: var(--spacing-xl) 0;
    min-height: 400px;
}

.papers-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}

.paper-year {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-primary);
    margin: var(--spacing-xl) 0 var(--spacing-sm);
    padding-bottom: var(--spacing-xs);
    border-bottom: 2px solid var(--color-primary);
}

.paper-year:first-child {
    margin-top: 0;
}

.paper-entry {
    padding: var(--spacing-md);
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
}

.paper-entry:hover {
    border-color: var(--color-primary);
    box-shadow: var(--shadow-md);
}

.paper-title {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
    line-height: 1.3;
}

.paper-title a {
    color: var(--color-text);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.paper-title a:hover {
    color: var(--color-primary);
}

.paper-title .no-link {
    color: var(--color-text);
    cursor: default;
}

.paper-authors {
    color: var(--color-text-secondary);
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
}

.paper-venue {
    color: var(--color-text-muted);
    font-size: 0.8125rem;
    font-style: italic;
    margin-bottom: var(--spacing-sm);
}

.paper-actions {
    display: flex;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
}

.paper-link {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-xs) var(--spacing-md);
    background: var(--color-primary);
    color: white;
    text-decoration: none;
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-weight: 600;
    transition: all var(--transition-fast);
}

.paper-link:hover {
    background: var(--color-primary-dark);
    transform: translateY(-1px);
}

.bibtex-toggle {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-xs) var(--spacing-md);
    background: var(--color-bg-secondary);
    color: var(--color-text);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.bibtex-toggle:hover {
    background: var(--color-bg-tertiary);
    border-color: var(--color-primary);
}

.bibtex-wrapper {
    display: contents;
}

.bibtex-content {
    width: 100%;
    margin-top: var(--spacing-sm);
    padding: var(--spacing-sm);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    font-family: 'Courier New', monospace;
    font-size: 0.75rem;
    overflow-x: auto;
    display: none;
    white-space: pre-wrap;
    color: var(--color-text-secondary);
}

.bibtex-content.show {
    display: block;
}

.no-results {
    text-align: center;
    padding: var(--spacing-3xl) var(--spacing-lg);
    color: var(--color-text-muted);
}

.no-results svg {
    margin-bottom: var(--spacing-lg);
    opacity: 0.5;
}

.no-results p {
    font-size: 1.125rem;
}

.papers-footer {
    background: var(--color-bg-secondary);
    padding: var(--spacing-lg) 0;
    text-align: center;
    border-top: 1px solid var(--color-border);
}

.papers-footer p {
    margin-bottom: var(--spacing-sm);
}

.papers-footer a {
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 600;
}

.papers-footer a:hover {
    text-decoration: underline;
}

.text-muted {
    color: var(--color-text-muted);
    font-size: 0.875rem;
}

@media (max-width: 768px) {
    .papers-hero h1 {
        font-size: 2rem;
    }

    .papers-controls {
        flex-direction: column;
        align-items: stretch;
    }

    .filter-controls {
        flex-direction: column;
        align-items: stretch;
    }

    .filter-controls select,
    .sort-btn {
        width: 100%;
    }

    .paper-title {
        font-size: 1.125rem;
    }
}
</style>

<script>
// Papers filtering and sorting
(function() {
    const yearFilter = document.getElementById('year-filter');
    const sortToggle = document.getElementById('sort-toggle');
    const sortLabel = document.getElementById('sort-label');
    const papersList = document.getElementById('papers-list');
    const papersCount = document.getElementById('papers-count');
    const noResults = document.getElementById('no-results');

    // i18n strings
    const i18n = {
        newestFirst: '{{ i18n "papers.newestFirst" }}',
        oldestFirst: '{{ i18n "papers.oldestFirst" }}',
        showingPapers: '{{ i18n "papers.showingPapers" }}',
        showBibtex: '{{ i18n "papers.showBibtex" }}',
        hideBibtex: '{{ i18n "papers.hideBibtex" }}'
    };

    let sortAscending = false; // Default: newest first

    // Collect all papers and years
    const papers = Array.from(papersList.querySelectorAll('.paper-entry'));
    const years = new Set();

    papers.forEach(paper => {
        const year = paper.dataset.year;
        if (year) years.add(year);
    });

    // Populate year filter
    Array.from(years).sort((a, b) => b - a).forEach(year => {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearFilter.appendChild(option);
    });

    // Update count
    function updateCount() {
        const visible = papers.filter(p => p.style.display !== 'none').length;
        papersCount.textContent = i18n.showingPapers
            .replace('{visible}', visible)
            .replace('{total}', papers.length);

        // Show/hide no results message
        if (visible === 0) {
            noResults.style.display = 'block';
            papersList.style.display = 'none';
        } else {
            noResults.style.display = 'none';
            papersList.style.display = 'flex';
        }

        // Show/hide year headers
        document.querySelectorAll('.paper-year').forEach(header => {
            const year = header.dataset.year;
            const yearPapers = papers.filter(p => p.dataset.year === year && p.style.display !== 'none');
            header.style.display = yearPapers.length > 0 ? 'block' : 'none';
        });
    }

    // Filter papers
    function filterPapers() {
        const selectedYear = yearFilter.value;

        papers.forEach(paper => {
            const year = paper.dataset.year;
            const matchesYear = selectedYear === 'all' || year === selectedYear;

            paper.style.display = matchesYear ? 'block' : 'none';
        });

        updateCount();
    }

    // Sort papers
    function sortPapers() {
        sortAscending = !sortAscending;
        sortLabel.textContent = sortAscending ? i18n.oldestFirst : i18n.newestFirst;
        sortToggle.classList.toggle('reversed', sortAscending);

        const yearHeaders = Array.from(document.querySelectorAll('.paper-year'));
        const allElements = [...yearHeaders, ...papers];

        // Group by year
        const grouped = {};
        papers.forEach(paper => {
            const year = paper.dataset.year;
            if (!grouped[year]) grouped[year] = [];
            grouped[year].push(paper);
        });

        // Sort years
        const sortedYears = Object.keys(grouped).sort((a, b) => {
            return sortAscending ? a - b : b - a;
        });

        // Clear and rebuild
        papersList.innerHTML = '';
        sortedYears.forEach(year => {
            const header = yearHeaders.find(h => h.dataset.year === year);
            if (header) papersList.appendChild(header);
            grouped[year].forEach(paper => papersList.appendChild(paper));
        });

        updateCount();
    }

    // Event listeners
    yearFilter.addEventListener('change', filterPapers);
    sortToggle.addEventListener('click', sortPapers);

    // BibTeX toggle
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('bibtex-toggle')) {
            const bibtex = e.target.nextElementSibling;
            bibtex.classList.toggle('show');
            e.target.textContent = bibtex.classList.contains('show') ? i18n.hideBibtex : i18n.showBibtex;
        }
    });

    // Initial count
    updateCount();
})();
</script>

{{ end }}
