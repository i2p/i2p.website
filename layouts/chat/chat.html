{{ define "main" }}

<style>
.chat-section {
    padding: 0;
    margin: 0;
}

.chat-container {
    max-width: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
}

.chat-wrapper {
    width: 100%;
    padding: 0 1rem;
}

#network-warning {
    display: none;
    padding: 1rem;
    margin: 2rem auto;
    max-width: 800px;
    background-color: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: 8px;
    color: #856404;
    text-align: center;
}

#irc-iframe {
    width: 100%;
    height: 85vh;
    min-height: 700px;
    border: none;
    border-radius: 8px;
    display: block;
}

@media (max-width: 768px) {
    #irc-iframe {
        height: 75vh;
        min-height: 500px;
    }
}
</style>

<section class="chat-section">
    <div class="container chat-container">
        <div class="chat-wrapper">
            <!-- Network Detection Message -->
            <div id="network-warning">
                <strong>Notice:</strong> The IRC chat is only available on Clearnet. You are currently accessing this site from I2P or Tor network.
            </div>

            <!-- IRC Chat Iframe -->
            <iframe id="irc-iframe" src=""></iframe>
        </div>
    </div>
</section>

<script>
(function() {
    'use strict';

    // Detect network based on hostname
    const hostname = window.location.hostname;
    const isI2P = hostname.endsWith('.i2p');
    const isTor = hostname.endsWith('.onion');
    const isClearnet = !isI2P && !isTor;

    const networkWarning = document.getElementById('network-warning');
    const iframeElement = document.getElementById('irc-iframe');

    if (!isClearnet) {
        // Show warning
        networkWarning.style.display = 'block';
        iframeElement.style.display = 'none';
        console.log('[IRC Chat] Not on Clearnet - IRC chat disabled');
    } else {
        // Get current theme from data-theme attribute
        const getCurrentTheme = () => {
            return document.documentElement.getAttribute('data-theme') || 'light';
        };

        // Update iframe source based on theme
        const updateIframeSrc = () => {
            const theme = getCurrentTheme();
            const iframeUrl = `https://irc.i2p.net?theme=${theme}`;
            iframeElement.src = iframeUrl;
            console.log('[IRC Chat] Theme updated to:', theme);
        };

        // Initial load
        updateIframeSrc();

        // Watch for theme changes
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                    updateIframeSrc();
                }
            });
        });

        // Start observing theme changes
        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['data-theme']
        });

        console.log('[IRC Chat] Clearnet detected - IRC chat enabled');
    }
})();
</script>

{{ end }}
