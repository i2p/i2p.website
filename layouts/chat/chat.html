{{ define "main" }}

<section class="contact-hero">
    <div class="container">
        <h1>{{ .Title }}</h1>
        <p class="contact-description">{{ .Description }}</p>
    </div>
</section>

<section class="contact-content">
    <div class="container">
        {{ .Content }}

        <!-- Network Detection Message -->
        <div id="network-warning" style="display: none; padding: 1rem; margin: 2rem 0; background-color: var(--color-warning-bg, #fff3cd); border: 1px solid var(--color-warning-border, #ffc107); border-radius: 8px; color: var(--color-warning-text, #856404);">
            <strong>Notice:</strong> The IRC chat is only available on Clearnet. You are currently accessing this site from I2P or Tor network.
        </div>

        <!-- IRC Chat Iframe Container -->
        <div id="irc-container" style="margin-top: 2rem;">
            <iframe
                id="irc-iframe"
                src=""
                width="100%"
                height="600"
                frameborder="0"
                style="border: none; border-radius: 8px;">
            </iframe>
        </div>
    </div>
</section>

<script>
(function() {
    'use strict';

    // Detect network based on hostname
    const hostname = window.location.hostname;
    const isI2P = hostname.endsWith('.i2p');
    const isTor = hostname.endsWith('.onion');
    const isClearnet = !isI2P && !isTor;

    const ircContainer = document.getElementById('irc-container');
    const networkWarning = document.getElementById('network-warning');
    const iframeElement = document.getElementById('irc-iframe');

    if (!isClearnet) {
        // Show warning and hide IRC container
        networkWarning.style.display = 'block';
        ircContainer.style.display = 'none';
        console.log('[IRC Chat] Not on Clearnet - IRC chat disabled');
    } else {
        // Get current theme from data-theme attribute
        const getCurrentTheme = () => {
            return document.documentElement.getAttribute('data-theme') || 'light';
        };

        // Update iframe source based on theme
        const updateIframeSrc = () => {
            const theme = getCurrentTheme();
            const iframeUrl = `http://irc.i2p.net?theme=${theme}`;
            iframeElement.src = iframeUrl;
            console.log('[IRC Chat] Theme updated to:', theme);
        };

        // Initial load
        updateIframeSrc();

        // Watch for theme changes
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                    updateIframeSrc();
                }
            });
        });

        // Start observing theme changes
        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['data-theme']
        });

        console.log('[IRC Chat] Clearnet detected - IRC chat enabled');
    }
})();
</script>

{{ end }}
