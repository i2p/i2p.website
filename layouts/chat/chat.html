{{ define "main" }}

<style>
.chat-content-section {
    padding: 2rem 0;
}

.chat-wide-container {
    max-width: 90%;
    margin: 0 auto;
    padding: 0 2rem;
}

#network-warning {
    display: none;
    padding: 1rem;
    margin: 2rem auto;
    max-width: 800px;
    background-color: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: 8px;
    color: #856404;
    text-align: center;
}

.irc-container {
    margin: 2rem 0;
}

#irc-iframe {
    width: 100%;
    height: 700px;
    border: none;
    border-radius: 8px;
    display: block;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

@media (max-width: 1400px) {
    .chat-wide-container {
        max-width: 95%;
    }
}

@media (max-width: 768px) {
    .chat-wide-container {
        max-width: 100%;
        padding: 0 1rem;
    }

    #irc-iframe {
        height: 600px;
    }
}
</style>

<section class="contact-hero">
    <div class="container">
        <h1>{{ .Title }}</h1>
        <p class="contact-description">{{ .Description }}</p>
    </div>
</section>

<section class="chat-content-section">
    <div class="chat-wide-container">
        <!-- Network Detection Message -->
        <div id="network-warning">
            <strong>Notice:</strong> The IRC chat is only available on Clearnet. You are currently accessing this site from I2P or Tor network.
        </div>

        <!-- IRC Chat Iframe -->
        <div class="irc-container">
            <iframe id="irc-iframe" src=""></iframe>
        </div>
    </div>
</section>

<script>
(function() {
    'use strict';

    // Detect network based on hostname
    const hostname = window.location.hostname;
    // Check for I2P (both .i2p and .b32.i2p addresses)
    const isI2P = hostname.endsWith('.b32.i2p') || hostname.endsWith('.i2p');
    const isTor = hostname.endsWith('.onion');
    const isClearnet = !isI2P && !isTor;

    const networkWarning = document.getElementById('network-warning');
    const iframeElement = document.getElementById('irc-iframe');

    if (!isClearnet) {
        // Show warning
        networkWarning.style.display = 'block';
        iframeElement.style.display = 'none';
        console.log('[IRC Chat] Not on Clearnet - IRC chat disabled');
    } else {
        // Get current theme from data-theme attribute
        const getCurrentTheme = () => {
            return document.documentElement.getAttribute('data-theme') || 'light';
        };

        // Update iframe source based on theme
        const updateIframeSrc = () => {
            const theme = getCurrentTheme();
            const iframeUrl = `https://irc.i2p.net?theme=${theme}`;
            iframeElement.src = iframeUrl;
            console.log('[IRC Chat] Theme updated to:', theme);
        };

        // Initial load
        updateIframeSrc();

        // Watch for theme changes
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
                    updateIframeSrc();
                }
            });
        });

        // Start observing theme changes
        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['data-theme']
        });

        console.log('[IRC Chat] Clearnet detected - IRC chat enabled');
    }
})();
</script>

{{ end }}
