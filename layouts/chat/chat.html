<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang | default "en" }}" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} | {{ .Site.Title }}</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        #irc-iframe {
            width: 100vw;
            height: 100vh;
            border: none;
            display: block;
        }

        #network-warning {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 2rem;
            background-color: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            color: #856404;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 1000;
        }
    </style>
</head>
<body>

    <!-- Network Detection Message -->
    <div id="network-warning">
        <strong>Notice:</strong> The IRC chat is only available on Clearnet. You are currently accessing this site from I2P or Tor network.
    </div>

    <!-- IRC Chat Iframe -->
    <iframe id="irc-iframe" src=""></iframe>

    <script>
    (function() {
        'use strict';

        // Detect network based on hostname
        const hostname = window.location.hostname;
        const isI2P = hostname.endsWith('.i2p');
        const isTor = hostname.endsWith('.onion');
        const isClearnet = !isI2P && !isTor;

        const networkWarning = document.getElementById('network-warning');
        const iframeElement = document.getElementById('irc-iframe');

        if (!isClearnet) {
            // Show warning
            networkWarning.style.display = 'block';
            iframeElement.style.display = 'none';
            console.log('[IRC Chat] Not on Clearnet - IRC chat disabled');
        } else {
            // Load IRC with theme detection
            const getPreferredTheme = () => {
                // Check localStorage first
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme) return savedTheme;

                // Check system preference
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    return 'dark';
                }
                return 'light';
            };

            const theme = getPreferredTheme();
            const iframeUrl = `https://irc.i2p.net?theme=${theme}`;
            iframeElement.src = iframeUrl;

            console.log('[IRC Chat] Clearnet detected - IRC chat enabled with theme:', theme);
        }
    })();
    </script>
</body>
</html>
