---
title: "Обсуждение Tunnel"
description: "Исторический обзор паддинга tunnel, фрагментации и стратегий построения"
slug: "tunnel"
layout: "single"
lastUpdated: "2019-07"
accurateFor: "0.9.41"
reviewStatus: "needs-review"
---

> **Примечание:** Этот архив содержит проектные проработки гипотетического характера, выполненные до I2P 0.9.41. Информацию о продакшн-реализации см. в [tunnel documentation](/docs/specs/implementation/).

## Варианты настройки

Идеи, рассматривавшиеся для будущих параметров настройки tunnel, включали:

- Механизмы ограничения частоты доставки сообщений
- Политики дополнения (включая инъекцию ложного трафика)
- Механизмы управления временем жизни tunnel
- Стратегии пакетирования и управления очередями для отправки полезной нагрузки

Ни один из этих параметров не поставлялся вместе с устаревшей реализацией.

## Стратегии заполнения

Обсуждавшиеся возможные подходы к padding (добавочное заполнение):

- Без какого-либо дополнения
- Дополнение случайной длины
- Дополнение фиксированной длины
- Дополнение до ближайшего килобайта
- Дополнение до степеней двойки (`2^n` байт)

Ранние измерения (релиз 0.4) привели к текущему фиксированному размеру сообщения tunnel в 1024 байта. Более высокоуровневые garlic messages (чесночные сообщения) могут добавлять собственное заполнение.

## Фрагментация

Чтобы предотвратить атаки маркировкой по длине сообщений, сообщения tunnel имеют фиксированный размер 1024 байта. Более крупные полезные нагрузки I2NP разбиваются шлюзом на фрагменты; конечная точка собирает фрагменты в течение короткого тайм-аута. Routers могут переупорядочивать фрагменты, чтобы максимизировать эффективность уплотнения перед отправкой.

## Дополнительные альтернативы

### Настройка обработки Tunnel на лету

Были рассмотрены три варианта:

1. Разрешить промежуточному переходу временно прервать tunnel, предоставив доступ к расшифрованным полезным данным.
2. Разрешить участвующим routers “перемешивать” сообщения, отправляя их через один из собственных исходящих tunnels, прежде чем продолжить к следующему переходу.
3. Позволить создателю tunnel динамически переопределять следующий переход пира.

### Двунаправленные Tunnels

Использование отдельных входящих и исходящих tunnels ограничивает объем информации, который может наблюдать любой конкретный набор пиров (например, запрос GET в отличие от объемного ответа). Двунаправленные tunnels упрощают управление пирами, но одновременно раскрывают полную картину трафика в обоих направлениях. Поэтому однонаправленные tunnels остались предпочтительным вариантом.

### Обратные каналы и переменные размеры

Разрешение переменных размеров сообщений в tunnel позволило бы организовать скрытые каналы между узлами, действующими в сговоре (например, кодируя данные с помощью выбранных размеров или частот). Сообщения фиксированного размера снижают этот риск ценой дополнительных накладных расходов на заполнение.

## Альтернативы построения Tunnel

Ссылка: [Hashing it out in Public](http://www-users.cs.umn.edu/~hopper/hashing_it_out.pdf)

### Устаревший метод сборки «Parallel»

До релиза 0.6.1.10 запросы на построение tunnel отправлялись параллельно каждому участнику. Этот метод описан на [старой странице tunnel](/docs/legacy/old-implementation/).

### Одношаговое телескопическое построение (текущий метод)

Современный подход передаёт сообщения построения последовательно от узла к узлу через частично сформированный tunnel. Хотя это похоже на телескопирование в Tor, маршрутизация сообщений построения через исследовательские tunnels снижает утечку информации.

### «Интерактивное» телескопирование

Построение по одному хопу за раз с явными обменами по схеме запрос–ответ позволяет пирам подсчитывать сообщения и делать вывод о своём положении внутри tunnel, поэтому от такого подхода отказались.

### Неисследовательские управляющие tunnels

Одним из предложений было поддерживать отдельный пул управляющих tunnels для трафика построения. Хотя это могло бы помочь разделённым routers, при достаточной интеграции сети это сочли ненужным.

### Исследовательская доставка (устаревшее)

До версии 0.6.1.10 отдельные запросы на tunnel шифровались средствами garlic encryption и доставлялись через исследовательские tunnels, а ответы возвращались отдельно. Эта стратегия была заменена текущим методом однократного телескопирования.

## Выводы

- Сообщения в tunnel фиксированного размера защищают от маркировки по размеру и скрытых каналов, несмотря на дополнительные накладные расходы на заполнение (padding).
- Альтернативные подходы к заполнению, фрагментации и построению были изучены, но не приняты из‑за компромиссов в отношении анонимности.
- Дизайн tunnel продолжает балансировать между эффективностью, наблюдаемостью и устойчивостью к атакам предшественника и атакам на основе перегрузки.
