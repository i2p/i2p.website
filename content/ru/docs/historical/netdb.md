---
title: "Обсуждение сетевой базы данных"
description: "Исторические заметки о floodfill, экспериментах с Kademlia (алгоритм распределённой хеш-таблицы, DHT) и предстоящей настройке netDb"
slug: "netdb"
reviewStatus: "needs-review"
---

> **Примечание:** Это архивное обсуждение описывает исторические подходы к сетевой базе данных (netDb). Обратитесь к [основной документации по netDb](/docs/specs/common-structures/), чтобы узнать об актуальном поведении и рекомендациях.

## История

netDb I2P распространяется с использованием простого алгоритма floodfill. Ранние релизы также сохраняли реализацию Kademlia DHT в качестве запасного варианта, но она оказалась ненадежной и была полностью отключена в версии 0.6.1.20. В схеме floodfill опубликованная запись пересылается на участвующий router, ожидается подтверждение и при необходимости выполняются повторные попытки через других участников floodfill. Пиры floodfill рассылают публикации от router, не участвующих во floodfill, всем прочим участникам floodfill.

В конце 2009 года запросы Kademlia были частично вновь введены, чтобы уменьшить нагрузку по хранению данных на отдельных floodfill routers.

### Введение в Floodfill (тип узлов I2P, хранящих и распространяющих записи netDb)

Floodfill впервые появилась в релизе 0.6.0.4, при этом Kademlia оставалась доступной в качестве резервного варианта. В то время значительные потери пакетов и ограниченные маршруты затрудняли получение подтверждений от четырёх ближайших узлов, часто требуя десятков избыточных попыток сохранения. Переход к подмножеству floodfill среди доступных извне routers обеспечил прагматичное краткосрочное решение.

### Переосмысление Kademlia (протокол распределённой хеш-таблицы, DHT)

Среди рассмотренных альтернатив были:

- Использование netDb как Kademlia DHT (распределённая хеш-таблица Kademlia), ограниченной достижимыми routers, добровольно согласившимися участвовать
- Сохранение модели floodfill, но с ограничением участия для обладающих достаточными ресурсами routers и проверкой распределения с помощью случайных выборочных проверок

Подход floodfill взял верх, поскольку его было проще развернуть, а netDb содержит только метаданные, а не пользовательскую полезную нагрузку. Большинство назначений никогда не публикуют LeaseSet, потому что отправитель обычно вкладывает свой LeaseSet в чесночные сообщения.

## Текущее состояние (историческая перспектива)

Алгоритмы netDb настроены под потребности сети и исторически без труда справлялись с несколькими сотнями routers. Ранние оценки предполагали, что 3–5 floodfill routers могли поддерживать примерно 10,000 узлов.

### Обновлённые расчёты (март 2008)

```
recvKBps = N * (L + 1) * (1 + F) * (1 + R) * S / T
```
Где:

- `N`: Число router-ов в сети
- `L`: Среднее число клиентских назначений на один router (плюс одно для `RouterInfo`)
- `F`: Процент отказов tunnel-ов
- `R`: Период пересборки tunnel-а как доля времени жизни tunnel-а
- `S`: Средний размер записи netDb
- `T`: Время жизни tunnel-а

Используя значения образца 2008 года (`N = 700`, `L = 0.5`, `F = 0.33`, `R = 0.5`, `S = 4 KB`, `T = 10 minutes`), получаем:

```
recvKBps ≈ 700 * (0.5 + 1) * (1 + 0.33) * (1 + 0.5) * 4 KB / 10m ≈ 28 KBps
```
### Вернётся ли Kademlia (протокол распределённой хеш-таблицы)?

В начале 2007 года разработчики обсуждали повторное внедрение Kademlia (распределённой хеш-таблицы, DHT). Было достигнуто согласие, что ёмкость floodfill можно постепенно наращивать по мере необходимости, тогда как Kademlia добавляет существенную сложность и требования к ресурсам для базовой популяции router. Резервный механизм остаётся неактивным, пока ёмкость floodfill не станет недостаточной.

### Планирование пропускной способности floodfill

Автоматическое включение routers класса пропускной способности `O` в floodfill, хотя и выглядит привлекательным, чревато сценариями атак отказа в обслуживании, если в него добровольно включатся враждебные узлы. Исторический анализ показывал, что ограничение пула floodfill (например, 3–5 пиров, обслуживающих ~10K routers) более безопасно. Для поддержания достаточного, но контролируемого набора floodfill использовались доверенные операторы или автоматические эвристики.

## Floodfill TODO (историческое)

> Этот раздел сохранён для истории. Основная страница netDb содержит актуальную дорожную карту и соображения по проектированию.

Операционные инциденты, такие как период 13 марта 2008 года, когда был доступен только один floodfill router, привели к ряду улучшений, реализованных в релизах 0.6.1.33—0.7.x, включая:

- Случайный выбор floodfill для поисковых запросов и приоритет для отзывчивых пиров
- Отображение дополнительных метрик floodfill на странице "Profiles" консоли router
- Постепенное сокращение размера записей netDb для снижения использования пропускной способности floodfill
- Автоматическое включение подмножества routers класса `O` на основе показателей производительности, собранных по данным профиля
- Улучшение блоклистов, выбора пиров floodfill и эвристик исследования

Оставшиеся идеи того периода включали:

- Использование статистики `dbHistory` для более точного оценивания и выбора floodfill-пиров
- Улучшение поведения повторных попыток, чтобы избежать многократных обращений к сбоящим пирам
- Использование метрик задержки и оценок интеграции при выборе
- Более быстрое обнаружение и реакция на сбои floodfill routers
- Продолжение снижения требований к ресурсам на узлах с высокой пропускной способностью и на floodfill-узлах

Даже на момент составления этих заметок сеть считалась устойчивой, с инфраструктурой, позволяющей быстро реагировать на враждебные floodfills (специализированные узлы в netDb) или на атаки отказа в обслуживании, нацеленные на floodfill.

## Дополнительные примечания

- Консоль router давно предоставляет расширенные данные профиля, чтобы помочь в анализе надёжности floodfill.
- Хотя в исторических комментариях высказывались предположения о Kademlia или альтернативных схемах DHT (распределённой хеш-таблицы), floodfill по-прежнему остаётся основным алгоритмом в боевых сетях.
- Перспективные исследования сосредоточились на том, чтобы сделать допуск в floodfill адаптивным, одновременно ограничивая возможности для злоупотреблений.
