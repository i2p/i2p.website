---
title: "Git Bundle для I2P"
description: "Получение и распространение больших репозиториев с помощью git bundle и BitTorrent"
slug: "git-bundle"
lastUpdated: "2025-10"
accurateFor: "2.10.0"
---

Когда сетевые условия делают `git clone` ненадёжным, вы можете распространять репозитории в виде **git bundles** через BitTorrent или любой другой способ передачи файлов. Bundle — это единый файл, содержащий всю историю репозитория. После загрузки вы получаете данные из него локально, а затем переключаетесь обратно на upstream remote.

## 1. Перед началом работы

Для создания bundle требуется **полный** клон Git. Поверхностные клоны, созданные с `--depth 1`, молча создадут испорченные bundle, которые выглядят работающими, но не работают, когда другие пытаются их использовать. Всегда загружайте из проверенного источника (GitHub на [github.com/i2p/i2p.i2p](https://github.com/i2p/i2p.i2p), инстанс Gitea I2P на [i2pgit.org](https://i2pgit.org) или `git.idk.i2p` через I2P) и выполните `git fetch --unshallow` при необходимости, чтобы преобразовать любой поверхностный клон в полный клон перед созданием bundle.

Если вы только используете существующий bundle, просто скачайте его. Никакой специальной подготовки не требуется.

## 2. Загрузка пакета

### Obtaining the Bundle File

Загрузите файл bundle через BitTorrent, используя I2PSnark (встроенный torrent-клиент в I2P) или другие совместимые с I2P клиенты, такие как BiglyBT с плагином I2P.

**Важно**: I2PSnark работает только с торрентами, специально созданными для сети I2P. Стандартные клирнет-торренты несовместимы, поскольку I2P использует Destinations (адреса размером 387+ байт) вместо IP-адресов и портов.

Расположение файла bundle зависит от типа установки I2P:

- **Пользовательские/ручные установки** (установленные с помощью Java-инсталлятора): `~/.i2p/i2psnark/`
- **Системные/демон установки** (установленные через apt-get или менеджер пакетов): `/var/lib/i2p/i2p-config/i2psnark/`

Пользователи BiglyBT найдут загруженные файлы в настроенной директории загрузок.

### Cloning from the Bundle

**Стандартный метод** (работает в большинстве случаев):

```bash
git clone ~/.i2p/i2psnark/i2p.i2p.bundle
```
Если вы столкнулись с ошибками `fatal: multiple updates for ref` (известная проблема в Git 2.21.0 и более поздних версиях, когда глобальная конфигурация Git содержит конфликтующие refspec для fetch), используйте ручной способ инициализации:

```bash
mkdir i2p.i2p && cd i2p.i2p
git init
git fetch ~/.i2p/i2psnark/i2p.i2p.bundle
```
Alternatively, you can use the `--update-head-ok` flag:

Alternatively, вы можете использовать флаг `--update-head-ok`:

```bash
git fetch --update-head-ok ~/.i2p/i2psnark/i2p.i2p.bundle '*:*'
```
### Получение файла Bundle

После клонирования из бандла перенаправьте свой клон на активный удалённый репозиторий, чтобы будущие fetch выполнялись через I2P или clearnet:

```bash
git remote set-url origin git@127.0.0.1:I2P_Developers/i2p.i2p
```
Или для доступа к clearnet:

```bash
git remote set-url origin https://github.com/i2p/i2p.i2p
```
Для SSH доступа через I2P вам необходимо настроить клиентский SSH туннель в консоли вашего I2P роутера (обычно порт 7670), указывающий на `g6u4vqiuy6bdc3dbu6a7gmi3ip45sqwgtbgrr6uupqaaqfyztrka.b32.i2p`. Если используется нестандартный порт:

```bash
GIT_SSH_COMMAND="ssh -p 7670" git clone git@127.0.0.1:I2P_Developers/i2p.i2p
```
## 3. Creating a Bundle

### Клонирование из Bundle

Убедитесь, что ваш репозиторий полностью обновлен с помощью **полного клона** (не поверхностного):

```bash
git fetch --all
```
Если у вас поверхностный клон (shallow clone), сначала преобразуйте его:

```bash
git fetch --unshallow
```
### Переход на Live Remote

**Использование цели сборки Ant** (рекомендуется для дерева исходного кода I2P):

```bash
ant git-bundle
```
Это создаёт как `i2p.i2p.bundle` (файл bundle), так и `i2p.i2p.bundle.torrent` (метаданные BitTorrent).

**Использование git bundle напрямую**:

```bash
git bundle create i2p.i2p.bundle --all
```
Для более избирательных бандлов:

```bash
git bundle create i2p.i2p.bundle --branches --tags
```
### Verifying Your Bundle

Всегда проверяйте бандл перед распространением:

```bash
git bundle verify i2p.i2p.bundle
```
Это подтверждает, что bundle валиден и показывает любые необходимые коммиты-предварительные условия.

### Предварительные требования

Скопируйте бандл и его торрент-метаданные в каталог I2PSnark:

**Для пользовательских установок**:

```bash
cp i2p.i2p.bundle* ~/.i2p/i2psnark/
```
**Для системных установок**:

```bash
cp i2p.i2p.bundle* /var/lib/i2p/i2p-config/i2psnark/
```
I2PSnark автоматически обнаруживает и загружает .torrent файлы в течение нескольких секунд. Откройте веб-интерфейс по адресу [http://127.0.0.1:7657/i2psnark](http://127.0.0.1:7657/i2psnark), чтобы начать раздачу.

## 4. Creating Incremental Bundles

Для периодических обновлений создавайте инкрементные бандлы, содержащие только новые коммиты с момента последнего бандла:

```bash
git tag lastBundleTag
git bundle create update.bundle lastBundleTag..master
```
Пользователи могут загрузить инкрементальный бандл, если у них уже есть базовый репозиторий:

```bash
git fetch /path/to/update.bundle
```
Всегда проверяйте, что инкрементные бандлы содержат ожидаемые предварительные коммиты:

```bash
git bundle verify update.bundle
```
## 5. Updating After the Initial Clone

После того как у вас будет работающий репозиторий из пакета, работайте с ним как с любым другим клоном Git:

```bash
git remote add upstream git@127.0.0.1:I2P_Developers/i2p.i2p
git fetch upstream
git merge upstream/master
```
Или для более простых рабочих процессов:

```bash
git fetch origin
git pull origin master
```
## 3. Создание пакета

- **Устойчивое распространение**: Большие репозитории можно распространять через BitTorrent, который автоматически обрабатывает повторные попытки, проверку фрагментов и возобновление передачи.
- **Peer-to-peer начальная загрузка**: Новые участники могут выполнить начальное клонирование от ближайших узлов в сети I2P, а затем получать инкрементные изменения напрямую с Git-хостов.
- **Снижение нагрузки на сервер**: Зеркала могут публиковать периодические бандлы для снятия нагрузки с активных Git-хостов, что особенно полезно для больших репозиториев или медленных сетевых условий.
- **Офлайн-транспорт**: Бандлы работают с любым файловым транспортом (USB-накопители, прямые передачи, sneakernet), а не только с BitTorrent.

Бандлы не заменяют живые удалённые репозитории. Они просто обеспечивают более надёжный метод начальной загрузки для первоначального клонирования или крупных обновлений.

## 7. Troubleshooting

### Генерация Bundle

**Проблема**: Создание бандла завершается успешно, но другие не могут клонировать из бандла.

**Причина**: Ваш исходный клон является поверхностным (создан с параметром `--depth`).

**Решение**: Преобразуйте в полный клон перед созданием bundles:

```bash
git fetch --unshallow
```
### Проверка вашего пакета

**Проблема**: `fatal: multiple updates for ref` при клонировании из bundle.

**Причина**: Git 2.21.0+ конфликтует с глобальными refspec для fetch в `~/.gitconfig`.

**Решения**: 1. Используйте ручную инициализацию: `mkdir repo && cd repo && git init && git fetch /path/to/bundle` 2. Используйте флаг `--update-head-ok`: `git fetch --update-head-ok /path/to/bundle '*:*'` 3. Удалите конфликтующую конфигурацию: `git config --global --unset remote.origin.fetch`

### Распространение через I2PSnark

**Проблема**: `git bundle verify` сообщает об отсутствующих требованиях.

**Причина**: Инкрементальный бандл или неполное клонирование исходного кода.

**Решение**: Либо получите необходимые коммиты, либо сначала используйте базовый bundle, затем примените инкрементные обновления.
