---
title: "Схема подписи Red25519"
description: "Перерандомизируемая схема подписи для создания ослеплённых Destinations (адресов назначения в I2P)"
slug: "red25519-signature-scheme"
lastUpdated: "2025-10"
accurateFor: "2.10.0"
---

## Обзор

В этом документе описывается схема подписи с возможностью повторной рандомизации, подходящая для создания Destinations, которые можно ослеплять. Кроме того, её можно использовать для ослепления существующих Ed25519 Destinations с небольшим снижением эффективности.

Red25519 полностью поддерживается в I2P routers начиная с версии 0.9.39 (выпущенной 21 марта 2019 года). Данная спецификация была финализирована в версии 0.9.47 (август 2020) после 17 месяцев промышленной эксплуатации. Схема подписи используется как тип подписи 11 (RedDSA_SHA512_Ed25519) в сети I2P.

## Мотивация

Предложение 123 (Новые записи netDB) определяет зашифрованный формат LeaseSet2, воплощающий принцип наименьших полномочий: каждому участнику сети предоставляется только информация, необходимая для его роли. В частности, зашифрованный LeaseSet2, публикуемый на floodfill, не раскрывает Destination (адрес назначения в I2P), для которого он предназначен, а содержащиеся в нём Leases могут быть просмотрены только тем, кто заранее знает этот Destination. Однако floodfills по-прежнему должны иметь возможность аутентифицировать публикуемые зашифрованные LeaseSet2, а клиентам дополнительно необходимо удостовериться, что эта аутентификация была обеспечена самим Destination.

Предложение 123 достигает этого путём ослепления подписывающих ключей Destinations (идентификаторов назначения в I2P). Ослеплённые ключи можно использовать для создания подписей, которые могут быть проверены floodfills, и клиенты могут быть уверены, что только Destination мог создать эти подписи. Поэтому необходимо определить схему подписи, которую можно использовать для ослепления.

**Примечание о статусе Proposal 123**: Части Proposal 123 были реализованы и постепенно внедрялись начиная с версии 0.9.38, при этом поддержка Red25519 была добавлена в версии 0.9.39. Функциональность шифрованного LeaseSet2 готова к промышленной эксплуатации и активно используется в сети I2P для скрытых сервисов с повышенной конфиденциальностью.

## Проектирование

### Основная схема подписи

Схема подписи, описанная здесь, Red25519, является конкретной реализацией RedDSA, как определено в разделе 5.4.6 спецификации протокола Zcash (Sapling и новее). RedDSA — это схема подписи на основе Шнорра, которая поддерживает перерандомизацию ключей. Она имеет следующие функции:

**GENERATE_PRIVATE()** : Возвращает равновероятно выбранный закрытый ключ.

**DERIVE_PUBLIC(sk)** : Возвращает открытый ключ, соответствующий заданному закрытому ключу.

**GENERATE_RANDOM()** : Возвращает случайный скаляр, подходящий для повторной рандомизации ключевой пары.

**RANDOMIZE_PRIVATE(sk, alpha)** : Повторно рандомизирует закрытый ключ, используя секретный скаляр alpha.

**RANDOMIZE_PUBLIC(vk, alpha)** : Повторно рандомизирует открытый ключ, используя секретный скаляр alpha.

**SIGN(sk, m)** : Возвращает подпись, вычисленную закрытым ключом sk для заданного сообщения m.

**VERIFY(vk, m, sig)** : Проверяет подпись sig на соответствие открытому ключу vk и сообщению m. Возвращает true, если подпись действительна, иначе false.

Для заданной пары ключей (sk, vk) выполняется следующее соотношение:

```
RANDOMIZE_PUBLIC(vk, alpha) == DERIVE_PUBLIC(RANDOMIZE_PRIVATE(sk, alpha))
```
### Преобразование ключей Ed25519 в Red25519

Ключи Ed25519 МОГУТ быть временно односторонне преобразованы в ключи Red25519, чтобы поддержать повторную рандомизацию существующих Ed25519 Destinations (идентификаторы назначения в I2P). Другие типы подписи несовместимы.

Мы определяем следующие функции преобразования:

**CONVERT_ED25519_PRIVATE(privkey)** : Возвращает закрытый ключ Red25519, соответствующий заданному закрытому ключу Ed25519.

**CONVERT_ED25519_PUBLIC(pubkey)** : Возвращает открытый ключ Red25519, соответствующий заданному открытому ключу Ed25519.

Для заданной пары ключей Ed25519 (privkey, pubkey) выполняется следующее соотношение:

```
CONVERT_ED25519_PUBLIC(pubkey) == DERIVE_PUBLIC(CONVERT_ED25519_PRIVATE(privkey))
```
## Спецификация

### Определения

**B** : Базовая точка Ed25519, как в [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).

**L** : Порядок группы Ed25519 2^252 + 27742317777372353535851937790883648493, как в [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).

**[s] B** : Скалярное умножение базовой точки на s при фиксированной базе.

**[s] A** : Скалярное умножение точки A на скаляр s с переменным основанием.

**x || y** : Конкатенация двух байтовых массивов x и y.

### Red25519 (тип подписи на основе Ed25519, используемый в I2P)

Схема Red25519 (вариант RedDSA) специализирует RedDSA (криптографическая схема подписи) следующим образом:

- G := группа точек на форме Эдвардса кривой Curve25519. В частности, это означает, что Red25519 использует подгруппу простого порядка L, а кофактор h_G равен 8.
- P_G := базовая точка Ed25519 B.
- l_H := 512
- H(x) := SHA-512("I2P_Red25519H(x)" || x)

**Примечание о выборе функции хеширования**: Red25519 использует SHA-512 вместо BLAKE2b-512 (как в Zcash RedDSA). Этот выбор компенсируется описанной ниже защитой методом префиксирования длины. I2P Proposal 148 предлагает в будущем перейти на BLAKE2b-512 для усиления защиты от идентификации дубликатов сообщений (DMI) и атак расширения длины (LEA), а также для повышения производительности.

В RedDSA предполагается, что H(x) реализован с использованием криптографической хеш-функции, устойчивой к атакам на расширение длины. Сам по себе SHA-512 этому требованию не удовлетворяет. Чтобы исправить это, мы требуем, чтобы сообщения предварялись префиксно-свободным кодированием их длины:

```
len_u16(M) || M
```
где `len_u16(M)` — это 2-байтовое представление длины M в формате little-endian (порядок от младшего к старшему байту), для согласованности с кодированием скаляров и точек в формате little-endian.

Сообщения не должны быть длиннее 65534 байт. Длина 65535 зарезервирована для возможных будущих расширений.

**Примечание по безопасности**: Включение публичного ключа (vk) в хеш-функцию в сочетании с 80 случайными байтами при подписании обеспечивает защиту от уязвимостей класса SURK-CMA (Strong Unforgeability with Re-randomized Keys under Chosen Message Attack — «сильная стойкость к подделке при атаке с выбранным сообщением для повторно рандомизированных ключей»), обнаруженных в ранних вариантах RedDSA (схема цифровой подписи для Zcash). В этой реализации включены исправления безопасности из аудита Zcash компании NCC Group (замечание NCC-Zcash2018-009).

### Кодирование и декодирование

Закрытые ключи Red25519 — это скаляры по модулю L, кодируемые в представлении little-endian. Мы определяем функции `DECODE_SCALAR` и `ENCODE_SCALAR` для взаимного преобразования между байтовым массивом и целочисленной формой скаляра.

Открытые ключи Red25519 — это точки на кривой Curve25519 в форме Эдвардса. Они кодируются как 255-битное представление координаты y в формате little-endian, за которым следует один бит, указывающий знак координаты x. Это та же схема кодирования, что и у Ed25519. Мы определяем функции `DECODE_POINT` и `ENCODE_POINT` для взаимного преобразования между байтовым массивом и координатным представлением точки.

### Функции RedDSA (схема цифровой подписи)

Для упрощения реализации ниже мы явно приводим функции RedDSA (а также несколько вспомогательных функций), уже специализированные для Red25519. Разработчикам следует обратиться к разделу 5.4.6 Спецификации протокола Zcash для общей спецификации функций RedDSA.

```
HStar(prefix1, prefix2, m) :=
    h = SHA-512()
    h.input("I2P_Red25519H(x)")
    h.input(prefix1)
    h.input(prefix2)

    h.input(len(m) & 0xff)
    h.input((len(m) >> 8) & 0xff)
    h.input(m)

    s = h.digest()
    return s mod L

GENERATE_PRIVATE :=
    s = 64 random bytes
    return s mod L

DERIVE_PUBLIC(sk) := [sk] B

GENERATE_RANDOM :=
    s = 64 random bytes
    return s mod L

RANDOMIZE_PRIVATE(sk, alpha) := (sk + alpha) mod L

RANDOMIZE_PUBLIC(vk, alpha) := vk + [alpha] B

SIGN(sk, m) :=
    T = 80 random bytes
    vkBytes = ENCODE_POINT(DERIVE_PUBLIC(sk))
    r = HStar(T, vkBytes, m)

    R = [r] B
    Rbytes = ENCODE_POINT(R)

    c = HStar(Rbytes, vkBytes, m)
    S = (r + (c * sk)) mod L

    return Rbytes || ENCODE_SCALAR(S)

VERIFY(vk, m, sig) :=
    Rbytes = sig[0..32]
    Sbytes = sig[32..64]

    R = DECODE_POINT(Rbytes)
    if R is invalid:
        return false

    S = DECODE_SCALAR(Sbytes)
    if S >= L:
        return false

    vkBytes = ENCODE_POINT(vk)
    c = HStar(Rbytes, vkBytes, m)
    return ((-[S] B) + R + ([c] vk)).multiplyByCofactor().isIdentity()
```
### Функции преобразования

```
CONVERT_ED25519_PRIVATE(privkey) :=
    s = SHA-512(privkey)[0..32]
    s[0] = s[0] & 248
    s[31] = (s[31] & 63) | 64
    return s

CONVERT_ED25519_PUBLIC(pubkey) := pubkey
```
Обратите внимание, что реализация `CONVERT_ED25519_PRIVATE` эквивалентна вычислению секретного скаляра s при получении открытого ключа Ed25519 из закрытого ключа Ed25519, как указано в шагах 1-3 раздела 5.1.5 [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).

## Последствия для безопасности

Повторная рандомизация Red25519 Destination (адреса назначения) и последующее создание подписей с ним не приводит к утечке какой-либо информации о Destination, поскольку распределение закрытых ключей Red25519, генерируемых с помощью `RANDOMIZE_PRIVATE`, идентично распределению закрытых ключей, генерируемых с помощью `GENERATE_PRIVATE`, а `DERIVE_PUBLIC` выполняется детерминированно.

Преобразование закрытых ключей Ed25519 в Red25519 с помощью `CONVERT_ED25519_PRIVATE` не приводит к тому же распределению. Тем не менее, мы считаем снижение уровня безопасности приемлемым по следующим причинам:

- Пространство скаляров Ed25519 приблизительно вдвое меньше пространства скаляров Red25519 (существует 2^251 возможных скаляров Ed25519, и L ~= 2^252 возможных скаляров Red25519). Следовательно, снижение стойкости — не более чем примерно в 2 раза, то есть примерно на 1 бит (поскольку мы могли случайно выбрать скаляр Red25519, который также является допустимым скаляром Ed25519).
- Существующие назначения Ed25519 ранее уже были видимы в сети, и следует исходить из того, что злонамеренные floodfills уже их проиндексировали.

**Важно**: Пользователям, которых беспокоит это снижение уровня безопасности, следует использовать Red25519 (тип подписи 11) в качестве типа подписи (sigtype) для своих Destinations (идентификаторов назначения) вместо Ed25519 (тип подписи 7).

Отметим, что вышеизложенный аргумент не применим к скаляру перерандомизации alpha; каждый раз, когда выбирается смещённый alpha, происходит утечка информации о ключе, поскольку аддитивная перерандомизация ведёт себя как одноразовый блокнот.

### Статус аудита безопасности

**Важное раскрытие информации**: I2P, включая Red25519, никогда не проходил формального аудита безопасности третьей стороной. Базовый дизайн RedDSA проходил проверку безопасности компанией NCC Group в рамках аудита протокола Zcash Sapling в 2018 году, в ходе которого были выявлены и исправлены уязвимости. Однако конкретная реализация I2P с использованием SHA-512 (вместо BLAKE2b-512) и I2P domain separation (доменное разделение) не подвергалась независимому анализу.

Эталонная реализация ed25519-java от str4d прошла один независимый аудит, проведённый третьей стороной, но он предшествовал реализации Red25519 и охватывал только функциональность Ed25519, а не расширения Red25519.

Пользователи, внедряющие Red25519 (криптографическая схема), должны понимать это ограничение и оценивать компромиссы в области безопасности с учётом своей модели угроз.

## Совместимость

Версии I2P с поддержкой Red25519 (0.9.39 и новее) смогут проверять сетевые структуры данных, подписанные с использованием Red25519. Версии I2P без поддержки Red25519 будут рассматривать такую подпись как неизвестную и МОГУТ отбрасывать соответствующие структуры данных.

**Хронология развертывания**: - **0.9.39** (март 2019): Первая реализация с поддержкой Encrypted LS2 (зашифрованный LeaseSet v2) в floodfills - **0.9.40** (май 2019): По-клиентная авторизация для Encrypted LS2 - **0.9.41** (август 2019): Meta LS2 и Encrypted LS2 с офлайн-ключами - **0.9.43** (февраль 2020): Поддержка b32 для Encrypted LS2 - **0.9.47** (август 2020): Финализация спецификации - **2.10.0** (октябрь 2025): Текущая версия сети (эквивалент 0.9.67+)

Пользователи могут рассчитывать на хорошую надежность структур данных, подписанных Red25519, для сценариев использования Encrypted LeaseSet2, поскольку у сети было более шести лет на обновление с момента первоначальной реализации. Однако метрики принятия для общего использования destination (идентификатор назначения в I2P) публично недоступны.

**Основной сценарий использования**: Red25519 в первую очередь применяется для функциональности зашифрованного LeaseSet2, где требуется ослепление ключа. Для стандартных назначений без требований к зашифрованному leaseSet Ed25519 (тип подписи 7) остаётся рекомендуемым выбором благодаря более широкой совместимости и более длительной проверенной историей использования.

## Примечания по реализации

Red25519 реализован в I2P Java router в `net.i2p.crypto.eddsa.RedDSAEngine` и использует библиотеку ed25519-java от str4d (Jack Grigg) в качестве зависимости Maven `net.i2p.crypto:eddsa` (версии 0.1.0–0.3.0).

Реализация i2pd на C++ также поддерживает Red25519 (signaturetype=11) для публикации зашифрованного LeaseSet.

Пример конфигурации для i2pd:

```
signaturetype=11
i2cp.leaseSetType=5
```
**Совместимость зашифрованного LeaseSet2**: Спецификация зашифрованного LeaseSet требует, чтобы открытый ключ подписи в неослеплённом назначении был Ed25519 (тип подписи 7) или Red25519 (тип подписи 11). Другие типы подписи для функциональности зашифрованного leaseset не поддерживаются.

## Тестовые векторы

Следующие тестовые векторы предоставлены для проверки корректности реализации. Каждый вектор содержит:

- `edsk`: закрытый ключ Ed25519 (случайный)
- `edpk`: открытый ключ Ed25519, соответствующий edsk
- `sk`: CONVERT_ED25519_PRIVATE(edsk)
- `vk`: CONVERT_ED25519_PUBLIC(edpk)
- `msg`: сообщение для подписи
- `sig`: SIGN(sk, msg)
- `alpha`: GENERATE_RANDOM()
- `rsk`: RANDOMIZE_PRIVATE(sk, alpha)
- `rvk`: RANDOMIZE_PUBLIC(vk, alpha)
- `rsig`: SIGN(rsk, msg)

**Примечание по реализации**: Эти тестовые векторы следует интегрировать в автоматизированные наборы модульных тестов для непрерывной проверки. Разработчикам следует проверять, что все преобразования, подписи и операции по повторной рандомизации соответствуют этим ожидаемым значениям.

### Тестовый вектор 1

```
edsk:  0101010101010101010101010101010101010101010101010101010101010101
edpk:  8a88e3dd7409f195fd52db2d3cba5d72ca6709bf1d94121bf3748801b40f6f5c
sk:    58e86efb75fa4e2c410f46e16de9f6acae1a1703528651b69bc176c088bef36e
vk:    8a88e3dd7409f195fd52db2d3cba5d72ca6709bf1d94121bf3748801b40f6f5c
msg:   0202020202020202020202020202020202020202020202020202020202020202
sig:   61f5527f4d3b46de4b2c234390370bf715ae9098907a0d191ba1b44b23a8ac1a
       6a40437a5294e9503faaf9bd2b7f2fe7ba44dec487b3185aba7ff7d7a17cd40f
alpha: ae9ba9cbbc047c442448fca7c9f4e288a202ed520bfad0c784b792b7773cee08
rsk:   8bb85f3c7a494a08890d7d142109c1a3501d04565d80227e2079097800fbe107
rvk:   6fe128737b8e76fa66698a748b0dc0a89168dd8a0601c2b1c0b26835d323e9b3
rsig:  533053074d3b44f08723aab988ede9880a001b7a684d4a98f2d1b88fabee07a5
       b5c9430c69a690321e0cb8365d7aeb6688bcbad2c0780e0c69e8a1b4a45f3001
```
### Тестовый вектор 2

```
edsk:  0202020202020202020202020202020202020202020202020202020202020202
edpk:  8139770ea87d175f56a35466c34c7ecccb8d8a91b4ee37a25df60f5b8fc9b394
sk:    a83c626bc9c38c8c201878ebb1d5b0b50ac40e8986c78793db1d4ef369fca14e
vk:    8139770ea87d175f56a35466c34c7ecccb8d8a91b4ee37a25df60f5b8fc9b394
msg:   0303030303030303030303030303030303030303030303030303030303030303
sig:   0829e58eb5399870f009bd1f0270264e556424bda7a93fbcec99f6d9d75db46d
       5c3cb546d9947ca7c1200876c8775a90c357a2aef3d2f16388242ee1914b1a0a
alpha: 98b615d9027e996cc2796c019d9c8beb46aa7d2b6eea2e5d98eb29eb1584c203
rsk:   9fcfaa734852ca40b3810ebef590e138516e8cb4f4b1b6f0730978de7f806402
rvk:   527e121090158419609e4a0d8de6f7d3271b353a8cd0b8172fe41468ea1e9177
rsig:  9a6961f35ed264a946cd6214b2326a6e6caa426c2a61bc14367fd278e0b5fb51
       3ac065a69210a457f17d12ba8a496cfd835002691affa8efcdecae48135c090f
```
**Примечание**: Дополнительные тестовые векторы 3-10 следуют тому же формату и могут быть найдены в референсной реализации.

## Ссылки

- [Предложение 123: Новые записи netDB](/proposals/123-new-netdb-entries/) - Части реализованы и развернуты в 0.9.38, 0.9.39 и более поздних релизах
- [Спецификация протокола Zcash, раздел 5.4.6: RedDSA, RedJubjub и RedPallas](https://zips.z.cash/protocol/protocol.pdf) - RedDSA определена как часть спецификации протокола Zcash; прошла аудит безопасности компанией NCC Group (январь 2019)
- [RFC 8032: Алгоритм цифровой подписи на кривых Эдвардса (EdDSA)](https://www.rfc-editor.org/rfc/rfc8032.html)
- [Предложение 148: RedDSA-BLAKE2b-Ed25519](/proposals/148-eddsa-blake2b-ed25519/) - Предложено, но ещё не реализовано; предполагает будущую миграцию на BLAKE2b-512
- [Спецификация зашифрованного LeaseSet](/docs/specs/encryptedleaseset/)
- [Спецификация низкоуровневой криптографии](/docs/specs/cryptography/)
