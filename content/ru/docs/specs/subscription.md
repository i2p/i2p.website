---
title: "Команды фида подписки адресов"
description: "Расширение для лент подписки на адреса, позволяющее владельцам имён хостов обновлять и управлять своими записями"
slug: "subscription"
lastUpdated: "2025-10"
accurateFor: "I2P 2.10.0"
---

## Обзор

Эта спецификация расширяет ленту подписки адресной книги командами, позволяя серверам имён рассылать обновления записей от владельцев имён хостов. Впервые предложена в [Предложение 112](/proposals/112-addressbook-subscription-feed-commands/) (сентябрь 2014), реализована в версии 0.9.26 (июнь 2016) и развернута по всей сети со статусом CLOSED.

Система оставалась стабильной и неизменной с момента первоначальной реализации, продолжая работать идентично в I2P 2.10.0 (Router API 0.9.65, сентябрь 2025 года).

## Мотивация

Ранее серверы подписки на hosts.txt отправляли данные только в простом формате hosts.txt:

```
example.i2p=b64destination
```
Этот базовый формат создал несколько проблем:

- Владельцы имён хоста не могут обновлять Destination (криптографический адрес назначения в I2P), связанный с их именами хоста (например, чтобы обновить ключ подписи до более стойкого криптографического типа).
- Владельцы имён хоста не могут по своему усмотрению отказаться от владения своими именами хоста. Они должны передать соответствующие закрытые ключи Destination непосредственно новому владельцу.
- Нет способа подтвердить, что поддомен контролируется владельцем соответствующего базового имени хоста. В настоящее время это обеспечивается лишь некоторыми серверами имён в индивидуальном порядке.

## Проектирование

Эта спецификация добавляет строки-команды в формат hosts.txt. С помощью этих команд серверы имён могут расширять предоставляемые ими службы, обеспечивая дополнительные возможности. Клиенты, реализующие эту спецификацию, могут отслеживать эти возможности через обычный процесс подписки.

Все командные строки должны быть подписаны соответствующей Destination (уникальный адрес сервиса в I2P). Это гарантирует, что изменения вносятся только по запросу владельца имени хоста.

## Последствия для безопасности

Эта спецификация не влияет на анонимность.

Риски, связанные с утратой контроля над ключом Destination, возрастают, поскольку тот, кто завладеет им, сможет с помощью этих команд вносить изменения в любые связанные имена хостов. Однако это не представляет большей проблемы, чем текущее положение дел, при котором тот, кто получает Destination (адрес назначения в I2P), может выдавать себя за имя хоста и (частично) перехватывать его трафик. Повышенный риск компенсируется тем, что владельцам имен хостов предоставляется возможность изменить Destination, связанный с именем хоста, в случае если они считают, что Destination был скомпрометирован. В текущей системе это невозможно.

## Спецификация

### Новые типы перевода строки

Появились два новых типа линий:

1. **Команды Add и Change:**

```
example.i2p=b64destination#!key1=val1#key2=val2...
```
2. **Удалите команды:**

```
#!key1=val1#key2=val2...
```
#### Упорядочение

Лента не обязательно упорядочена или полна. Например, команда change может появиться в строке перед командой add или вовсе без команды add.

Ключи могут быть в любом порядке. Повторяющиеся ключи не допускаются. Все ключи и значения чувствительны к регистру.

### Общие ключи

**Требуется во всех командах:**

**sig** : подпись в формате Base64, с использованием ключа подписи из destination

**Ссылки на второе имя хоста и/или адрес назначения:**

**oldname** : Второе имя хоста (новое или изменённое)

**olddest** : Второй адрес назначения в Base64 (новый или изменённый)

**oldsig** : Вторая подпись Base64, использующая ключ подписи из olddest

**Другие распространённые ключи:**

**action** : Команда

**name** : Имя хоста, присутствует только если ему не предшествует `example.i2p=b64dest`

**dest** : Назначение в формате Base64, присутствует только если ему не предшествует `example.i2p=b64dest`

**date** : В секундах с начала эпохи Unix

**expires** : В секундах с начала эпохи

### Команды

Все команды, кроме команды "Add", должны содержать пару ключ/значение `action=command`.

Для совместимости с более старыми клиентами большинство команд предваряются `example.i2p=b64dest`, как указано ниже. При изменениях всегда используются новые значения. Все старые значения включены в раздел ключ/значение.

Перечисленные ключи обязательны. Все команды могут содержать дополнительные пары ключ/значение, не определённые здесь.

#### Добавить имя хоста

**Предваряется example.i2p=b64dest** : ДА, это новое имя хоста и назначение.

**действие** : НЕ включено, оно подразумевается.

**sig** : подпись

Пример:

```
example.i2p=b64dest#!sig=b64sig
```
#### Изменить имя хоста

**Предваряется example.i2p=b64dest** : ДА, это новое имя хоста и старое назначение.

**действие** : changename

**oldname** : старое имя хоста, которое нужно заменить

**sig** : подпись

Пример:

```
example.i2p=b64dest#!action=changename#oldname=oldhostname#sig=b64sig
```
#### Изменить адрес назначения

**Предваряется example.i2p=b64dest** : ДА, это старое имя хоста и новый адрес назначения.

**action** : changedest

**olddest** : старый адрес назначения, подлежит замене

**oldsig** : подпись с использованием olddest

**sig** : подпись

Пример:

```
example.i2p=b64dest#!action=changedest#olddest=oldb64dest#oldsig=b64sig#sig=b64sig
```
#### Добавить псевдоним хоста

**Предваряется example.i2p=b64dest** : ДА, это новое (псевдоним) имя хоста и прежний destination (адрес назначения).

**action** : addname

**oldname** : старое имя хоста

**sig** : подпись

Пример:

```
example.i2p=b64dest#!action=addname#oldname=oldhostname#sig=b64sig
```
#### Добавить псевдоним адреса назначения

(Используется для обновления криптографии)

**Предваряется example.i2p=b64dest** : ДА, это старое имя хоста и новый (альтернативный) адрес назначения.

**action** : adddest

**olddest** : старое назначение

**oldsig** : подпись с использованием olddest

**sig** : подпись с использованием dest

Пример:

```
example.i2p=b64dest#!action=adddest#olddest=oldb64dest#oldsig=b64sig#sig=b64sig
```
#### Добавить поддомен

**С префиксом subdomain.example.i2p=b64dest** : ДА, это новое имя поддомена и назначение.

**action** : addsubdomain

**oldname** : имя хоста более высокого уровня (example.i2p)

**olddest** : назначение верхнего уровня (например example.i2p)

**oldsig** : подпись с использованием olddest

**sig** : подпись с использованием dest

Пример:

```
subdomain.example.i2p=b64dest#!action=addsubdomain#oldname=example.i2p#olddest=oldb64dest#oldsig=b64sig#sig=b64sig
```
#### Обновить метаданные

**С префиксом example.i2p=b64dest** : ДА, это старое имя хоста и назначение.

**действие** : обновление

**sig** : подпись

(добавьте сюда любые обновлённые ключи)

Пример:

```
example.i2p=b64dest#!action=update#k1=v1#k2=v2#sig=b64sig
```
#### Удалить имя хоста

**Предваряется записью example.i2p=b64dest** : НЕТ, это указывается в параметрах

**действие** : удалить

**name** : имя хоста

**dest** : адрес назначения

**sig** : подпись

Пример:

```
#!action=remove#name=example.i2p#dest=b64dest#sig=b64sig
```
#### Удалить все с этим адресом назначения

**С префиксом example.i2p=b64dest** : НЕТ, это указывается в параметрах

**действие** : removeall

**dest** : адрес назначения

**sig** : подпись

Пример:

```
#!action=removeall#dest=b64dest#sig=b64sig
```
### Подписи

Все команды должны быть подписаны соответствующим Destination (уникальный адрес назначения в I2P). Для команд с двумя Destination могут потребоваться две подписи.

`oldsig` — это всегда "внутренняя" подпись. Подписывайте и проверяйте без ключей `oldsig` или `sig`. `sig` — это всегда "внешняя" подпись. Подписывайте и проверяйте при наличии ключа `oldsig`, но без ключа `sig`.

#### Входные данные для подписей

Чтобы сгенерировать поток байтов для создания или проверки подписи, сериализуйте следующим образом:

1. Удалите ключ `sig`
2. Если проверка выполняется с `oldsig`, также удалите ключ `oldsig`
3. Только для команд Add или Change выведите `example.i2p=b64dest`
4. Если остались какие-либо ключи, выведите `#!`
5. Отсортируйте параметры по ключу в UTF-8, выдайте ошибку при дублирующихся ключах
6. Для каждой пары ключ/значение выведите `key=value`, после чего (если это не последняя пара ключ/значение) символ `#`

**Примечания**

- Не выводите символ новой строки
- Кодировка вывода — UTF-8
- Все значения destination и signature кодируются в Base 64 с использованием алфавита I2P
- Ключи и значения чувствительны к регистру
- Имена хостов должны быть в нижнем регистре

#### Текущие типы подписей

Начиная с I2P 2.10.0 поддерживаются следующие типы подписей для назначений:

- **EdDSA_SHA512_Ed25519** (Type 7): Наиболее распространённый для назначений начиная с 0.9.15. Использует 32-байтный открытый ключ и 64-байтную подпись. Это рекомендуемый тип подписи для новых назначений.
- **RedDSA_SHA512_Ed25519** (Type 13): Доступен только для назначений и зашифрованных leasesets (начиная с 0.9.39).
- Устаревшие типы (DSA_SHA1, варианты ECDSA): Всё ещё поддерживаются, но объявлены устаревшими для новых Router Identities начиная с 0.9.58.

Примечание: Постквантовые криптографические варианты доступны начиная с I2P 2.10.0, но пока не являются типами подписей по умолчанию.

## Совместимость

Все новые строки в формате hosts.txt реализованы с использованием начальных символов комментария (`#!`), поэтому все более старые версии I2P будут интерпретировать новые команды как комментарии и корректно их игнорировать.

Когда I2P routers обновятся до новой спецификации, они не будут заново интерпретировать старые комментарии, но начнут обрабатывать новые команды при последующих загрузках своих лент подписок. Поэтому важно, чтобы серверы имён тем или иным образом сохраняли записи команд или включили поддержку ETag (HTTP‑заголовка с идентификатором версии ресурса), чтобы routers могли получить все прошлые команды.

## Статус реализации

**Первоначальное развертывание:** Версия 0.9.26 (7 июня 2016)

**Текущее состояние:** Стабильное и без изменений до I2P 2.10.0 включительно (Router API 0.9.65, сентябрь 2025)

**Статус предложения:** ЗАКРЫТО (успешно развернуто по всей сети)

**Расположение реализации:** `apps/addressbook/java/src/net/i2p/addressbook/` в I2P Java router

**Ключевые классы:** - `SubscriptionList.java`: Управляет обработкой подписок - `Subscription.java`: Обрабатывает отдельные ленты подписок - `AddressBook.java`: Базовая функциональность адресной книги - `Daemon.java`: Фоновая служба адресной книги

**URL подписки по умолчанию:** `http://i2p-projekt.i2p/hosts.txt`

## Подробности транспорта

Подписки используют HTTP с поддержкой условного GET:

- **Заголовок ETag:** Позволяет эффективно обнаруживать изменения
- **Заголовок Last-Modified:** Отслеживает моменты обновления подписки
- **304 Not Modified:** Серверы должны возвращать этот статус, когда содержимое не изменилось
- **Content-Length:** Настоятельно рекомендуется для всех ответов

I2P router использует стандартное поведение HTTP‑клиента с полноценной поддержкой кэширования.

## Контекст версии

**Примечание о версионировании I2P:** Начиная примерно с версии 1.5.0 (август 2021 года), I2P перешёл с схемы версионирования 0.9.x на семантическое версионирование (1.x, 2.x и т. д.). Однако внутренняя версия Router API продолжает использовать нумерацию 0.9.x для обеспечения обратной совместимости. По состоянию на октябрь 2025 года текущий релиз — I2P 2.10.0 с версией Router API 0.9.65.

Настоящий документ спецификации был изначально написан для версии 0.9.49 (февраль 2021 года) и остаётся полностью актуальным для текущей версии 0.9.65 (I2P 2.10.0), поскольку система подписных лент не претерпела изменений с момента своей первоначальной реализации в 0.9.26.

## Ссылки

- [Предложение 112 (Оригинал)](/proposals/112-addressbook-subscription-feed-commands/)
- [Официальная спецификация](/docs/specs/subscription/)
- [Документация по системе именования I2P](/docs/overview/naming/)
- [Спецификация общих структур](/docs/specs/common-structures/)
- [Репозиторий исходного кода I2P](https://github.com/i2p/i2p.i2p)
- [Репозиторий I2P на Gitea](https://i2pgit.org/I2P_Developers/i2p.i2p)

## Связанные разработки

Хотя сама система подписки на ленты не изменилась, следующие связанные изменения в инфраструктуре именования I2P могут представлять интерес:

- **Расширенные имена Base32** (0.9.40+): Поддержка base32-адресов длиной 56+ символов для зашифрованных leasesets. Не влияет на формат ленты подписки.
- **Регистрация TLD .i2p.alt** (RFC 9476, конец 2023 года): Официальная регистрация .i2p.alt в GANA как альтернативного TLD. Будущие обновления router могут удалять суффикс .alt, но изменения в командах подписки не требуются.
- **Постквантовая криптография** (2.10.0+): Доступна, но не используется по умолчанию. В дальнейшем планируется рассмотреть алгоритмы подписи в лентах подписки.
