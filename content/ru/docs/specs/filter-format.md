---
title: "Формат фильтра доступа"
description: "Синтаксис файлов фильтров контроля доступа для tunnel"
slug: "filter-format"
lastUpdated: "2025-10"
accurateFor: "2.10.0"
type: docs
---

Фильтры доступа позволяют операторам серверов I2PTunnel разрешать, запрещать или ограничивать входящие соединения на основе исходного Destination (уникальный адрес узла в I2P) и недавней частоты подключений. Фильтр представляет собой обычный текстовый файл с правилами. Файл читается сверху вниз, и **первое совпавшее правило применяется**.

> Изменения в определении фильтра вступают в силу **при перезапуске tunnel**. Некоторые сборки могут повторно считывать файловые списки во время работы, но планируйте перезапуск, чтобы гарантировать применение изменений.

## Формат файла

- Одно правило на строку.  
- Пустые строки игнорируются.  
- `#` начинает комментарий, который продолжается до конца строки.  
- Правила проверяются по порядку; используется первое совпадение.

## Пороговые значения

**Порог** задает, сколько попыток соединения от одного Destination (адрес назначения в I2P) допускается в скользящем временном окне.

- **Числовой формат:** `N/S` означает разрешить `N` подключений за `S` секунд. Пример: `15/5` позволяет до 15 подключений каждые 5 секунд. Попытка номер `N+1` в течение этого окна будет отклонена.  
- **Ключевые слова:** `allow` значит без ограничений. `deny` значит всегда отклонять.

## Синтаксис правил

Правила имеют вид:

```
<threshold> <scope> <target>
```
Где:

- `<threshold>` — это `N/S`, `allow` или `deny`  
- `<scope>` — один из `default`, `explicit`, `file` или `record` (см. ниже)  
- `<target>` зависит от области действия

### Правило по умолчанию

Применяется, когда не подходит ни одно другое правило. Допускается только **одно** правило по умолчанию. Если не задано, неизвестные Destinations (назначения) разрешены без ограничений.

```
15/5 default
allow default
deny default
```
### Явное правило

Указывает конкретный Destination (идентификатор назначения в I2P) по адресу Base32 (например, `example1.b32.i2p`) или по полному ключу.

```
15/5 explicit example1.b32.i2p
deny explicit example2.b32.i2p
allow explicit example3.b32.i2p
```
### Правило на основе файла

В качестве целей используются **все** назначения, перечисленные во внешнем файле. Каждая строка содержит одно назначение; допускаются комментарии `#` и пустые строки.

```
15/5 file /var/i2p/throttled.txt
deny file /var/i2p/blocked.txt
allow file /var/i2p/trusted.txt
```
> Рабочее примечание: Некоторые реализации периодически перечитывают списки файлов. Если вы редактируете список, пока tunnel работает, ожидайте небольшой задержки, прежде чем изменения будут обнаружены. Перезапустите, чтобы применить изменения сразу.

### Рекордер (плавное управление)

**Регистратор** отслеживает попытки подключения и записывает Destinations (адреса назначения в I2P), которые превышают пороговое значение, в файл. Затем вы можете сослаться на этот файл в правиле `file`, чтобы применять ограничения или блокировки к последующим попыткам.

```
# Start permissive
allow default

# Record Destinations exceeding 30 connections in 5 seconds
30/5 record /var/i2p/aggressive.txt

# Apply throttling to recorded Destinations
15/5 file /var/i2p/aggressive.txt
```
> Перед тем как полагаться на функцию записи, убедитесь, что ваша сборка её поддерживает. Используйте списки `file` для гарантированного поведения.

## Порядок вычисления

Сначала ставьте конкретные правила, затем — общие. Типичный шаблон:

1. Явные разрешения для доверенных пиров  
2. Явные запреты для известных нарушителей  
3. Файловые списки разрешения/запрета  
4. Регистраторы для постепенного ограничения скорости  
5. Правило по умолчанию на все случаи

## Полный пример

```
# Moderate limits by default
30/10 default

# Always allow trusted peers
allow explicit friend1.b32.i2p
allow explicit friend2.b32.i2p

# Block known bad actors
deny file /var/i2p/blocklist.txt

# Throttle aggressive sources
15/5 file /var/i2p/throttle.txt

# Automatically populate the throttle list
60/5 record /var/i2p/throttle.txt
```
## Примечания по реализации

- Фильтр доступа работает на уровне tunnel, до обработки приложением, поэтому нежелательный трафик может быть отклонён на ранней стадии.  
- Поместите файл фильтра в каталог конфигурации I2PTunnel и перезапустите tunnel, чтобы применить изменения.  
- Разделяйте файловые списки между несколькими tunnels, если вам нужна единая политика для всех сервисов.
