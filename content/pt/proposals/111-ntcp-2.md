---
title: "NTCP 2"
number: "111"
author: "EinMByte, original, psi, str4d, zzz"
created: "2014-02-13"
lastupdated: "2019-08-13"
status: "Closed"
thread: "http://zzz.i2p/topics/1577"
supercedes: "106"
target: "0.9.36"
implementedin: "0.9.36"
editor: "manas, str4d, zzz"
---

## Nota
Fase de proposta está encerrada.
Consulte [SPEC](/en/docs/spec/ntcp2/) para a especificação oficial.
Esta proposta ainda pode ser referenciada para informações de histórico.


## Visão Geral

Esta proposta descreve um protocolo de acordo de chave autenticado para melhorar a
resistência do [NTCP](/en/docs/transport/ntcp/) a várias formas de identificação automatizada e ataques.

A proposta está organizada da seguinte forma: os objetivos de segurança são apresentados,
seguido por uma discussão do protocolo básico. Em seguida, é dada uma especificação completa
de todas as mensagens do protocolo. Finalmente, endereços do roteador e identificação de versão
são discutidos. Um apêndice discutindo um ataque genérico a esquemas de preenchimento comuns também
está incluído, assim como um apêndice contendo uma série de candidatos para o cifrador autenticado.

Como em outros transportes I2P, o NTCP2 é definido exclusivamente
para transporte ponto-a-ponto (roteador-para-roteador) de mensagens I2NP.
Não é uma canal de dados de propósito geral.


## Motivação

Os dados do [NTCP](/en/docs/transport/ntcp/) são criptografados após a primeira mensagem (e a primeira mensagem
parece ser dados aleatórios), prevenindo assim a identificação do protocolo através de
"análise de carga útil". Ainda é vulnerável à identificação do protocolo através de
"análise de fluxo". Isso acontece porque as 4 primeiras mensagens (ou seja, o aperto de mão)
têm comprimento fixo (288, 304, 448 e 48 bytes).

Ao adicionar quantidades aleatórias de dados aleatórios a cada uma das mensagens, podemos
tornar isso muito mais difícil.

Os autores reconhecem que práticas de segurança padrão sugeririam usar
um protocolo existente como TLS, mas este é [Prop104](/en/proposals/104/) e tem seus próprios problemas.
Onde apropriado, parágrafos de "trabalho futuro" foram adicionados para
indicar recursos ausentes ou assuntos de discussão.


## Objetivos de Projeto

- Suportar NTCP 1 e 2 em uma única porta, auto-detectar e publicar como um único
  "transporte" (ou seja, [RouterAddress](/en/docs/spec/common-structures/#routeraddress/)) no [NetDB](/en/docs/how/network-database/).

- Publicar suporte apenas para versão 1, apenas para versão 2 ou 1+2 no NetDB em um campo separado, e
  ter como padrão a versão 1 apenas (não vincular suporte de versão a uma
  versão específica de roteador).

- Garantir que todas as implementações (Java/i2pd/Kovri/go) possam adicionar
  suporte à versão 2 (ou não) em seus próprios cronogramas.

- Adicionar preenchimento aleatório a todas as mensagens NTCP, incluindo mensagens
  de aperto de mão e de dados (ou seja, ofuscação de comprimento para que todas
  as mensagens não sejam múltiplos de 16 bytes). Fornecer mecanismo de opções para ambos os
  lados solicitarem preenchimento mínimo e máximo e/ou distribuição de preenchimento.
  Especificidades da distribuição de preenchimento são dependentes de implementação
  e podem ou não ser especificadas no próprio protocolo.

- Ofuscar o conteúdo das mensagens que não estão criptografadas (1 e 2),
  suficientemente para que caixas DPI e assinaturas AV não possam facilmente classificá-las.
  Também garantir que as mensagens enviadas para um único par ou conjunto de pares não
  tenham um padrão similar de bits.

- Corrigir perda de bits em DH devido ao formato Java [Ticket1112](https://trac.i2p2.i2p/ticket/1112), possivelmente
  (provavelmente?) mudando para X25519.

- Mudar para uma função real de derivação de chave (KDF) em vez de
  usar o resultado DH como está?

- Adicionar "resistência a sondagem" (como Tor chama); isso inclui resistência a repetição.

- Manter troca de chave autenticada bidirecional (2W-AKE). 1W-AKE não é suficiente
  para nossa aplicação.

- Continuar a usar assinaturas de tipo variável e comprimento variável (da
  chave de assinatura [RouterIdentity](/en/docs/spec/common-structures/#routeridentity/)) como parte da autenticação. Confiar
  em uma chave pública estática publicada no RouterInfo como outra parte da
  autenticação.

- Adicionar opções/versão no aperto de mão para futura extensibilidade.

- Adicionar resistência a segmentação TCP de MitM maliciosa, se possível.

- Não aumentar significativamente o uso de CPU necessário para
  configuração de conexão; se possível, reduzi-lo significativamente.

- Adicionar autenticação de mensagem (MAC), possivelmente HMAC-SHA256 e Poly1305,
  e remover checksum Adler.

- Encurtar e simplificar o cabeçalho I2NP:
  Encurtar a expiração para 4 bytes, como no SSU.
  Remover um byte de checksum SHA256 truncado.

- Se possível, reduzir o aperto de mão de 4 mensagens, duas viagens de ida e volta,
  para um aperto de mão de 3 mensagens, uma viagem de ida e volta, como no [SSU](/en/docs/transport/ssu/).
  Isso exigiria mover a assinatura de Bob na mensagem 4 para a mensagem 2.
  Pesquisar o motivo para 4 mensagens no arquivo de emails/status/reuniões
  de dez anos atrás.

- Minimizar a sobrecarga do protocolo antes do preenchimento. Embora
  preenchimento será adicionado, e possivelmente muito dele, a sobrecarga antes
  do preenchimento ainda é sobrecarga. Nós de baixa largura de banda devem ser
  capazes de usar NTCP2.

- Manter timestamps para detecção de repetição e desalinhamento.

- Evitar quaisquer problemas do ano 2038 nos timestamps, deve funcionar
  até pelo menos 2106.

- Aumentar o tamanho máximo da mensagem de 16K para 32K ou 64K.

- Quaisquer novos primitivos criptográficos devem estar prontamente
  disponíveis em bibliotecas para uso em implementações de roteadores Java
  (1.7), C++ e Go.

- Incluir representantes dos desenvolvedores de roteadores Java, C++,
  e Go no design.

- Minimizar mudanças (mas ainda haverá muitas).

- Suportar ambas as versões em um conjunto comum de código (isso pode não ser
  possível e é dependente da implementação, em qualquer caso).


### Não-Objetivos

- Resistência à DPI à prova de balas... isso seriam transportes plugáveis,
  [Prop109](/en/proposals/109/).

- Um transporte baseado em TLS (ou parecendo com HTTPS)... isso seria [Prop104](/en/proposals/104/).

- É OK mudar a criptografia de fluxo simétrica.

- Resistência à DPI baseada em tempo (tempo entre mensagens/atrasos podem ser
  dependentes de implementação; atrasos intra-mensagem podem ser introduzidos a qualquer
  momento, incluindo antes de enviar o preenchimento aleatório, por exemplo). Atrasos
  artificiais (o que obfs4 chama de IAT ou tempo de chegada) são independentes do
  próprio protocolo.

- Negabilidade de participar de uma sessão (há assinaturas lá).

Não-objetivos que podem ser parcialmente reconsiderados ou discutidos:

- O grau de proteção contra Inspeção Profunda de Pacotes (DPI)

- Segurança Pós-Quântica (PQ)

- Negabilidade



### Objetivos Relacionados

- Implementar um ambiente de teste NTCP 1/2


## Objetivos de Segurança

Consideramos três partes:

- Alice, que deseja estabelecer uma nova sessão.
- Bob, com quem Alice deseja estabelecer uma sessão.
- Mallory, o "homem do meio" entre Alice e Bob.

No máximo, dois participantes podem envolver-se em ataques ativos.

Alice e Bob estão ambos na posse de um par de chaves estático, que está contido
em suas [RouterIdentity](/en/docs/spec/common-structures/#routeridentity/).

O protocolo proposto tenta permitir que Alice e Bob concordem sobre uma
chave secreta compartilhada (K) sob os seguintes requisitos:

1) Segurança da chave privada: nem Bob nem Mallory aprendem nada sobre a
   chave privada estática de Alice. Simetricamente, Alice não aprende nada
   sobre a chave privada estática de Bob.

2) A chave de sessão K é conhecida apenas por Alice e Bob.

3) Sigilo proativo: a chave de sessão acordada permanece secreta no
   futuro, mesmo quando as chaves privadas estáticas de Alice e/ou Bob são
   reveladas após a chave ter sido acordada.

4) Autenticação bidirecional: Alice tem certeza de que estabeleceu uma
   sessão com Bob, e vice-versa.

5) Proteção contra DPI online: Garantir que não é trivial detectar que
   Alice e Bob estão envolvidos no protocolo usando apenas técnicas
   diretas de inspeção profunda de pacotes (DPI). Veja abaixo.

6) Negabilidade limitada: nem Alice nem Bob podem negar participação no
   protocolo, mas se qualquer uma das partes vazar a chave compartilhada, a outra parte
   pode negar a autenticidade do conteúdo dos dados transmitidos.

A proposta atual tenta fornecer todos os cinco requisitos com base no
protocolo Station-To-Station (STS) [STS]_. Observe que este protocolo também é a
base para o protocolo [SSU](/en/docs/transport/ssu/).


### Discussão Adicional sobre DPI

Assumimos dois componentes de DPI:

1) DPI Online
`````````````

DPI online inspecionando todos os fluxos em tempo real. As conexões podem ser
bloqueadas ou adulteradas de outra forma. Dados ou metadados de conexão podem ser
identificados e armazenados para análise off-line. O DPI online não tem
acesso ao banco de dados da rede I2P. O DPI online tem apenas capacidade computacional
limi...

---

Conteúdo extenso foi omitido para assegurar a fidelidade da tradução. Por favor, divida o conteúdo em porções menores para permitir uma tradução precisa.
