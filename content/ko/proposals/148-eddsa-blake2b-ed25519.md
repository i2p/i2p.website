---
title: "RedDSA-BLAKE2b-Ed25519"
number: "148"
author: "zzz"
created: "2019-03-12"
lastupdated: "2019-04-11"
status: "Open"
thread: "http://zzz.i2p/topics/2689"
---

## 개요

이 제안은 SHA-512를 대체하기 위해 개인화 문자열 및 솔트를 사용하는 BLAKE2b-512를 사용하는 새로운 서명 유형을 추가합니다. 이는 세 가지 유형의 가능한 공격을 제거합니다.

## 동기

NTCP2(제안 111) 및 LS2(제안 123)의 논의 및 설계 중에 가능한 다양한 공격과 이를 방지하는 방법을 간단히 고려했습니다. 이러한 공격 중 세 가지는 길이 확장 공격, 교차 프로토콜 공격, 중복 메시지 식별입니다.

NTCP2 및 LS2 모두에서 이러한 공격은 제안서와 직접적으로 관련이 없으며, 가능한 해법이 새로운 프리미티브를 최소화하는 목표와 상충된다고 결론지었습니다. 또한 이러한 프로토콜의 해시 함수 속도가 우리의 결정에 중요한 요소가 아니라고 판단했습니다. 따라서 해법을 별도의 제안서로 연기했습니다. LS2 사양에 일부 개인화 기능을 추가했으나, 새로운 해시 함수는 필요하지 않았습니다.

ZCash [ZCASH]_ 등의 많은 프로젝트들은 다음 공격에 취약하지 않은 최신 알고리즘을 기반으로 해시 함수와 서명 알고리즘을 사용하고 있습니다.

### 길이 확장 공격

SHA-256 및 SHA-512는 길이 확장 공격(LEA) [LEA]_에 취약합니다. 이는 데이터 자체가 서명될 때 해당됩니다. 대부분의 I2P 프로토콜(스트리밍, 데이터그램, 네트워크 데이터베이스 등)에서 실제 데이터가 서명됩니다. 예외는 SU3 파일로, 여기서는 해시가 서명됩니다. 다른 예외는 DSA(서명 유형 0)용 서명된 데이터그램으로, 여기서는 해시가 서명됩니다. 다른 서명된 데이터그램 서명 유형에서는 데이터 자체가 서명됩니다.

### 교차 프로토콜 공격

I2P 프로토콜에서 서명된 데이터는 도메인 분리가 없기 때문에 교차 프로토콜 공격(CPA)에 취약할 수 있습니다. 이는 한 컨텍스트(예, 서명된 데이터그램)에서 받은 데이터를 다른 컨텍스트(예, 스트리밍 또는 네트워크 데이터베이스)에서 유효한 서명된 데이터로 제시할 수 있게 합니다. 한 컨텍스트의 서명된 데이터가 다른 컨텍스트에서 유효한 데이터로 해석될 가능성은 적지만, 모든 상황을 분석하여 확실히 아는 것은 어렵거나 불가능합니다. 또한, 특정 컨텍스트에서는 공격자가 피해자로 하여금 다른 컨텍스트에서 유효한 데이터가 될 수 있는 특별히 조작된 데이터를 서명하도록 유도할 가능성이 있습니다. 다시 말해, 모든 상황을 분석하여 확실히 아는 것은 어렵거나 불가능합니다.

### 중복 메시지 식별

I2P 프로토콜은 중복 메시지 식별(DMI)에 취약할 수 있습니다. 이는 공격자가 두 서명된 메시지가 동일한 내용을 가지고 있는지 식별할 수 있게 할 수 있습니다. 이러한 메시지와 서명이 암호화되었다 하더라도 마찬가지입니다. I2P에서 사용하는 암호화 방법으로 인해 그 가능성은 적지만, 모든 상황을 분석하여 확실히 아는 것은 어렵거나 불가능합니다. 무작위 솔트를 추가할 수 있는 방법을 제공하는 해시 함수를 사용함으로써 동일한 데이터를 서명할 때도 모든 서명이 달라질 것입니다. 제안 123에서 정의된 Red25519가 해시 함수에 무작위 솔트를 추가하지만, 이는 암호화되지 않은 리스세트의 문제를 해결하지 못합니다.

### 속도

이 제안의 주된 동기는 아니지만, SHA-512는 상대적으로 느리며 더 빠른 해시 함수가 존재합니다.

## 목표

- 위의 공격 방지
- 새로운 암호 프리미티브의 사용 최소화
- 검증된 표준 암호 프리미티브 사용
- 표준 커브 사용
- 가능하면 더 빠른 프리미티브 사용

## 설계

기존 RedDSA_SHA512_Ed25519 서명 유형을 SHA-512 대신 BLAKE2b-512를 사용하도록 수정합니다. 각 사용 사례에 대해 고유한 개인화 문자열을 추가합니다. 새로운 서명 유형은 노 블라인드 및 블라인드 리스세트 모두에 사용할 수 있습니다.

## 정당화

- BLAKE2b는 LEA에 취약하지 않습니다 [BLAKE2]_.
- BLAKE2b는 도메인 분리를 위한 표준 방법으로 개인화 문자열을 추가할 수 있습니다.
- BLAKE2b는 DMI를 방지하기 위해 무작위 솔트를 추가할 수 있는 표준 방법을 제공합니다.
- BLAKE2b는 최신 하드웨어에서 SHA-256 및 SHA-512(및 MD5)보다 빠릅니다 [BLAKE2]_.
- Ed25519는 여전히 가장 빠른 서명 유형이며, 최소한 Java에서는 ECDSA보다 훨씬 빠릅니다.
- Ed25519 [ED25519-REFS]_는 512비트 암호화 해시 함수를 요구합니다. SHA-512를 지정하지는 않습니다. BLAKE2b는 해시 함수로 적합합니다.
- BLAKE2b는 Noise와 같은 여러 프로그래밍 언어의 라이브러리에서 널리 사용 가능합니다.

## 사양

솔트와 개인화를 사용하여 [BLAKE2]_에 설명된 대로 키 없는 BLAKE2b-512를 사용합니다. BLAKE2b 서명의 모든 사용은 16자 개인화 문자열을 사용합니다.

RedDSA_BLAKE2b_Ed25519 서명에 사용할 때, 랜덤 솔트가 허용되지만 필요하지는 않습니다. 서명 알고리즘이 80바이트의 랜덤 데이터를 추가하기 때문입니다(제안 123 참조). 필요한 경우, r을 계산하기 위해 데이터를 해싱할 때, 각 서명에 대해 새로운 BLAKE2b 16바이트 랜덤 솔트를 설정합니다. S를 계산할 때 솔트를 모두 0으로 설정합니다.

RedDSA_BLAKE2b_Ed25519 검증에 사용할 때, 랜덤 솔트를 사용하지 말고 기본값 모두 0을 사용합니다.

솔트와 개인화 기능은 [RFC-7693]_에 명시되지 않았습니다; 해당 기능은 [BLAKE2]_에 명시된 대로 사용합니다.

### 서명 유형

RedDSA_BLAKE2b_Ed25519에 대해, RedDSA_SHA512_Ed25519(제안 123에서 정의된 서명 유형 11)에서 SHA-512 해시 함수를 BLAKE2b-512로 대체합니다. 다른 변경 사항은 없습니다.

우리는 su3 파일에 대해 EdDSA_SHA512_Ed25519ph(서명 유형 8)에 대한 대체가 필요하지 않습니다. EdDSA의 사전 해시 버전은 LEA에 취약하지 않기 때문입니다. EdDSA_SHA512_Ed25519(서명 유형 7)는 su3 파일에 대해 지원되지 않습니다.

=======================  ===========  ======  =====
        유형             유형 코드    이후    사용법
=======================  ===========  ======  =====
RedDSA_BLAKE2b_Ed25519       12        TBD    라우터 식별, 목적지 및 암호화된 리스세트 전용; 라우터 식별에는 사용되지 않음
=======================  ===========  ======  =====

### 일반 구조 데이터 길이

다음은 새로운 서명 유형에 적용됩니다.

==================================  =============
            데이터 유형                길이
==================================  =============
해시                                    64
비공개 키                                32
공개 키                                  32
서명                                    64
==================================  =============

### 개인화

서명의 다양한 사용에 대한 도메인 분리를 제공하기 위해 BLAKE2b 개인화 기능을 사용할 것입니다.

BLAKE2b 서명의 모든 사용은 16자 개인화 문자열을 사용합니다. 모든 새로운 용도는 고유한 개인화를 갖는 테이블에 추가되어야 합니다.

아래의 NTCP 1 및 SSU 핸드셰이크 사용은 핸드셰이크 자체에서 정의된 서명된 데이터에 대한 것입니다. Network Database Store Messages에서의 서명된 RouterInfos는 NetDb Entry 개인화를 사용합니다. NetDB에 저장되었다면 마찬가지입니다.

==================================  ==========================
         사용법                   16자 개인화 문자열
==================================  ==========================
I2CP SessionConfig                  "I2CP_SessionConf"
NetDB Entries (RI, LS, LS2)         "network_database"
NTCP 1 handshake                    "NTCP_1_handshake"
Signed Datagrams                    "sign_datagramI2P"
Streaming                           "streaming_i2psig"
SSU handshake                       "SSUHandshakeSign"
SU3 파일                            지원하지 않음
단위 테스트                           "test1234test5678"
==================================  ==========================

## 참고

## 문제점

- 대안 1: 제안 146;
  LEA 저항 제공
- 대안 2: RFC 8032의 Ed25519ctx;
  LEA 저항 및 개인화를 제공합니다. 표준화 되었지만 누가 사용하나요?
  [RFC-8032]_ 및 [ED25519CTX]_ 참조.
- "키" 해싱이 우리에게 유용한가요?

## 마이그레이션

이전 서명 유형에 대한 롤아웃과 동일합니다.

새 라우터를 유형 7에서 유형 12로 기본값을 변경할 계획입니다. 기존 라우터를 유형 7에서 유형 12로 최종적으로 마이그레이션할 계획으로, 유형 7 도입 후 사용된 "다시 키" 프로세스를 사용합니다. 새 목적지를 유형 7에서 유형 12로 기본값을 변경할 계획입니다. 새 암호화 목적지를 유형 11에서 유형 13으로 기본값을 변경할 계획입니다.

유형 7, 11, 12에서 유형 12로의 블라인딩을 지원할 것입니다. 유형 12에서 유형 11로의 블라인딩은 지원하지 않습니다.

새 라우터는 몇 달 후에 기본적으로 새로운 서명 유형을 사용할 수 있습니다. 새 목적지는 아마 1년 후에 기본적으로 새로운 서명 유형을 사용할 수 있습니다.

최소 라우터 버전 0.9.TBD에서는 라우터가 다음을 보장해야 합니다:

- 새로운 서명 유형이 있는 RI 또는 LS를 버전 0.9.TBD 미만의 라우터에 저장(또는 전파)하지 마세요.
- NetDB 저장소를 검증할 때, 새로운 서명 유형의 RI 또는 LS를 버전 0.9.TBD 미만의 라우터에서 가져오지 마세요.
- RI에 새로운 서명 유형이 있는 라우터는 NTCP, NTCP2, 또는 SSU를 통해 버전 0.9.TBD 미만의 라우터에 연결할 수 없습니다.
- 스트리밍 연결 및 서명된 데이터그램은 버전 0.9.TBD 미만의 라우터에서 작동하지 않지만, 이를 알 방법이 없으므로, 0.9.TBD 릴리스 후 몇 개월 또는 몇 년간 기본적으로 새로운 서명 유형을 사용해서는 안 됩니다.

## 참고 문헌

.. [BLAKE2]  
   https://blake2.net/blake2.pdf

.. [ED25519CTX]  
   https://moderncrypto.org/mail-archive/curves/2017/000925.html

.. [ED25519-REFS]  
    "High-speed high-security signatures" by Daniel  
    J. Bernstein, Niels Duif, Tanja Lange, Peter Schwabe, and  
    Bo-Yin Yang. http://cr.yp.to/papers.html#ed25519

.. [EDDSA-FAULTS]  
   https://news.ycombinator.com/item?id=15414760

.. [LEA]  
   https://en.wikipedia.org/wiki/Length_extension_attack

.. [RFC-7693]  
   https://tools.ietf.org/html/rfc7693

.. [RFC-8032]  
   https://tools.ietf.org/html/rfc8032

.. [ZCASH]  
   https://github.com/zcash/zips/tree/master/protocol/protocol.pdf
