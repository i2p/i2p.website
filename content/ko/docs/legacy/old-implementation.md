---
title: "구형 tunnel 구현(레거시)"
description: "I2P 0.6.1.10 이전에 사용되던 tunnel 설계에 대한 보관된 설명."
slug: "old-implementation"
lastUpdated: "2005-06"
accurateFor: "0.6.1"
reviewStatus: "needs-review"
---

> **레거시 상태:** 이 내용은 역사적 참고용으로만 보존됩니다. 이는 I2P&nbsp;0.6.1.10 이전에 출시된 tunnel 시스템을 문서화한 것으로, 최신 개발에 사용해서는 안 됩니다. 운영 환경 지침은 [현재 구현](/docs/specs/implementation/)을 참조하십시오.

원래의 tunnel 하위 시스템도 단방향 tunnel을 사용했지만, 메시지 레이아웃, 중복 탐지, 구축 전략에서는 달랐습니다. 아래의 여러 절은 비교를 돕기 위해 사용 중단된 문서의 구조를 반영합니다.

## 1. Tunnel 개요

- tunnel은 생성자가 선택한 피어들의 순서가 지정된 시퀀스로 구축되었다.
- tunnel 길이는 0–7홉 범위였으며, 패딩, 트래픽 제한(throttling), 채프(chaff) 생성 등을 위한 여러 조절 옵션이 있었다.
- 인바운드 tunnel은 신뢰할 수 없는 게이트웨이에서 생성자(엔드포인트)로 메시지를 전달했으며; 아웃바운드 tunnel은 데이터를 생성자로부터 외부로 보냈다.
- tunnel의 수명은 10분이었으며, 그 이후에는 새로운 tunnel이 구축되었다(종종 동일한 피어를 사용하되 서로 다른 tunnel ID를 사용).

## 2. 레거시 설계에서의 동작

### 2.1 메시지 전처리

게이트웨이는 ≤32&nbsp;KB의 I2NP 페이로드를 누적하고, 패딩을 선택한 뒤, 다음을 포함하는 페이로드를 생성했다:

- 2바이트 패딩 길이 필드와 해당 길이만큼의 임의 바이트
- 전달 대상, 단편화, 선택적 지연을 설명하는 `{instructions, I2NP message}` 쌍의 시퀀스
- 16바이트 경계까지 패딩된 전체 I2NP 메시지

전송 지침은 라우팅 정보를 비트 필드(전송 유형, 지연 플래그, 조각화 플래그, 선택적 확장)로 패킹했다. 조각화된 메시지에는 4바이트 메시지 ID와 인덱스/마지막 조각 플래그가 포함되었다.

### 2.2 게이트웨이 암호화

기존 설계는 암호화 단계에서 tunnel 길이를 8홉으로 고정했다. 게이트웨이는 페이로드를 줄이지 않고 각 홉이 무결성을 검증할 수 있도록 AES-256/CBC와 체크섬 블록을 계층적으로 적용했다. 체크섬 자체는 메시지 내부에 포함된 SHA-256 기반 블록이었다.

### 2.3 참여자 동작

참여 노드들은 인바운드 tunnel ID를 추적하고, 초기에 무결성을 검증했으며, 전달하기 전에 중복 메시지를 버렸다. 패딩과 검증 블록이 내장되어 있었기 때문에 메시지 크기는 홉 수와 무관하게 일정하게 유지되었다.

### 2.4 엔드포인트 처리

종단점은 계층화된 블록을 순차적으로 복호화하고 체크섬을 검증한 뒤, 페이로드를 추가 전달을 위한 인코딩된 명령과 I2NP 메시지로 다시 분리했다.

## 3. Tunnel 구축 (사용 중단된 프로세스)

1. **피어 선택:** 피어는 로컬에서 유지되는 프로필(탐색용 vs. 클라이언트)에서 선택되었다. 원문 문서는 이미 tunnel 풀마다 정렬된 피어 목록을 재사용하여 [선행자 공격](https://en.wikipedia.org/wiki/Predecessor_attack)을 완화하는 점을 강조했다.
2. **요청 전달:** 빌드 메시지는 각 피어마다 암호화된 섹션을 포함한 상태로 홉별로 전달되었다. telescopic extension(망원경식 확장), 중간 구간 재라우팅, 또는 체크섬 블록 제거와 같은 대안도 실험적 아이디어로 논의되었으나 채택되지는 않았다.
3. **풀링:** 각 로컬 destination(목적지 식별자)은 수신(inbound)과 송신(outbound) 풀을 별도로 유지했다. 설정에는 원하는 개수, 백업 tunnel, 길이 가변성, 스로틀링, 그리고 패딩 정책이 포함되었다.

## 4. 스로틀링 및 혼합 개념

기존 문서는 이후 릴리스에 영향을 준 여러 전략을 제안했다:

- 혼잡 제어를 위한 가중 랜덤 조기 폐기(WRED)
- 최근 사용량의 이동 평균에 기반한 tunnel별 제한
- 선택적 chaff(더미 트래픽) 및 일괄 처리 제어(완전히 구현되지 않음)

## 5. 보관된 대안

원본 문서의 일부 섹션에서는 실제로 배포된 적이 없는 아이디어들을 탐구했습니다:

- 홉당 처리 부담을 줄이기 위해 체크섬 블록 제거
- 피어 구성을 변경하기 위해 중간 과정에서 tunnels에 telescoping(단계적으로 확장하는 방식) 적용
- 양방향 tunnels로 전환(최종적으로 기각됨)
- 더 짧은 해시 또는 다른 패딩 방식 사용

이러한 아이디어들은 가치 있는 역사적 맥락으로 남아 있지만, 최신 코드베이스를 반영하지는 않습니다.

## 참고 자료

- 원본 레거시 문서 아카이브(pre-0.6.1.10)
- [Tunnel 개요](/docs/overview/tunnel-routing/) 현재 용어에 대한 안내
- [피어 프로파일링 및 선택](/docs/overview/tunnel-routing#peer-selection/) 최신 휴리스틱에 대한 안내
