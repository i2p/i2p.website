---
title: "NTCP(TCP 기반 전송 프로토콜) 논의"
description: "NTCP 및 SSU 트랜스포트를 비교하는 역사적 노트와 제안된 튜닝 아이디어"
slug: "ntcp"
layout: "single"
reviewStatus: "needs-review"
---

## NTCP 대 SSU 논의 (2007년 3월)

### NTCP 질문

_IRC에서 zzz와 cervantes가 나눈 대화를 바탕으로 재구성한 것입니다._

- **NTCP가 오버헤드와 지연을 추가하는 것처럼 보이는데도 왜 SSU보다 우선시되나요?**  
  NTCP는 일반적으로 기존 SSU 구현보다 더 높은 신뢰성을 제공합니다.
- **NTCP 위에서 스트리밍을 하면 고전적인 TCP-over-TCP collapse(TCP 위에 TCP를 중첩해 사용할 때 발생하는 성능 붕괴 현상)에 부딪히나요?**  
  그럴 수 있습니다. 다만 SSU는 경량 UDP 옵션으로 설계되었지만 실제로는 신뢰성이 너무 낮은 것으로 드러났습니다.

### “NTCP는 해롭다” (zzz, 2007년 3월 25일)

요약: NTCP의 더 높은 지연 시간과 오버헤드는 혼잡을 유발할 수 있지만, 라우팅은 SSU보다 낮은 bid 점수(입찰 점수)가 하드코딩되어 있기 때문에 NTCP를 선호한다. 해당 분석은 여러 가지 쟁점을 제기했다:

- 현재 NTCP는 SSU보다 더 낮은 bid(전송 비용 지표)를 제시하므로, SSU 세션이 이미 설정되어 있지 않은 한 routers는 NTCP를 선호한다.
- SSU는 엄격히 제한된 타임아웃과 통계를 바탕으로 확인 응답(ACK)을 구현한다; NTCP는 훨씬 길 수 있는 RFC 스타일의 타임아웃을 사용하는 Java NIO TCP에 의존한다.
- 대부분의 트래픽(HTTP, IRC, BitTorrent)은 I2P의 스트리밍 라이브러리를 사용하며, 이는 사실상 NTCP 위에 TCP를 적층하는 것이다. 두 계층이 모두 재전송하면 혼잡 붕괴가 발생할 수 있다. 고전적 참고 자료로는 [TCP over TCP is a bad idea](http://sites.inka.de/~W1011/devel/tcp-tcp.html)이 있다.
- 0.8 릴리스에서 스트리밍 라이브러리의 타임아웃은 10초에서 45초로 증가했다; SSU의 최대 타임아웃은 3초인 반면, NTCP의 타임아웃은 60초에 근접하는 것으로 추정된다(RFC 권고). NTCP 매개변수는 외부에서 관측하기 어렵다.
- 2007년 현장 관측에서는 i2psnark 업로드 처리량이 요동했으며, 주기적 혼잡 붕괴를 시사했다.
- 효율성 테스트(SSU 선호 강제)는 tunnel 오버헤드 비율을 대략 3.5:1에서 3:1로 낮추고, 스트리밍 지표들(윈도 크기, RTT, 송신/ACK 비율)을 개선했다.

#### 2007년 스레드에서 나온 제안들

1. **전송 우선순위를 전환**하여 routers가 SSU를 선호하도록 (`i2np.udp.alwaysPreferred` 복원).
2. **스트리밍 트래픽에 태그를 지정**하여 익명성을 훼손하지 않으면서 SSU가 태그된 메시지에 대해서만 bid(선호도 점수)를 낮추도록.
3. **SSU 재전송 한계를 강화**하여 붕괴 위험을 줄이기.
4. **semi-reliable underlays(부분 신뢰성 하부 계층)를 연구**하여 스트리밍 라이브러리 아래에서의 재전송이 순이익인지 판단.
5. **우선순위 큐와 타임아웃을 재검토**—예를 들어, NTCP에 맞추기 위해 스트리밍 타임아웃을 45 s를 초과하도록 늘리기.

### jrandom의 답변 (2007년 3월 27일)

핵심 반론:

- NTCP는 초기 SSU 도입이 혼잡 붕괴(congestion collapse)를 겪었기 때문에 존재한다. 홉당 재전송률이 다소 낮더라도 다중 홉 tunnels 전반에서 폭증할 수 있다.
- tunnel 수준의 확인 응답이 없으면, 메시지의 일부만 종단 간(end-to-end) 전달 상태를 확인할 수 있으며, 실패는 감지되지 않은 채 발생할 수 있다.
- TCP 혼잡 제어는 수십 년에 걸쳐 최적화되어 왔으며, NTCP는 성숙한 TCP 스택을 통해 이를 활용한다.
- SSU를 선호할 때 관찰된 효율성 향상은 프로토콜 자체의 고유한 이점이라기보다 router의 큐잉 동작을 반영한 것일 수 있다.
- 더 긴 스트리밍 타임아웃은 이미 안정성을 개선하고 있었으며, 큰 변경 전에 추가적인 관찰과 데이터 수집이 권장되었다.

그 논쟁은 이후 전송 튜닝을 개선하는 데 도움이 되었지만 현대적인 NTCP2/SSU2 아키텍처를 반영하지는 않는다.
