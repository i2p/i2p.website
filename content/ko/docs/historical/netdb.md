---
title: "네트워크 데이터베이스 논의"
description: "floodfill, Kademlia(분산 해시 테이블 알고리즘) 실험, 그리고 netDb를 위한 향후 조정에 관한 역사적 기록"
slug: "netdb"
reviewStatus: "needs-review"
---

> **참고:** 이 아카이브된 논의는 네트워크 데이터베이스(netDb)에 대한 과거 접근 방식을 개괄합니다. 최신 동작과 지침은 [주요 netDb 문서](/docs/specs/common-structures/)를 참고하세요.

## 역사

I2P의 netDb는 간단한 floodfill 알고리즘을 사용해 분산됩니다. 초기 릴리스에서는 대체 수단으로 Kademlia DHT(분산 해시 테이블 알고리즘) 구현도 유지했지만, 신뢰성이 떨어지는 것으로 드러나 0.6.1.20 버전에서 완전히 비활성화되었습니다. floodfill 설계는 게시된 엔트리를 참여 중인 router로 전달하고 확인을 기다린 뒤, 필요하면 다른 floodfill 피어들과 재시도합니다. floodfill 피어들은 non-floodfill router에서 온 저장 메시지를 다른 모든 floodfill 참가자에게 브로드캐스트합니다.

2009년 말에 Kademlia(분산 해시 테이블 알고리즘) 조회가 개별 floodfill routers에 대한 저장소 부담을 줄이기 위해 부분적으로 재도입되었다.

### Floodfill 소개

Floodfill은 릴리스 0.6.0.4에서 처음 등장했고, Kademlia(분산 해시 테이블(DHT) 프로토콜)는 백업으로 남아 있었습니다. 당시 심한 패킷 손실과 제한된 경로 때문에 가장 가까운 네 개의 피어로부터 확인 응답을 받기가 어려웠고, 중복된 저장 시도를 수십 번 해야 하곤 했습니다. 외부에서 접근 가능한 routers의 floodfill 부분집합으로 전환하는 것은 실용적인 단기 해결책을 제공했습니다.

### Kademlia(분산 해시 테이블 프로토콜) 다시 생각하기

검토한 대안으로는 다음이 있습니다:

- 참여에 옵트인한 도달 가능한 routers로 제한된 Kademlia DHT(카덴밀리아 분산 해시 테이블)로 netDb를 운영하기
- floodfill 모델을 유지하되, 참여를 역량 있는 routers로 제한하고 무작위 점검으로 분산 상태를 검증하기

floodfill 접근 방식이 배치하기가 더 쉽고 netDb가 사용자 페이로드가 아닌 메타데이터만 보유하기 때문에 우위를 점했습니다. 대부분의 목적지는 송신자가 보통 자신의 LeaseSet을 garlic messages(여러 메시지를 함께 묶어 암호화해 전달하는 I2P 메시지 형식)로 함께 담아 보내기 때문에 LeaseSet을 별도로 공개하지 않습니다.

## 현재 상태(역사적 관점)

netDb 알고리즘은 네트워크의 요구에 맞게 조정되어 왔으며, 역사적으로 수백 대의 router를 무리 없이 처리해 왔습니다. 초기 추정에 따르면 3–5대의 floodfill router만으로도 대략 10,000개의 노드를 지원할 수 있는 것으로 여겨졌습니다.

### 업데이트된 계산(2008년 3월)

```
recvKBps = N * (L + 1) * (1 + F) * (1 + R) * S / T
```
여기서:

- `N`: 네트워크의 Routers(라우터) 수
- `L`: router당 클라이언트 목적지의 평균 수 (`RouterInfo`용으로 하나 추가)
- `F`: Tunnel(터널) 실패율
- `R`: tunnel 수명 대비 tunnel 재구축 기간의 비율
- `S`: netDb(네트워크 데이터베이스) 엔트리의 평균 크기
- `T`: tunnel 수명

2008년 당시의 값들(`N = 700`, `L = 0.5`, `F = 0.33`, `R = 0.5`, `S = 4 KB`, `T = 10 minutes`)을 사용하면 결과는 다음과 같습니다:

```
recvKBps ≈ 700 * (0.5 + 1) * (1 + 0.33) * (1 + 0.5) * 4 KB / 10m ≈ 28 KBps
```
### Kademlia(카덴밀리아 분산 해시 테이블 알고리즘)가 돌아올까?

개발자들은 2007년 초 무렵 Kademlia(분산 해시 테이블 알고리즘)의 재도입을 논의했다. 합의는 필요에 따라 floodfill 용량을 점진적으로 확장할 수 있는 반면, Kademlia는 기본 router 집단에 상당한 복잡성과 자원 요구 사항을 추가한다는 것이었다. floodfill 용량이 부족해지지 않는 한 대체안은 비활성 상태로 남아 있다.

### Floodfill 용량 계획

bandwidth-class `O` router를 floodfill에 자동으로 편입하는 것은 매력적으로 보이지만, 적대적인 노드가 참여할 경우 서비스 거부(DoS) 시나리오의 위험이 있다. 과거 분석에 따르면 floodfill 풀을 제한하는 것(예: 피어 3–5개가 ~10K routers를 처리)은 더 안전한 것으로 나타났다. 신뢰할 수 있는 운영자 또는 자동 휴리스틱을 사용하여 충분하면서도 통제된 floodfill 집합을 유지해 왔다.

## Floodfill TODO (역사 기록용)

> 이 섹션은 기록 보존을 위해 유지됩니다. 메인 netDb 페이지는 현재 로드맵과 설계 고려 사항을 추적합니다.

운영상의 사건들, 예를 들어 2008년 3월 13일에 이용 가능한 floodfill router가 단 하나뿐이었던 기간 등은 0.6.1.33부터 0.7.x까지의 릴리스에 반영된 여러 개선으로 이어졌으며, 다음을 포함합니다:

- 검색 시 floodfill 선택 무작위화 및 반응성이 좋은 피어 우선
- router 콘솔 "Profiles" 페이지에 추가 floodfill 메트릭 표시
- floodfill 대역폭 사용량 절감을 위한 netDb 엔트리 크기 점진적 축소
- 프로파일 데이터로 수집한 성능 기반의 class `O` routers 일부 자동 참여
- 블록리스트 강화, floodfill 피어 선택 및 탐색 휴리스틱 개선

해당 기간에 남아 있던 아이디어는 다음과 같다:

- `dbHistory` 통계를 활용하여 floodfill 피어를 더 정확하게 평가하고 선택하기
- 장애가 발생하는 피어에 반복적으로 연결하지 않도록 재시도 동작 개선
- 선정 시 지연 시간 메트릭과 통합 점수 활용
- 장애가 발생한 floodfill router를 더 빠르게 감지하고 대응하기
- 고대역폭 및 floodfill 노드에 대한 자원 요구를 지속적으로 줄이기

이 노트가 작성된 시점에도 네트워크는 복원력이 높은 것으로 여겨졌으며, 악의적인 floodfill 또는 floodfill을 표적으로 한 서비스 거부(DoS) 공격에 신속히 대응할 수 있는 인프라가 갖춰져 있었다.

## 추가 참고 사항

- router 콘솔은 floodfill의 신뢰성을 분석하는 데 도움이 되도록 확장된 프로필 데이터를 오랫동안 제공해 왔다.
- 과거의 논의에서는 Kademlia(분산 해시 테이블 프로토콜)나 대안적 DHT(분산 해시 테이블) 체계를 거론했지만, floodfill은 운영 네트워크의 주요 알고리즘으로 남아 있었다.
- 미래 지향적 연구는 남용 기회를 제한하면서 floodfill 참여 선정(admission) 절차를 적응형으로 만드는 데 초점을 맞췄다.
