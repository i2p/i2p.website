---
title: "Tunnel 讨论"
description: "对 tunnel 填充、分片和构建策略的历史性探讨"
slug: "tunnel"
layout: "single"
lastUpdated: "2019-07"
accurateFor: "0.9.41"
reviewStatus: "needs-review"
---

> **注意：** 此归档收录了早于 I2P 0.9.41 的探索性设计工作。有关生产级实现，请参阅 [tunnel 文档](/docs/specs/implementation/)。

## 替代的配置方案

针对未来的 tunnel 可调参数，所考虑的想法包括：

- 用于消息投递的频率限流机制
- 填充策略（包括 chaff injection（诱饵流量注入））
- Tunnel 生命周期控制
- 用于有效载荷分发的批处理与队列策略

这些选项未随遗留实现提供。

## 填充策略

已讨论的潜在填充方案：

- 不进行任何填充
- 随机长度填充
- 固定长度填充
- 填充到最接近的千字节
- 填充到 2 的幂（`2^n` 字节）

早期的测量（0.4 版本）促成了当前固定的 1024 字节 tunnel 消息大小。更高层的 garlic 消息（I2P 中将多个消息打包在一起的消息格式）可能会添加其自身的填充。

## 分片

为防止通过消息长度进行的标记攻击，tunnel 消息固定为 1024 字节。更大的 I2NP 负载会由网关分片；端点会在短暂的超时时间内重组这些分片。router 可能会在发送前重新排列分片，以最大化填充效率。

## 其他替代方案

### 中途调整 Tunnel 处理

考察了三种可能性：

1. 允许中间跳点通过授予其对解密后有效载荷的访问权限，临时终止一个 tunnel。
2. 允许参与的 routers 在继续转发到下一跳之前，先将消息通过其自身的一条出站 tunnel 发送，以对消息进行“重混”。
3. 使 tunnel 的创建者能够动态地重新定义某个对等方的下一跳。

### 双向 Tunnels

使用彼此独立的入站和出站 tunnels 可以限制任何单一组对等节点所能观测到的信息（例如，GET 请求与大型响应）。双向 tunnels 简化了对等节点管理，但会同时向两个方向暴露完整的流量模式。因此，单向 tunnels 仍是首选的设计。

### 反向通道与可变大小

允许可变的 tunnel 消息大小会使串通的对等节点之间能够建立隐蔽信道（例如，通过选定的大小或频率来编码数据）。固定大小的消息可以缓解这一风险，但代价是增加额外的填充开销。

## Tunnel 构建的替代方案

参考：[Hashing it out in Public](http://www-users.cs.umn.edu/~hopper/hashing_it_out.pdf)

### 遗留“并行”构建方法

在 0.6.1.10 发布之前，tunnel 构建请求会并行发送给每个参与者。该方法记录在[旧版 tunnel 页面](/docs/legacy/old-implementation/)上。

### 一次性伸缩式构建（当前方法）

现代方法是通过部分构建的 tunnel 逐跳发送构建消息。尽管这与 Tor 的 telescoping（逐段扩展）相似，但通过探索型 tunnels 路由构建消息可以减少信息泄露。

### “交互式” 伸缩法

以显式的往返通信逐跳构建，会使对等节点能够统计消息数量并推断其在 tunnel 中的位置，因此这种方法被拒绝。

### 非探索型管理 Tunnels

有一项提议是为构建流量维护一组单独的管理用 tunnels 池。尽管这可能有助于处于分区状态的 routers，但在网络整合充分的情况下，被认为没有必要。

### 探索性投递（旧版）

在 0.6.1.10 之前，单个 tunnel 请求会使用 garlic encryption 加密，并通过 exploratory tunnels 发送，回复则单独返回。该策略已被当前的 one-shot telescoping 方法（一次性逐段扩展的方法）所取代。

## 要点

- 固定大小的 tunnel 消息可防范基于大小的标记与隐蔽信道，尽管这会增加填充开销。
- 曾探索过替代性的填充、分片与构建策略，但在权衡匿名性取舍后未予采用。
- Tunnel 设计继续在效率、可观测性与对前驱攻击和拥塞攻击的抗性之间进行权衡。
