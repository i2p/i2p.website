---
title: "Red25519 签名方案"
description: "用于创建盲化 Destinations（I2P 中的终端标识）的可重随机化签名方案"
slug: "red25519-signature-scheme"
lastUpdated: "2025-10"
accurateFor: "2.10.0"
---

## 概述

本文档规定了一种可重随机化的签名方案，适用于创建可盲化的 Destinations（目的地）。此外，它还可用于对现有的 Ed25519 Destinations 进行盲化，但有效性会略有降低。

自 0.9.39 版（发布于 2019 年 3 月 21 日）起，Red25519 已在 I2P router 上全面投入运行。经过 17 个月的生产环境部署后，该规范在 0.9.47 版（2020 年 8 月）中最终定稿。该签名方案在 I2P 网络中作为签名类型 11（RedDSA_SHA512_Ed25519）运行。

## 动机

提案 123（新的 netDB 条目）定义了一种加密的 LeaseSet2 格式，它体现了最小权限原则：每个网络参与者只会获得其角色所必需的信息。尤其是，发布到 floodfill 的加密 LeaseSet2 不会暴露其对应的 Destination（目标标识），并且其中的租约只能被事先知晓该 Destination 的一方查看。不过，各个 floodfill 在发布加密的 LeaseSet2 时仍需要能够对其进行认证，而客户端还需要进一步确保该认证确实由 Destination 本身强制执行。

提案 123 通过对 Destination（目的地标识）的签名密钥进行盲化来实现这一点。盲化后的密钥可用于创建可被 floodfills 验证的签名，客户端可以确信只有该 Destination 才能创建这些签名。因此有必要指定一种可用于盲化的签名方案。

**关于提案 123 状态的说明**: 自 0.9.38 版本起，提案 123 的部分内容已逐步实现并部署，并在 0.9.39 中加入了 Red25519 支持。加密的 LeaseSet2 功能已达到生产就绪状态，并已在 I2P 网络中积极用于隐私增强型隐藏服务。

## 设计

### 核心签名方案

此处指定的签名方案 Red25519，是 Zcash 协议规范（Sapling 及之后版本）第 5.4.6 节中定义的 RedDSA 的一个实例化。RedDSA 是一种基于 Schnorr 的签名方案，支持密钥重随机化。它提供以下函数：

**GENERATE_PRIVATE()** : 返回一个均匀分布的随机私钥。

**DERIVE_PUBLIC(sk)** : 返回与给定私钥对应的公钥。

**GENERATE_RANDOM()** : 返回一个适用于对密钥对重新随机化的随机标量。

**RANDOMIZE_PRIVATE(sk, alpha)** : 使用秘密标量 alpha 对私钥进行重新随机化。

**RANDOMIZE_PUBLIC(vk, alpha)** : 使用秘密标量 alpha 对公钥进行重随机化。

**SIGN(sk, m)** : 返回由私钥 sk 对给定消息 m 生成的签名。

**VERIFY(vk, m, sig)** : 根据公钥 vk 和消息 m 验证签名 sig。若签名有效则返回 true，否则返回 false。

对于给定的密钥对 (sk, vk)，以下关系成立：

```
RANDOMIZE_PUBLIC(vk, alpha) == DERIVE_PUBLIC(RANDOMIZE_PRIVATE(sk, alpha))
```
### 将 Ed25519（椭圆曲线签名算法）密钥转换为 Red25519（基于 Ed25519 的签名变体）

为支持对现有的 Ed25519 Destination（目的地标识）进行重新随机化，Ed25519 密钥可以被临时地单向转换为 Red25519 密钥。其他签名类型不兼容。

我们定义以下转换函数：

**CONVERT_ED25519_PRIVATE(privkey)** : 返回与给定的 Ed25519 私钥对应的 Red25519 私钥。

**CONVERT_ED25519_PUBLIC(pubkey)** : 返回与给定 Ed25519 公钥相对应的 Red25519 公钥（Ed25519 公钥的转换表示）。

对于给定的 Ed25519 密钥对 (privkey, pubkey)，满足以下关系：

```
CONVERT_ED25519_PUBLIC(pubkey) == DERIVE_PUBLIC(CONVERT_ED25519_PRIVATE(privkey))
```
## 规范

### 定义

**B** : 与 [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html) 中的 Ed25519 基点相同。

**L** : Ed25519 的阶为 2^252 + 27742317777372353535851937790883648493，如 [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html) 所述。

**[s] B** : 用 s 对基点进行固定基标量乘法。

**[s] A** : 用标量 s 对 A 进行可变基点标量乘法。

**x || y** : 拼接两个字节数组 x 和 y。

### Red25519（I2P 中使用的一种签名算法类型）

Red25519 方案对 RedDSA 的专化如下：

- G := Curve25519 的 Edwards 形式上的点群。更具体地说，这意味着 Red25519 使用阶为 L 的素阶子群，且余因子 h_G 为 8。
- P_G := Ed25519 的基点 B。
- l_H := 512
- H(x) := SHA-512("I2P_Red25519H(x)" || x)

**关于哈希函数选择的说明**：Red25519 使用 SHA-512，而非 BLAKE2b-512（Zcash 的 RedDSA 使用 BLAKE2b-512）。该设计取舍由下文所述的长度前缀保护加以弥补。I2P 提案 148 建议未来迁移到 BLAKE2b-512，以增强对重复消息识别（Duplicate Message Identification，DMI）和长度扩展攻击（Length Extension Attacks，LEA）的防护，并提升性能。

RedDSA 假设 H(x) 由一种能抵御长度扩展攻击的密码学哈希函数实例化。SHA-512 本身并不满足这一点。为解决这一问题，我们要求在消息前加上其长度的无前缀编码作为前缀：

```
len_u16(M) || M
```
其中 `len_u16(M)` 是 M 的长度的 2 字节表示，采用小端序（以与标量和点的小端编码保持一致）。

消息不得长于 65534 字节。长度 65535 被保留用于未来可能的扩展。

**安全说明**: 在哈希函数中包含公钥（vk），并在签名过程中加入80个随机字节，可防御在早期 RedDSA 设计中发现的 SURK-CMA（在选择消息攻击下使用重新随机化密钥的强不可伪造性）漏洞。本实现采纳了 NCC Group 对 Zcash 审计中的安全修复（发现编号 NCC-Zcash2018-009）。

### 编码与解码

Red25519 私钥是模 L 的标量，采用小端序表示进行编码。我们定义函数 `DECODE_SCALAR` 和 `ENCODE_SCALAR`，用于在标量的字节数组形式与整数形式之间进行转换。

Red25519（使用 Curve25519 的 Edwards 形式）公钥是 Curve25519 的 Edwards 形式上的点。其编码为 y 坐标的 255 位小端表示，后跟一个用于指示 x 坐标符号的单个比特。这与 Ed25519 的编码相同。我们定义了函数 `DECODE_POINT` 和 `ENCODE_POINT`，用于在点的字节数组形式与坐标形式之间进行转换。

### RedDSA 函数

为便于实现，我们在下文明确列出已针对 Red25519（RedDSA 的一种特定实现）专门化的 RedDSA（数字签名算法）函数，以及若干辅助函数。实现者应参考 Zcash Protocol Specification（Zcash 协议规范）第 5.4.6 节，了解 RedDSA 函数的一般性规范。

```
HStar(prefix1, prefix2, m) :=
    h = SHA-512()
    h.input("I2P_Red25519H(x)")
    h.input(prefix1)
    h.input(prefix2)

    h.input(len(m) & 0xff)
    h.input((len(m) >> 8) & 0xff)
    h.input(m)

    s = h.digest()
    return s mod L

GENERATE_PRIVATE :=
    s = 64 random bytes
    return s mod L

DERIVE_PUBLIC(sk) := [sk] B

GENERATE_RANDOM :=
    s = 64 random bytes
    return s mod L

RANDOMIZE_PRIVATE(sk, alpha) := (sk + alpha) mod L

RANDOMIZE_PUBLIC(vk, alpha) := vk + [alpha] B

SIGN(sk, m) :=
    T = 80 random bytes
    vkBytes = ENCODE_POINT(DERIVE_PUBLIC(sk))
    r = HStar(T, vkBytes, m)

    R = [r] B
    Rbytes = ENCODE_POINT(R)

    c = HStar(Rbytes, vkBytes, m)
    S = (r + (c * sk)) mod L

    return Rbytes || ENCODE_SCALAR(S)

VERIFY(vk, m, sig) :=
    Rbytes = sig[0..32]
    Sbytes = sig[32..64]

    R = DECODE_POINT(Rbytes)
    if R is invalid:
        return false

    S = DECODE_SCALAR(Sbytes)
    if S >= L:
        return false

    vkBytes = ENCODE_POINT(vk)
    c = HStar(Rbytes, vkBytes, m)
    return ((-[S] B) + R + ([c] vk)).multiplyByCofactor().isIdentity()
```
### 转换函数

```
CONVERT_ED25519_PRIVATE(privkey) :=
    s = SHA-512(privkey)[0..32]
    s[0] = s[0] & 248
    s[31] = (s[31] & 63) | 64
    return s

CONVERT_ED25519_PUBLIC(pubkey) := pubkey
```
注意，`CONVERT_ED25519_PRIVATE` 的实现等同于在从 Ed25519 私钥派生 Ed25519 公钥时对秘密标量 s 的计算，如 [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html) 第 5.1.5 节的步骤 1-3 所述。

## 安全影响

对一个 Red25519 Destination（目标地址）进行重新随机化，然后使用它创建签名，并不会泄露关于该 Destination 的任何信息，因为通过 `RANDOMIZE_PRIVATE` 生成的 Red25519 私钥的分布与通过 `GENERATE_PRIVATE` 生成的私钥分布完全相同，而且 `DERIVE_PUBLIC` 是确定性的。

通过 `CONVERT_ED25519_PRIVATE` 将 Ed25519 私钥转换为 Red25519（Ed25519 密钥的一种重新映射/重新编码形式）并不会得到相同的分布。然而，基于以下原因，我们认为这种安全性降低是可以接受的：

- Ed25519 标量的取值空间大约只有 Red25519 标量空间的一半（共有 2^251 个可能的 Ed25519 标量，而 Red25519 则有 L ~= 2^252 个可能的标量）。因此，安全性损失至多约为 2 倍，或约 1 比特（因为我们可能碰巧选到一个同时也是有效 Ed25519 标量的 Red25519 标量）。
- 现有的 Ed25519 Destination（I2P 目标地址标识）过去已在网络上暴露，应当假定恶意的 floodfills（负责 netDb 填充与索引的节点）已经对它们进行了枚举。

**重要**: 对该安全性降低感到担忧的用户应将其 Destinations（目标标识）的 sigtype 设为 Red25519（签名类型 11），而非 Ed25519（签名类型 7）。

请注意，上述论证不适用于 re-randomization scalar alpha（再随机化用的标量 alpha）；每当选择一个有偏的 alpha 时，都会泄露关于密钥的信息，因为加性再随机化的行为类似于一次性密码本。

### 安全审计状态

**重要披露**：I2P（包括 Red25519（基于 curve25519 的数字签名方案））从未接受过正式的第三方安全审计。其底层的 RedDSA（一种数字签名算法）设计在 2018 年作为 Zcash Sapling 协议审计的一部分由 NCC Group 进行过安全评审，当时识别并修复了安全问题。然而，I2P 使用 SHA-512（而非 BLAKE2b-512）以及 I2P 的域分离的特定实现尚未经过独立分析。

由 str4d 编写的 ed25519-java 参考实现曾接受过一次独立的第三方审计，但该审计早于 Red25519 的实现，且仅涵盖 Ed25519（基于椭圆曲线的签名算法）的功能，未涉及 Red25519（Ed25519 的扩展）相关功能。

部署 Red25519 的用户应了解这一限制，并根据其威胁模型评估安全权衡。

## 兼容性

支持 Red25519（签名算法类型）的 I2P 版本（0.9.39 及更高版本）将能够验证使用该算法签名的网络数据结构。不支持 Red25519 的 I2P 版本会将其视为未知签名，并可能（MAY）丢弃这些数据结构。

**部署时间线**: - **0.9.39** (2019 年 3 月): 首次实现，在 floodfills 中加入对 Encrypted LS2 的支持 - **0.9.40** (2019 年 5 月): 为 Encrypted LS2 提供按客户端授权 - **0.9.41** (2019 年 8 月): Meta LS2 和带离线密钥的 Encrypted LS2 - **0.9.43** (2020 年 2 月): 为 Encrypted LS2 提供 b32 支持 - **0.9.47** (2020 年 8 月): 规范定稿 - **2.10.0** (2025 年 10 月): 当前网络版本 (等同于 0.9.67+)

用户可预期，采用 Red25519（I2P 使用的一种签名算法）签名的数据结构在加密的 LeaseSet2 用例中具有良好可靠性，因为自最初实现以来，网络已有超过六年的升级窗口。然而，关于一般 destination（I2P 目标标识）使用的采用情况指标尚未公开。

**主要使用场景**: Red25519 主要用于需要密钥盲化（key blinding）的加密 LeaseSet2 功能。对于没有加密 leaseset 需求的标准目的地，Ed25519（签名类型 7）由于兼容性更广且拥有更长时间的验证记录，仍是推荐的选择。

## 实现说明

Red25519 在 I2P Java router 中由 `net.i2p.crypto.eddsa.RedDSAEngine` 实现，并将 str4d（Jack Grigg）编写的 ed25519-java 库作为 Maven 依赖 `net.i2p.crypto:eddsa`（版本 0.1.0 至 0.3.0）。

i2pd 的 C++ 实现也支持 Red25519（signaturetype=11），用于发布加密的 LeaseSet。

i2pd 的配置示例：

```
signaturetype=11
i2cp.leaseSetType=5
```
**加密的 LeaseSet2 兼容性**: 加密的 LeaseSet 规范要求，unblinded destination（未去盲的 destination）中的签名公钥必须为 Ed25519 (signature type 7) 或 Red25519 (signature type 11)。对于加密的 leaseset 功能，不支持其他签名类型。

## 测试向量

下列测试向量用于验证实现。每个向量包括：

- `edsk`: Ed25519 私钥（随机）
- `edpk`: 与 edsk 对应的 Ed25519 公钥
- `sk`: CONVERT_ED25519_PRIVATE(edsk)
- `vk`: CONVERT_ED25519_PUBLIC(edpk)
- `msg`: 待签名的消息
- `sig`: SIGN(sk, msg)
- `alpha`: GENERATE_RANDOM()
- `rsk`: RANDOMIZE_PRIVATE(sk, alpha)
- `rvk`: RANDOMIZE_PUBLIC(vk, alpha)
- `rsig`: SIGN(rsk, msg)

**实现说明**：这些测试向量应集成到自动化单元测试套件中，以实现持续验证。实现者应验证所有转换、签名以及重新随机化操作与这些期望值一致。

### 测试向量 1

```
edsk:  0101010101010101010101010101010101010101010101010101010101010101
edpk:  8a88e3dd7409f195fd52db2d3cba5d72ca6709bf1d94121bf3748801b40f6f5c
sk:    58e86efb75fa4e2c410f46e16de9f6acae1a1703528651b69bc176c088bef36e
vk:    8a88e3dd7409f195fd52db2d3cba5d72ca6709bf1d94121bf3748801b40f6f5c
msg:   0202020202020202020202020202020202020202020202020202020202020202
sig:   61f5527f4d3b46de4b2c234390370bf715ae9098907a0d191ba1b44b23a8ac1a
       6a40437a5294e9503faaf9bd2b7f2fe7ba44dec487b3185aba7ff7d7a17cd40f
alpha: ae9ba9cbbc047c442448fca7c9f4e288a202ed520bfad0c784b792b7773cee08
rsk:   8bb85f3c7a494a08890d7d142109c1a3501d04565d80227e2079097800fbe107
rvk:   6fe128737b8e76fa66698a748b0dc0a89168dd8a0601c2b1c0b26835d323e9b3
rsig:  533053074d3b44f08723aab988ede9880a001b7a684d4a98f2d1b88fabee07a5
       b5c9430c69a690321e0cb8365d7aeb6688bcbad2c0780e0c69e8a1b4a45f3001
```
### 测试向量 2

```
edsk:  0202020202020202020202020202020202020202020202020202020202020202
edpk:  8139770ea87d175f56a35466c34c7ecccb8d8a91b4ee37a25df60f5b8fc9b394
sk:    a83c626bc9c38c8c201878ebb1d5b0b50ac40e8986c78793db1d4ef369fca14e
vk:    8139770ea87d175f56a35466c34c7ecccb8d8a91b4ee37a25df60f5b8fc9b394
msg:   0303030303030303030303030303030303030303030303030303030303030303
sig:   0829e58eb5399870f009bd1f0270264e556424bda7a93fbcec99f6d9d75db46d
       5c3cb546d9947ca7c1200876c8775a90c357a2aef3d2f16388242ee1914b1a0a
alpha: 98b615d9027e996cc2796c019d9c8beb46aa7d2b6eea2e5d98eb29eb1584c203
rsk:   9fcfaa734852ca40b3810ebef590e138516e8cb4f4b1b6f0730978de7f806402
rvk:   527e121090158419609e4a0d8de6f7d3271b353a8cd0b8172fe41468ea1e9177
rsig:  9a6961f35ed264a946cd6214b2326a6e6caa426c2a61bc14367fd278e0b5fb51
       3ac065a69210a457f17d12ba8a496cfd835002691affa8efcdecae48135c090f
```
**注意**：附加的测试向量 3-10 遵循相同的格式，可在参考实现中找到。

## 参考资料

- [提案 123：新的 netDB 条目](/proposals/123-new-netdb-entries/) - 部分已在 0.9.38、0.9.39 及后续版本中实现并部署
- [Zcash 协议规范，第 5.4.6 节：RedDSA、RedJubjub 和 RedPallas](https://zips.z.cash/protocol/protocol.pdf) - RedDSA 作为 Zcash 协议规范的一部分被定义；已由 NCC Group 进行安全审计（2019 年 1 月）
- [RFC 8032：Edwards 曲线数字签名算法（EdDSA）](https://www.rfc-editor.org/rfc/rfc8032.html)
- [提案 148：RedDSA-BLAKE2b-Ed25519](/proposals/148-eddsa-blake2b-ed25519/) - 已提出但尚未实现；建议未来迁移至 BLAKE2b-512
- [加密 LeaseSet 规范](/docs/specs/encryptedleaseset/)
- [底层密码学规范](/docs/specs/cryptography/)
