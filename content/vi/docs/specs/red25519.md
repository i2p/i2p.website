---
title: "Lược đồ chữ ký Red25519"
description: "Lược đồ chữ ký có thể tái ngẫu nhiên hóa để tạo các Destinations (điểm đích trong I2P) được làm mù"
slug: "red25519"
lastUpdated: "2025-10"
accurateFor: "2.10.0"
---

## Tổng quan

Tài liệu này đặc tả một lược đồ chữ ký có thể tái ngẫu nhiên hóa, phù hợp để tạo các Destinations có thể được blinded (làm mù). Ngoài ra, nó cũng có thể được dùng để blind các Destinations Ed25519 hiện có, với mức giảm nhẹ về hiệu quả.

Red25519 đã hoạt động đầy đủ trên các I2P router kể từ phiên bản 0.9.39 (phát hành ngày 21 tháng 3 năm 2019). Bản đặc tả này được hoàn thiện ở phiên bản 0.9.47 (tháng 8 năm 2020) sau 17 tháng triển khai trong môi trường sản xuất. Lược đồ chữ ký này được sử dụng như loại chữ ký 11 (RedDSA_SHA512_Ed25519) trong mạng I2P.

## Động lực

Đề xuất 123 (New netDB Entries) định nghĩa một định dạng LeaseSet2 (định dạng LeaseSet thế hệ 2) được mã hóa, hiện thực hóa Nguyên tắc ít quyền nhất: mỗi thành viên trong mạng chỉ được cung cấp những thông tin cần thiết cho vai trò của họ. Cụ thể, một LeaseSet2 được mã hóa khi được công bố lên một floodfill (nút floodfill lưu trữ netDb) sẽ không tiết lộ Destination (đích I2P) mà nó hướng tới, và các Lease chỉ có thể được xem bởi người đã biết trước về Destination đó. Tuy nhiên, các floodfill vẫn cần có khả năng xác thực các LeaseSet2 đã mã hóa khi chúng được công bố, và các client cũng cần bảo đảm thêm rằng việc xác thực đó do chính Destination thực thi.

Đề xuất 123 đạt được điều này bằng cách làm mù các khóa ký của Destinations (điểm đích I2P). Các khóa đã bị làm mù có thể được dùng để tạo chữ ký mà floodfills có thể xác minh, và các ứng dụng khách có thể chắc chắn rằng chỉ Destination mới có thể tạo ra các chữ ký đó. Vì vậy, cần chỉ định một lược đồ chữ ký có thể dùng để làm mù.

**Lưu ý về trạng thái của Proposal 123**: Một số phần của Proposal 123 đã được hiện thực hóa và triển khai dần dần kể từ phiên bản 0.9.38, với hỗ trợ Red25519 được bổ sung trong 0.9.39. Chức năng LeaseSet2 được mã hóa (phiên bản 2 của LeaseSet) đã sẵn sàng cho môi trường sản xuất và đang được sử dụng tích cực trong mạng I2P cho các dịch vụ ẩn được tăng cường quyền riêng tư.

## Thiết kế

### Lược đồ chữ ký cốt lõi

Lược đồ chữ ký được chỉ định ở đây, Red25519, là một hiện thực của RedDSA như được định nghĩa trong Mục 5.4.6 của Zcash Protocol Specification (Sapling và về sau). RedDSA là một lược đồ chữ ký dựa trên Schnorr hỗ trợ key re-randomization (tái ngẫu nhiên hóa khóa). Nó có các hàm sau:

**GENERATE_PRIVATE()** : Trả về một khóa riêng ngẫu nhiên theo phân phối đều.

**DERIVE_PUBLIC(sk)** : Trả về khóa công khai tương ứng với khóa riêng đã cho.

**GENERATE_RANDOM()** : Trả về một số vô hướng ngẫu nhiên phù hợp để ngẫu nhiên hóa lại một cặp khóa.

**RANDOMIZE_PRIVATE(sk, alpha)** : Tái ngẫu nhiên hóa một khóa riêng, sử dụng số vô hướng bí mật alpha.

**RANDOMIZE_PUBLIC(vk, alpha)** : Tái ngẫu nhiên hóa một khóa công khai, sử dụng một vô hướng bí mật alpha.

**SIGN(sk, m)** : Trả về một chữ ký số được tạo bằng khóa riêng sk trên thông điệp m đã cho.

**VERIFY(vk, m, sig)** : Xác minh chữ ký sig đối chiếu với khóa công khai vk và thông điệp m. Trả về true nếu chữ ký hợp lệ, ngược lại trả về false.

Với một cặp khóa (sk, vk) cho trước, mối quan hệ sau đây luôn đúng:

```
RANDOMIZE_PUBLIC(vk, alpha) == DERIVE_PUBLIC(RANDOMIZE_PRIVATE(sk, alpha))
```
### Chuyển đổi khóa Ed25519 sang Red25519

Khóa Ed25519 CÓ THỂ được chuyển đổi một chiều tạm thời thành khóa Red25519, nhằm hỗ trợ tái ngẫu nhiên hóa (re-randomization) các Ed25519 Destinations (đích định danh trong I2P) hiện có. Các sigtypes (kiểu chữ ký) khác không tương thích.

Chúng tôi định nghĩa các hàm chuyển đổi sau đây:

**CONVERT_ED25519_PRIVATE(privkey)** : Trả về khóa riêng Red25519 tương ứng với khóa riêng Ed25519 đã cho.

**CONVERT_ED25519_PUBLIC(pubkey)** : Trả về khóa công khai Red25519 tương ứng với khóa công khai Ed25519 đã cho.

Đối với một cặp khóa Ed25519 (privkey, pubkey) cho trước, hệ thức sau đúng:

```
CONVERT_ED25519_PUBLIC(pubkey) == DERIVE_PUBLIC(CONVERT_ED25519_PRIVATE(privkey))
```
## Đặc tả

### Định nghĩa

**B** : Basepoint (điểm cơ sở) của Ed25519 theo [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).

**L** : Bậc của Ed25519 là 2^252 + 27742317777372353535851937790883648493 như trong [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).

**[s] B** : Phép nhân vô hướng cơ sở cố định của điểm cơ sở với s.

**[s] A** : Phép nhân vô hướng cơ sở thay đổi của A với s.

**x || y** : Ghép nối hai mảng byte x và y.

### Red25519

Lược đồ Red25519 (một lược đồ chữ ký số) là một chuyên biệt của RedDSA (một lược đồ chữ ký số), với:

- G := nhóm các điểm trên dạng Edwards của Curve25519. Cụ thể, điều này có nghĩa là Red25519 sử dụng nhóm con bậc nguyên tố có bậc L, và cofactor (hệ số phụ) h_G là 8.
- P_G := điểm cơ sở B của Ed25519.
- l_H := 512
- H(x) := SHA-512("I2P_Red25519H(x)" || x)

**Lưu ý về lựa chọn hàm băm**: Red25519 sử dụng SHA-512 thay vì BLAKE2b-512 (như được dùng trong Zcash RedDSA). Lựa chọn thiết kế này được bù đắp bởi cơ chế bảo vệ bằng tiền tố độ dài được mô tả bên dưới. I2P Proposal 148 đề xuất chuyển sang BLAKE2b-512 trong tương lai để tăng cường bảo vệ chống lại Duplicate Message Identification (DMI — nhận dạng thông điệp trùng lặp) và Length Extension Attacks (LEA — tấn công mở rộng độ dài), đồng thời cải thiện hiệu năng.

RedDSA giả định rằng H(x) được hiện thực bằng một hàm băm mật mã an toàn trước các cuộc tấn công mở rộng độ dài. SHA-512 tự thân không đáp ứng được điều này. Để khắc phục điều đó, chúng tôi yêu cầu các thông điệp được gắn thêm ở đầu một mã hóa tiền tố (prefix-free) của độ dài thông điệp:

```
len_u16(M) || M
```
trong đó `len_u16(M)` là dạng biểu diễn 2 byte của độ dài M, theo thứ tự byte little-endian (nhằm nhất quán với cách mã hóa little-endian của các vô hướng và các điểm).

Các thông điệp không được vượt quá 65534 byte. Giá trị độ dài 65535 được dành cho các phần mở rộng có thể có trong tương lai.

**Ghi chú bảo mật**: Việc đưa khóa công khai (vk) vào hàm băm, kết hợp với 80 byte ngẫu nhiên khi ký, bảo đảm khả năng bảo vệ trước các lỗ hổng SURK-CMA (Strong Unforgeability with Re-randomized Keys under Chosen Message Attack - tính không thể giả mạo mạnh với khóa được ngẫu nhiên hóa lại dưới tấn công chọn thông điệp) được phát hiện trong các thiết kế RedDSA ban đầu. Bản triển khai này tích hợp các bản vá bảo mật từ cuộc kiểm toán Zcash của NCC Group (Finding NCC-Zcash2018-009).

### Mã hóa và giải mã

Khóa riêng Red25519 là các vô hướng mod L, được mã hóa theo biểu diễn little-endian. Chúng tôi định nghĩa các hàm `DECODE_SCALAR` và `ENCODE_SCALAR` để chuyển đổi qua lại giữa mảng byte và dạng số nguyên của một vô hướng.

Khóa công khai Red25519 là các điểm trên dạng Edwards của Curve25519. Chúng được mã hóa dưới dạng biểu diễn little-endian 255 bit của tọa độ y, theo sau bởi một bit cho biết dấu của tọa độ x. Đây là cùng một cách mã hóa như với Ed25519. Chúng tôi định nghĩa các hàm `DECODE_POINT` và `ENCODE_POINT` để chuyển đổi giữa mảng byte và dạng tọa độ của một điểm.

### Các hàm RedDSA (một thuật toán chữ ký số)

Để thuận tiện cho việc triển khai, dưới đây chúng tôi trình bày rõ ràng các hàm RedDSA (lược đồ chữ ký số RedDSA), cũng như một số hàm trợ giúp, đã được chuyên biệt hóa cho Red25519 (biến thể RedDSA dành cho đường cong 25519). Những người triển khai nên tham khảo mục 5.4.6 của Zcash Protocol Specification để biết đặc tả tổng quát của các hàm RedDSA.

```
HStar(prefix1, prefix2, m) :=
    h = SHA-512()
    h.input("I2P_Red25519H(x)")
    h.input(prefix1)
    h.input(prefix2)

    h.input(len(m) & 0xff)
    h.input((len(m) >> 8) & 0xff)
    h.input(m)

    s = h.digest()
    return s mod L

GENERATE_PRIVATE :=
    s = 64 random bytes
    return s mod L

DERIVE_PUBLIC(sk) := [sk] B

GENERATE_RANDOM :=
    s = 64 random bytes
    return s mod L

RANDOMIZE_PRIVATE(sk, alpha) := (sk + alpha) mod L

RANDOMIZE_PUBLIC(vk, alpha) := vk + [alpha] B

SIGN(sk, m) :=
    T = 80 random bytes
    vkBytes = ENCODE_POINT(DERIVE_PUBLIC(sk))
    r = HStar(T, vkBytes, m)

    R = [r] B
    Rbytes = ENCODE_POINT(R)

    c = HStar(Rbytes, vkBytes, m)
    S = (r + (c * sk)) mod L

    return Rbytes || ENCODE_SCALAR(S)

VERIFY(vk, m, sig) :=
    Rbytes = sig[0..32]
    Sbytes = sig[32..64]

    R = DECODE_POINT(Rbytes)
    if R is invalid:
        return false

    S = DECODE_SCALAR(Sbytes)
    if S >= L:
        return false

    vkBytes = ENCODE_POINT(vk)
    c = HStar(Rbytes, vkBytes, m)
    return ((-[S] B) + R + ([c] vk)).multiplyByCofactor().isIdentity()
```
### Các hàm chuyển đổi

```
CONVERT_ED25519_PRIVATE(privkey) :=
    s = SHA-512(privkey)[0..32]
    s[0] = s[0] & 248
    s[31] = (s[31] & 63) | 64
    return s

CONVERT_ED25519_PUBLIC(pubkey) := pubkey
```
Lưu ý rằng việc triển khai `CONVERT_ED25519_PRIVATE` tương đương với việc tính toán vô hướng bí mật s khi suy ra khóa công khai Ed25519 từ khóa riêng Ed25519, như được quy định trong các bước 1-3 của mục 5.1.5 của [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).

## Hệ quả đối với bảo mật

Tái ngẫu nhiên hóa một Điểm đích Red25519 rồi dùng nó để tạo chữ ký sẽ không làm rò rỉ bất kỳ thông tin nào về Điểm đích, vì phân phối của các khóa riêng Red25519 được tạo thông qua `RANDOMIZE_PRIVATE` là giống hệt với phân phối của các khóa riêng được tạo thông qua `GENERATE_PRIVATE`, và `DERIVE_PUBLIC` là xác định.

Việc chuyển đổi các khóa riêng Ed25519 (thuật toán chữ ký số) sang Red25519 (một biến thể liên quan đến Ed25519) thông qua `CONVERT_ED25519_PRIVATE` không dẫn tới cùng một phân phối. Tuy nhiên, chúng tôi cho rằng sự suy giảm về bảo mật là chấp nhận được vì các lý do sau:

- Không gian các số vô hướng của Ed25519 xấp xỉ bằng một nửa kích thước không gian các số vô hướng của Red25519 (có 2^251 số vô hướng Ed25519 khả dĩ, và L ~= 2^252 số vô hướng Red25519 khả dĩ). Do đó, mức suy giảm bảo mật tối đa chỉ khoảng hệ số 2, hay khoảng 1 bit (vì ta có thể tình cờ chọn một số vô hướng Red25519 cũng đồng thời là một số vô hướng Ed25519 hợp lệ).
- Các Ed25519 Destinations (địa chỉ đích trong I2P) hiện có đã từng bị lộ trên mạng, và nên giả định rằng các floodfills độc hại đã liệt kê chúng.

**Quan trọng**: Người dùng lo ngại về sự suy giảm bảo mật này nên sử dụng Red25519 (signature type 11) làm sigtype (kiểu chữ ký) cho các Destinations (định danh đích trong I2P) của mình thay vì Ed25519 (signature type 7).

Lưu ý rằng lập luận ở trên không áp dụng cho re-randomization scalar alpha (hệ số tái ngẫu nhiên hóa alpha); thông tin về khóa sẽ bị rò rỉ mỗi khi chọn một alpha bị thiên lệch, vì additive re-randomization (tái ngẫu nhiên hóa theo phép cộng) hoạt động giống như mật mã dùng một lần.

### Trạng thái kiểm toán bảo mật

**Tiết lộ quan trọng**: I2P, bao gồm cả Red25519, chưa từng trải qua một cuộc kiểm toán bảo mật chính thức bởi bên thứ ba. Thiết kế RedDSA nền tảng đã được NCC Group rà soát bảo mật như một phần của cuộc kiểm toán giao thức Zcash Sapling năm 2018, trong đó các vấn đề bảo mật đã được xác định và khắc phục. Tuy nhiên, cách hiện thực cụ thể của I2P với SHA-512 (thay vì BLAKE2b-512) và cơ chế phân tách miền (domain separation) của I2P vẫn chưa được phân tích độc lập.

Bản triển khai tham chiếu ed25519-java của str4d đã trải qua một cuộc kiểm toán độc lập bởi bên thứ ba, nhưng cuộc kiểm toán này diễn ra trước khi có triển khai Red25519 và chỉ bao quát chức năng Ed25519, không bao gồm các phần mở rộng Red25519.

Người dùng triển khai Red25519 nên hiểu rõ hạn chế này và đánh giá các đánh đổi về bảo mật dựa trên mô hình đe dọa của họ.

## Tương thích

Các phiên bản I2P hỗ trợ Red25519 (thuật toán chữ ký số) (phiên bản 0.9.39 trở lên) sẽ có thể xác minh các cấu trúc dữ liệu mạng được ký bằng Red25519. Các phiên bản I2P không hỗ trợ Red25519 sẽ coi nó là một chữ ký không nhận dạng được và CÓ THỂ loại bỏ các cấu trúc dữ liệu đó.

**Dòng thời gian triển khai**: - **0.9.39** (Tháng 3 2019): Triển khai đầu tiên với hỗ trợ Encrypted LS2 (LS2 = LeaseSet2, phiên bản LeaseSet thế hệ 2) trong các floodfill - **0.9.40** (Tháng 5 2019): Ủy quyền theo từng client cho Encrypted LS2 - **0.9.41** (Tháng 8 2019): Meta LS2 và Encrypted LS2 với khóa ngoại tuyến - **0.9.43** (Tháng 2 2020): hỗ trợ b32 (địa chỉ Base32) cho Encrypted LS2 - **0.9.47** (Tháng 8 2020): Hoàn thiện đặc tả - **2.10.0** (Tháng 10 2025): Phiên bản mạng hiện tại (tương đương 0.9.67+)

Người dùng nên kỳ vọng độ tin cậy của các cấu trúc dữ liệu được ký bằng Red25519 ở mức tốt cho các trường hợp sử dụng LeaseSet2 được mã hóa, vì mạng đã có hơn sáu năm để nâng cấp kể từ khi triển khai ban đầu. Tuy nhiên, các chỉ số về mức độ áp dụng cho việc sử dụng đích nói chung không được công bố công khai.

**Trường hợp sử dụng chính**: Red25519 chủ yếu được dùng cho chức năng LeaseSet2 được mã hóa, khi cần key blinding (kỹ thuật làm mù khóa). Đối với các đích tiêu chuẩn không có yêu cầu leaseset được mã hóa, Ed25519 (loại chữ ký 7) vẫn là lựa chọn được khuyến nghị nhờ khả năng tương thích rộng hơn và lịch sử hoạt động đã được chứng minh lâu hơn.

## Ghi chú triển khai

Red25519 được triển khai trong router Java của I2P tại `net.i2p.crypto.eddsa.RedDSAEngine` và sử dụng thư viện ed25519-java của str4d (Jack Grigg) như một phụ thuộc Maven `net.i2p.crypto:eddsa` (các phiên bản từ 0.1.0 đến 0.3.0).

Bản triển khai i2pd bằng C++ cũng hỗ trợ Red25519 (signaturetype=11) cho việc xuất bản LeaseSet được mã hóa.

Ví dụ cấu hình cho i2pd:

```
signaturetype=11
i2cp.leaseSetType=5
```
**Khả năng tương thích LeaseSet2 được mã hóa**: Đặc tả Encrypted LeaseSet yêu cầu khóa công khai dùng để ký trong unblinded destination (đích không che mù) phải là Ed25519 (kiểu chữ ký 7) hoặc Red25519 (kiểu chữ ký 11). Không hỗ trợ bất kỳ kiểu chữ ký nào khác cho chức năng leaseset được mã hóa.

## Các vector kiểm thử

Các vector kiểm thử sau đây được cung cấp để kiểm chứng việc triển khai. Mỗi vector bao gồm:

- `edsk`: Khóa riêng Ed25519 (ngẫu nhiên)
- `edpk`: Khóa công khai Ed25519 tương ứng với edsk
- `sk`: CONVERT_ED25519_PRIVATE(edsk)
- `vk`: CONVERT_ED25519_PUBLIC(edpk)
- `msg`: Thông điệp cần ký
- `sig`: SIGN(sk, msg)
- `alpha`: GENERATE_RANDOM()
- `rsk`: RANDOMIZE_PRIVATE(sk, alpha)
- `rvk`: RANDOMIZE_PUBLIC(vk, alpha)
- `rsig`: SIGN(rsk, msg)

**Ghi chú triển khai**: Các vector kiểm thử này nên được tích hợp vào các bộ kiểm thử đơn vị tự động để xác thực liên tục. Người triển khai nên xác minh rằng tất cả các phép chuyển đổi, chữ ký và các thao tác tái ngẫu nhiên hóa khớp với các giá trị mong đợi này.

### Vector kiểm thử 1

```
edsk:  0101010101010101010101010101010101010101010101010101010101010101
edpk:  8a88e3dd7409f195fd52db2d3cba5d72ca6709bf1d94121bf3748801b40f6f5c
sk:    58e86efb75fa4e2c410f46e16de9f6acae1a1703528651b69bc176c088bef36e
vk:    8a88e3dd7409f195fd52db2d3cba5d72ca6709bf1d94121bf3748801b40f6f5c
msg:   0202020202020202020202020202020202020202020202020202020202020202
sig:   61f5527f4d3b46de4b2c234390370bf715ae9098907a0d191ba1b44b23a8ac1a
       6a40437a5294e9503faaf9bd2b7f2fe7ba44dec487b3185aba7ff7d7a17cd40f
alpha: ae9ba9cbbc047c442448fca7c9f4e288a202ed520bfad0c784b792b7773cee08
rsk:   8bb85f3c7a494a08890d7d142109c1a3501d04565d80227e2079097800fbe107
rvk:   6fe128737b8e76fa66698a748b0dc0a89168dd8a0601c2b1c0b26835d323e9b3
rsig:  533053074d3b44f08723aab988ede9880a001b7a684d4a98f2d1b88fabee07a5
       b5c9430c69a690321e0cb8365d7aeb6688bcbad2c0780e0c69e8a1b4a45f3001
```
### Vector kiểm thử 2

```
edsk:  0202020202020202020202020202020202020202020202020202020202020202
edpk:  8139770ea87d175f56a35466c34c7ecccb8d8a91b4ee37a25df60f5b8fc9b394
sk:    a83c626bc9c38c8c201878ebb1d5b0b50ac40e8986c78793db1d4ef369fca14e
vk:    8139770ea87d175f56a35466c34c7ecccb8d8a91b4ee37a25df60f5b8fc9b394
msg:   0303030303030303030303030303030303030303030303030303030303030303
sig:   0829e58eb5399870f009bd1f0270264e556424bda7a93fbcec99f6d9d75db46d
       5c3cb546d9947ca7c1200876c8775a90c357a2aef3d2f16388242ee1914b1a0a
alpha: 98b615d9027e996cc2796c019d9c8beb46aa7d2b6eea2e5d98eb29eb1584c203
rsk:   9fcfaa734852ca40b3810ebef590e138516e8cb4f4b1b6f0730978de7f806402
rvk:   527e121090158419609e4a0d8de6f7d3271b353a8cd0b8172fe41468ea1e9177
rsig:  9a6961f35ed264a946cd6214b2326a6e6caa426c2a61bc14367fd278e0b5fb51
       3ac065a69210a457f17d12ba8a496cfd835002691affa8efcdecae48135c090f
```
**Lưu ý**: Các vector kiểm thử bổ sung 3-10 tuân theo cùng một định dạng và có thể được tìm thấy trong bản triển khai tham chiếu.

## Tài liệu tham khảo

- [Đề xuất 123: Các mục netDB mới](/proposals/123-new-netdb-entries/) - Một phần đã được triển khai và đưa vào sử dụng trong 0.9.38, 0.9.39 và các bản phát hành sau đó
- [Đặc tả Giao thức Zcash, Mục 5.4.6: RedDSA (biến thể EdDSA dùng trong Zcash), RedJubjub và RedPallas](https://zips.z.cash/protocol/protocol.pdf) - RedDSA được định nghĩa như một phần của đặc tả giao thức Zcash; được NCC Group kiểm toán bảo mật (tháng 1 năm 2019)
- [RFC 8032: Thuật toán chữ ký số đường cong Edwards (EdDSA)](https://www.rfc-editor.org/rfc/rfc8032.html)
- [Đề xuất 148: RedDSA-BLAKE2b-Ed25519](/proposals/148-eddsa-blake2b-ed25519/) - Đã được đề xuất nhưng chưa triển khai; đề xuất chuyển sang BLAKE2b-512 trong tương lai
- [Đặc tả LeaseSet được mã hóa](/docs/specs/encryptedleaseset/)
- [Đặc tả mật mã cấp thấp](/docs/specs/cryptography/)
