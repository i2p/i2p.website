---
title: "B32 لـ leaseSets (مجموعات نقاط الدخول للأنفاق في I2P) المشفّرة"
description: "تنسيق عنوان Base 32 لـ LS2 leasesets المشفرة"
slug: "b32encrypted"
lastUpdated: "2025-10"
accurateFor: "2.10.0"
status: "تم التنفيذ"
---

## نظرة عامة

تحتوي عناوين Base 32 القياسية ("b32") على تجزئة الوجهة. لن يعمل ذلك مع LS2 المشفرة (LeaseSet الإصدار الثاني) (proposal 123).

لا يمكننا استخدام عنوان base 32 تقليدي لـ LS2 مشفّر (proposal 123)، لأنه يحتوي فقط على تجزئة الوجهة. لا يوفّر المفتاح العام غير المُعمّى. يجب أن يعرف العملاء المفتاح العام للوجهة، ونوع التوقيع، ونوع التوقيع المُعمّى، وسرًا اختياريًا أو مفتاحًا خاصًا من أجل جلب وفك تشفير الـ leaseset. لذلك، فإن عنوان base 32 وحده غير كافٍ. يحتاج العميل إما إلى الوجهة الكاملة (التي تحتوي على المفتاح العام)، أو إلى المفتاح العام وحده. إذا كان لدى العميل الوجهة الكاملة في دفتر عناوين، وكان دفتر العناوين يدعم البحث العكسي باستخدام التجزئة، فحينها يمكن استرجاع المفتاح العام.

هذا التنسيق يضع المفتاح العام بدلاً من التجزئة في عنوان base32. ويجب أن يحتوي هذا التنسيق أيضًا على نوع التوقيع للمفتاح العام، ونوع التوقيع الخاص بـ blinding scheme (مخطط الإعماء).

يحدد هذا المستند صيغة b32 لهذه العناوين. ورغم أننا أشرنا إلى هذه الصيغة الجديدة أثناء المناقشات على أنها عنوان "b33"، فإن الصيغة الجديدة الفعلية تحتفظ باللاحقة المعتادة ".b32.i2p".

## حالة التنفيذ

المقترح 123 (إدخالات netDB الجديدة) حقّق التنفيذ الكامل في الإصدار 0.9.43 (أكتوبر 2019). ظلّت مجموعة ميزات LS2 (الإصدار الثاني من leaseSet) المشفَّرة مستقرة حتى الإصدار 2.10.0 (سبتمبر 2025)، من دون تغييرات كاسرة للتوافق في تنسيق العنونة أو المواصفات التشفيرية.

المعالم الرئيسية للتنفيذ: - 0.9.38: دعم floodfill لـ LS2 القياسي مع مفاتيح غير متصلة - 0.9.39: توقيع RedDSA من النوع 11 والتشفير/فك التشفير الأساسي - 0.9.40: دعم كامل لعنونة B32 (Proposal 149) - 0.9.41: مصادقة لكل عميل مستندة إلى X25519 - 0.9.42: جميع ميزات blinding (الإعماء) قيد التشغيل - 0.9.43: تم إعلان اكتمال التنفيذ (أكتوبر 2019)

## التصميم

- يتضمن التنسيق الجديد المفتاح العام غير المُعمّى، ونوع التوقيع غير المُعمّى، ونوع التوقيع المُعمّى بالإعماء.
- يشير اختياريًا إلى متطلبات السر و/أو المفتاح الخاص للروابط الخاصة.
- يستخدم اللاحقة ".b32.i2p" الحالية، ولكن بطول أكبر.
- يتضمن قيمة تحقق (checksum) لاكتشاف الأخطاء.
- تُعرَّف عناوين leasesets المُشفَّرة بواسطة 56 محرفًا مُرمَّزًا أو أكثر (35 بايتًا مُفكَّك الترميز أو أكثر)، مقارنةً بـ 52 محرفًا (32 بايتًا) لعناوين base 32 التقليدية.

## المواصفة

### الإنشاء والترميز

قم ببناء اسم مضيف من الشكل {56+ محارف}.b32.i2p (35+ محارف بالنظام الثنائي) كما يلي:

```
flag (1 byte)
  bit 0: 0 for one-byte sigtypes, 1 for two-byte sigtypes
  bit 1: 0 for no secret, 1 if secret is required
  bit 2: 0 for no per-client auth,
         1 if client private key is required
  bits 7-3: Unused, set to 0

public key sigtype (1 or 2 bytes as indicated in flags)
  If 1 byte, the upper byte is assumed zero

blinded key sigtype (1 or 2 bytes as indicated in flags)
  If 1 byte, the upper byte is assumed zero

public key
  Number of bytes as implied by sigtype
```
المعالجة اللاحقة والمجموع الاختباري:

```
Construct the binary data as above.
Treat checksum as little-endian.
Calculate checksum = CRC-32(data[3:end])
data[0] ^= (byte) checksum
data[1] ^= (byte) (checksum >> 8)
data[2] ^= (byte) (checksum >> 16)

hostname = Base32.encode(data) || ".b32.i2p"
```
أي بتات غير مستخدمة في نهاية b32 يجب أن تكون 0. لا توجد بتات غير مستخدمة في عنوان قياسي بطول 56 حرفًا (35 بايتًا).

### فك الترميز والتحقق

```
strip the ".b32.i2p" from the hostname
data = Base32.decode(hostname)
Calculate checksum = CRC-32(data[3:end])
Treat checksum as little-endian.
flags = data[0] ^ (byte) checksum
if 1 byte sigtypes:
  pubkey sigtype = data[1] ^ (byte) (checksum >> 8)
  blinded sigtype = data[2] ^ (byte) (checksum >> 16)
else (2 byte sigtypes):
  pubkey sigtype = data[1] ^ ((byte) (checksum >> 8)) || data[2] ^ ((byte) (checksum >> 16))
  blinded sigtype = data[3] || data[4]
parse the remainder based on the flags to get the public key
```
### بتات المفتاحين السري والخاص

تُستخدم بتّات المفتاح السري والمفتاح الخاص لإبلاغ العملاء والوكلاء وأي شفرة على جانب العميل بأن المفتاح السري و/أو المفتاح الخاص سيكون مطلوبًا لفك تشفير leaseset. قد تطالب بعض التطبيقات المستخدم بتزويد البيانات المطلوبة، أو ترفض محاولات الاتصال إذا كانت البيانات المطلوبة مفقودة.

تعمل هذه البِتّات كمؤشرات فقط. لا ينبغي مطلقًا تضمين المفتاح السري أو الخاص داخل B32 address نفسه (تمثيل العنوان بصيغة Base32 في I2P)، لأن ذلك قد يعرّض الأمان للخطر.

## تفاصيل التشفير

### مخطط الإعماء

يستخدم مخطط الإعماء RedDSA (مخطط توقيع رقمي) القائم على Ed25519 (منحنى بيضوي وخوارزمية توقيع) وتصميم ZCash (عملة رقمية تركز على الخصوصية)، منتِجًا توقيعات Red25519 (خوارزمية توقيع مبنية على Ed25519) على منحنى Ed25519 باستخدام SHA-512 (دالة تجزئة تشفيرية). يضمن هذا النهج بقاء المفاتيح العامة المُعمّاة ضمن زمرة جزئية ذات رتبة أولية، مما يتجنب المخاوف الأمنية الموجودة في بعض التصاميم البديلة.

تُدوَّر Blinded keys (مفاتيح تُحجب هويتها لأغراض الخصوصية) يومياً استناداً إلى تاريخ UTC باستخدام الصيغة:

```
blinded_key = BLIND(unblinded_key, date, optional_secret)
```
يُحسَب موقع التخزين في جدول التجزئة الموزع (DHT) كما يلي:

```
SHA256(type_byte || blinded_public_key)
```
### التشفير

يستخدم الـ leaseset المُشفّر شفرة دفق ChaCha20 للتشفير، وقد تم اختيارها لأدائها المتفوق على الأجهزة التي تفتقر إلى تسريع عتادي لـ AES. تعتمد المواصفة HKDF لاشتقاق المفاتيح و X25519 لعمليات Diffie-Hellman (تبادل المفاتيح ديفي-هيلمان).

تتألف الـ leaseSet (مجموعة بيانات تصف أنفاق الدخول الخاصة بوجهة في I2P) المشفّرة من ثلاث طبقات: - الطبقة الخارجية: بيانات وصفية نصية غير مشفّرة - الطبقة الوسطى: مصادقة العميل (طريقتا DH أو PSK) - الطبقة الداخلية: بيانات LS2 الفعلية مع معلومات lease (تصريح نفق دخول)

### طرق المصادقة

المصادقة على مستوى العميل تدعم طريقتين:

**مصادقة DH (ديفي-هيلمان)**: يستخدم تبادل مفاتيح X25519. يقدّم كل عميل مُصرّح له مفتاحه العام إلى الخادم، ويقوم الخادم بتشفير الطبقة الوسطى باستخدام سرّ مشترك مُشتق من ECDH (ديفي-هيلمان القائم على المنحنى الإهليلجي).

**مصادقة PSK (مفتاح مُسبق المشاركة)**: تستخدم مفاتيح مُسبقة المشاركة مباشرةً للتشفير.

يشير بت العلم رقم 2 في عنوان B32 (عنوان Base32) إلى ما إذا كانت المصادقة لكل عميل على حدة مطلوبة.

## التخزين المؤقت

مع أن ذلك خارج نطاق هذه المواصفة، يجب على routers والعملاء أن يتذكروا ويخزنوا مؤقتًا تعيين المفتاح العام إلى الوجهة (ويُستحسن تخزينه بصورة دائمة)، والعكس صحيح.

خدمة التسمية blockfile (تنسيق تخزين مُقسّم إلى كتل)، وهي نظام دفتر العناوين الافتراضي في I2P منذ الإصدار 0.9.8، تُحافظ على عدة دفاتر عناوين مع خريطة مخصّصة للبحث العكسي تتيح عمليات بحث سريعة حسب التجزئة. وتُعد هذه الوظيفة ضرورية لحل leaseset المشفّر عندما لا يكون معروفًا في البداية سوى التجزئة.

## أنواع التواقيع

اعتبارًا من إصدار I2P 2.10.0، تم تعريف أنواع التواقيع من 0 إلى 11. يظل ترميز البايت الواحد هو المعيار، مع أن ترميز البايتين متاح لكنه غير مستخدم عمليًا.

**الأنواع الشائعة الاستخدام:** - النوع 0 (DSA_SHA1): مهمَل للـrouters، ومدعوم للوجهات - النوع 7 (EdDSA_SHA512_Ed25519): المعيار الحالي لهويات router والوجهات - النوع 11 (RedDSA_SHA512_Ed25519): حصراً لـ LS2 leasesets المشفرة مع دعم الإعماء (blinding)

**ملاحظة مهمة**: تدعم Ed25519 (type 7) و Red25519 (type 11) الإعماء اللازم لـ leasesets المشفرة. لا يمكن استخدام أنواع التوقيع الأخرى مع هذه الميزة.

تظل الأنواع 9-10 (GOST algorithms، معايير التشفير الروسية) محجوزة ولكن غير مُنفَّذة. الأنواع 4-6 و8 مُعلَّمة بأنها "offline only" لمفاتيح التوقيع غير المتصلة.

## ملاحظات

- ميّز بين الأنواع القديمة والجديدة حسب الطول. عناوين b32 القديمة دائمًا تكون {52 chars}.b32.i2p. أما الجديدة فهي {56+ chars}.b32.i2p
- يتبع ترميز base32 معايير RFC 4648 مع فك ترميز غير حساس لحالة الأحرف، مع تفضيل أن يكون الإخراج بحروف صغيرة
- قد تتجاوز العناوين 200 حرف عند استخدام أنواع توقيع بمفاتيح عامة أكبر (مثل ECDSA P521 بمفاتيح حجمها 132-بايت)
- يمكن استخدام الصيغة الجديدة في jump links أي روابط القفز (ويتم تقديمها بواسطة jump servers) إذا رغبت، تمامًا مثل b32 القياسي
- Blinded keys (مفاتيح مموّهة) تتبدّل يوميًا بناءً على تاريخ UTC لتعزيز الخصوصية
- هذه الصيغة تختلف عن نهج Tor في الملف rend-spec-v3.txt ضمن الملحق A.2، ما قد يترتب عليه تداعيات أمنية محتملة عند استخدام مفاتيح عامة blinded خارج المنحنى الإهليلجي

## توافق الإصدارات

هذه المواصفة دقيقة لنسخة I2P 0.9.47 (أغسطس 2020) وحتى النسخة 2.10.0 (سبتمبر 2025). لم تحدث أي تغييرات كاسرة للتوافق على تنسيق العنونة B32 (عنوان Base32 في I2P) أو بنية LS2 المشفّرة (إصدار leaseSet الثاني) أو تنفيذات التشفير خلال هذه الفترة. تظل جميع العناوين التي أُنشئت باستخدام 0.9.47 متوافقةً بالكامل مع الإصدارات الحالية.

## المراجع

**CRC-32** (فحص التكرار الدوري 32-بت) - [CRC-32 (ويكيبيديا)](https://en.wikipedia.org/wiki/CRC-32) - [RFC 3309: المجموع الاختباري لـ Stream Control Transmission Protocol (بروتوكول التحكم في نقل التدفق)](https://tools.ietf.org/html/rfc3309)

**مواصفات I2P** - [مواصفة LeaseSet (مجموعة المسارات في I2P) المشفّر](/docs/specs/encryptedleaseset/) - [الاقتراح 123: إدخالات netDB (قاعدة بيانات الشبكة في I2P) الجديدة](/proposals/123-new-netdb-entries/) - [الاقتراح 149: B32 من أجل LS2 (الإصدار الثاني من LeaseSet) المشفّر](/proposals/149-b32-encrypted-ls2/) - [مواصفة الهياكل المشتركة](/docs/specs/common-structures/) - [التسمية ودفتر العناوين](/docs/overview/naming/)

**مقارنة Tor** - [سلسلة نقاش Tor (سياق التصميم)](https://lists.torproject.org/pipermail/tor-dev/2017-January/011816.html)

**موارد إضافية** - [مشروع I2P](/) - [منتدى I2P](https://i2pforum.net) - [وثائق واجهة برمجة تطبيقات Java](http://docs.i2p-projekt.de/javadoc/)
