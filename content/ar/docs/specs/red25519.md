---
title: "مخطط التوقيع Red25519"
description: "مخطط توقيع قابل لإعادة العشوائية لإنشاء Destinations (وجهات I2P) محجوبة"
slug: "red25519"
lastUpdated: "2025-10"
accurateFor: "2.10.0"
---

## نظرة عامة

يحدد هذا المستند مخطط توقيع قابل لإعادة العشوائية مناسبًا لإنشاء وجهات يمكن تعميتها. وبالإضافة إلى ذلك، يمكن استخدامه لتعمية وجهات Ed25519 القائمة، مع انخفاض طفيف في الفاعلية.

كانت Red25519 (خوارزمية توقيع) تعمل بكامل طاقتها في I2P routers منذ الإصدار 0.9.39 (الصادر في 21 مارس 2019). تم اعتماد هذه المواصفة نهائياً في الإصدار 0.9.47 (أغسطس 2020) بعد 17 شهراً من التشغيل في بيئة الإنتاج. يعمل مخطط التوقيع كنوع التوقيع 11 (RedDSA_SHA512_Ed25519) في شبكة I2P.

## الدوافع

المقترح 123 (مدخلات netDB جديدة) يعرّف صيغة مشفّرة لـLeaseSet2 تُجسّد مبدأ أقل قدر من الصلاحيات: يُمنَح كل مشارك في الشبكة فقط المعلومات اللازمة لدوره. وعلى وجه الخصوص، فإن LeaseSet2 المشفَّر والمنشور إلى floodfill لا يكشف Destination (الوجهة في I2P) التي يخصّها، ولا يمكن عرض Leases إلا لمن لديه معرفة مسبقة بـ Destination. ومع ذلك، لا تزال floodfills بحاجة إلى القدرة على مصادقة LeaseSet2s المشفَّرة عند نشرها، كما يحتاج العملاء أيضًا إلى التأكد من أن المصادقة قد فُرضت من قِبل Destination نفسها.

يحقق الاقتراح 123 ذلك عبر إعماء مفاتيح التوقيع الخاصة بـ Destinations (الوجهات في I2P). يمكن استخدام المفاتيح المُعمّاة لإنشاء توقيعات يمكن لـ floodfills التحقق منها، ويمكن للعملاء التأكد من أن Destination وحده كان يمكنه إنشاء تلك التوقيعات. لذلك، من الضروري تحديد مخطط توقيع يمكن استخدامه للإعماء.

**ملاحظة حول حالة المقترح 123**: تم تنفيذ ونشر أجزاء من المقترح 123 تدريجيًا منذ الإصدار 0.9.38، مع إضافة دعم Red25519 في الإصدار 0.9.39. وظائف LeaseSet2 المشفَّرة (صيغة أحدث من leaseSet في I2P) جاهزة للإنتاج وتُستخدم بنشاط في شبكة I2P لخدمات مخفية معزَّزة الخصوصية.

## التصميم

### مخطط التوقيع الأساسي

مخطط التوقيع المحدد هنا، Red25519، هو تجسيد لـ RedDSA كما هو مُعرّف في القسم 5.4.6 من مواصفة بروتوكول Zcash (Sapling وما بعده). RedDSA هو مخطط توقيع مبني على Schnorr (مخطط توقيع شنور) ويدعم إعادة توليد المفتاح عشوائياً. وله الوظائف التالية:

**GENERATE_PRIVATE()** : يرجع مفتاح خاص عشوائي بتوزيع منتظم.

**DERIVE_PUBLIC(sk)** : يُرجِع المفتاح العام المطابق للمفتاح الخاص المُعطى.

**GENERATE_RANDOM()** : ترجع عدداً عشوائياً (scalar) مناسباً لإعادة عشوائية زوج مفاتيح.

**RANDOMIZE_PRIVATE(sk, alpha)** : تعيد عشوَرة مفتاح خاص، باستخدام عدد قياسي سري alpha.

**RANDOMIZE_PUBLIC(vk, alpha)** : يعيد توليد مفتاح عام عشوائياً باستخدام عدد قياسي سرّي alpha.

**SIGN(sk, m)** : يُرجِع توقيعًا باستخدام المفتاح الخاص sk على الرسالة m المُعطاة.

**VERIFY(vk, m, sig)** : يتحقق من صحة التوقيع sig بمقارنته بالمفتاح العام vk والرسالة m. يُرجِع true إذا كان التوقيع صالحًا، وإلا فيُرجِع false.

بالنسبة لزوج مفاتيح معيّن (sk، vk)، تتحقق العلاقة التالية:

```
RANDOMIZE_PUBLIC(vk, alpha) == DERIVE_PUBLIC(RANDOMIZE_PRIVATE(sk, alpha))
```
### تحويل مفاتيح Ed25519 إلى Red25519

يجوز تحويل مفاتيح Ed25519 تحويلًا أحادي الاتجاه بصفة مؤقتة إلى مفاتيح Red25519، وذلك لدعم إعادة العشوائية للوجهات الحالية من نوع Ed25519. الأنواع الأخرى من sigtypes (أنواع التواقيع) غير متوافقة.

نعرّف دوال التحويل التالية:

**CONVERT_ED25519_PRIVATE(privkey)** : يُرجع مفتاح Red25519 الخاص المقابل لمفتاح Ed25519 الخاص المُعطى.

**CONVERT_ED25519_PUBLIC(pubkey)** : يُرجع مفتاح Red25519 العام المقابل لمفتاح Ed25519 العام المُعطى.

بالنسبة لزوج مفاتيح Ed25519 المعطى (privkey، pubkey)، تتحقق العلاقة التالية:

```
CONVERT_ED25519_PUBLIC(pubkey) == DERIVE_PUBLIC(CONVERT_ED25519_PRIVATE(privkey))
```
## المواصفة

### التعريفات

**B** : نقطة الأساس الخاصة بـ Ed25519 كما في [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).

**L** : رتبة Ed25519 هي 2^252 + 27742317777372353535851937790883648493 كما في [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).

**[s] B** : ضرب سلمي ثابت الأساس على نقطة الأساس بـ s.

**[s] A** : الضرب السلمي (scalar multiplication) بنقطة أساس متغيّرة لـ A بواسطة s.

**x || y** : ربط مصفوفتين من البايتات x و y.

### Red25519 (مخطط توقيع مبني على Ed25519 مستخدم في I2P)

يقوم المخطّط Red25519 بتخصيص RedDSA بما يلي:

- G := مجموعة النقاط على صيغة Edwards لمنحنى Curve25519. وبالتحديد، يعني ذلك أن Red25519 يستخدم المجموعة الفرعية ذات رتبة أولية مقدارها L، وأن قيمة cofactor (عامل المشاركة) h_G تساوي 8.
- P_G := نقطة الأساس B لـ Ed25519.
- l_H := 512
- H(x) := SHA-512("I2P_Red25519H(x)" || x)

**ملاحظة حول اختيار دالة التجزئة**: تستخدم Red25519 (خوارزمية توقيع) SHA-512 بدلاً من BLAKE2b-512 (كما هو مستخدم في Zcash RedDSA). يتم تعويض هذا القرار التصميمي عبر حماية length-prefixing (حماية بإضافة بادئة طول للرسالة) الموضحة أدناه. يقترح I2P Proposal 148 الانتقال مستقبلاً إلى BLAKE2b-512 لتعزيز الحماية ضد Duplicate Message Identification (DMI) (تمييز الرسائل المكررة) و Length Extension Attacks (LEA) (هجمات تمديد الطول)، إضافةً إلى تحسين الأداء.

تفترض RedDSA أن H(x) تُنفَّذ باستخدام دالة تجزئة تشفيرية آمنة ضد هجمات تمديد الطول. ولا يفي SHA-512 بذلك بمفرده. لمعالجة هذا، نُلزِم بأن تُسبَق الرسائل بترميز خالٍ من البادئة لطولها:

```
len_u16(M) || M
```
حيث إن `len_u16(M)` هي التمثيل ذي البايتين لطول M، بصيغة little-endian (ترتيب البايتات من الأصغر إلى الأكبر)، وذلك اتساقاً مع ترميز little-endian لكلٍ من scalars (أعداد سكلارية) والنقاط.

يجب ألا يزيد طول الرسائل عن 65534 بايتًا. قيمة الطول 65535 محجوزة لتوسعات محتملة مستقبلًا.

**ملاحظة أمنية**: إن تضمين المفتاح العام (vk) في دالة التجزئة، مقترنًا بـ 80 بايتًا عشوائيًا أثناء التوقيع، يضمن الحماية من ثغرات SURK-CMA (قابلية تزوير قوية مع إعادة عشوائية للمفاتيح في ظل هجوم الرسالة المختارة) التي اكتُشفت في التصاميم المبكرة لـ RedDSA. يتضمن هذا التنفيذ الإصلاحات الأمنية الواردة في تدقيق NCC Group لـ Zcash (Finding NCC-Zcash2018-009).

### الترميز وفك الترميز

مفاتيح Red25519 الخاصة هي scalars (أعداد قياسية) mod L، مرمّزة بتمثيل little-endian (ترتيب البايتات من الأقل أهمية إلى الأعلى). نعرّف الدالتين `DECODE_SCALAR` و`ENCODE_SCALAR` للتبديل بين صيغة مصفوفة البايتات والصيغة العددية لـ scalar.

مفاتيح Red25519 العامة هي نقاط على نموذج إدواردز (Edwards form) لمنحنى Curve25519. يُرَمَّزُـها على شكل تمثيل بطول 255 بت بترتيب البايتات little-endian (ليتل-إنديَن: ترتيب البايتات من الأصغر إلى الأكبر) لإحداثي y، ثم تتبعه بتة واحدة تشير إلى إشارة إحداثي x. وهذا هو نفس الترميز المستخدم في Ed25519. نعرّف الدالتين `DECODE_POINT` و`ENCODE_POINT` للتبديل بين مصفوفة البايتات وصيغ الإحداثيات لنقطة.

### دوال RedDSA (خوارزمية توقيع رقمية)

لتسهيل التنفيذ، نورد أدناه بشكل صريح دوال RedDSA (خوارزمية توقيع رقمية) وكذلك عدة دوال مساعدة، وهي متخصصة بالفعل لـ Red25519 (نوع متخصّص من RedDSA). ينبغي على المنفذين الرجوع إلى القسم 5.4.6 من مواصفة بروتوكول Zcash للاطلاع على المواصفة العامة لدوال RedDSA.

```
HStar(prefix1, prefix2, m) :=
    h = SHA-512()
    h.input("I2P_Red25519H(x)")
    h.input(prefix1)
    h.input(prefix2)

    h.input(len(m) & 0xff)
    h.input((len(m) >> 8) & 0xff)
    h.input(m)

    s = h.digest()
    return s mod L

GENERATE_PRIVATE :=
    s = 64 random bytes
    return s mod L

DERIVE_PUBLIC(sk) := [sk] B

GENERATE_RANDOM :=
    s = 64 random bytes
    return s mod L

RANDOMIZE_PRIVATE(sk, alpha) := (sk + alpha) mod L

RANDOMIZE_PUBLIC(vk, alpha) := vk + [alpha] B

SIGN(sk, m) :=
    T = 80 random bytes
    vkBytes = ENCODE_POINT(DERIVE_PUBLIC(sk))
    r = HStar(T, vkBytes, m)

    R = [r] B
    Rbytes = ENCODE_POINT(R)

    c = HStar(Rbytes, vkBytes, m)
    S = (r + (c * sk)) mod L

    return Rbytes || ENCODE_SCALAR(S)

VERIFY(vk, m, sig) :=
    Rbytes = sig[0..32]
    Sbytes = sig[32..64]

    R = DECODE_POINT(Rbytes)
    if R is invalid:
        return false

    S = DECODE_SCALAR(Sbytes)
    if S >= L:
        return false

    vkBytes = ENCODE_POINT(vk)
    c = HStar(Rbytes, vkBytes, m)
    return ((-[S] B) + R + ([c] vk)).multiplyByCofactor().isIdentity()
```
### دوال التحويل

```
CONVERT_ED25519_PRIVATE(privkey) :=
    s = SHA-512(privkey)[0..32]
    s[0] = s[0] & 248
    s[31] = (s[31] & 63) | 64
    return s

CONVERT_ED25519_PUBLIC(pubkey) := pubkey
```
لاحظ أن تنفيذ `CONVERT_ED25519_PRIVATE` يعادل حساب العدد القياسي السري s عند اشتقاق مفتاح عام Ed25519 من مفتاح خاص Ed25519، كما هو محدد في الخطوات 1-3 من القسم 5.1.5 من [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).

## التداعيات الأمنية

إن إعادة عشوَنة وجهة Red25519 (نوع مفاتيح/تواقيع) ثم إنشاء تواقيع باستخدامها لا يسرّب أي معلومات عن الوجهة، لأن توزيع مفاتيح Red25519 الخاصة المُولَّدة عبر `RANDOMIZE_PRIVATE` مطابق لتوزيع المفاتيح الخاصة المُولَّدة عبر `GENERATE_PRIVATE`، و`DERIVE_PUBLIC` حتمي.

إن تحويل مفاتيح Ed25519 الخاصة (خوارزمية توقيع رقمية بمعيار 25519) إلى Red25519 (تمثيل مشتق من 25519 لتحويل المفاتيح) عبر `CONVERT_ED25519_PRIVATE` لا يؤدي إلى نفس التوزيع. ومع ذلك، نعتبر أن الانخفاض في مستوى الأمان مقبول للأسباب التالية:

- فضاء القيم القياسية لـ Ed25519 (نظام توقيع بيضوي) يساوي تقريبًا نصف حجم فضاء القيم القياسية لـ Red25519 (هناك 2^251 قيمة قياسية ممكنة لـ Ed25519، و L ~= 2^252 قيمة قياسية ممكنة لـ Red25519). وعليه فإن فقدان الأمان يبلغ في الحد الأقصى عاملًا يقارب 2، أو ما يقارب 1 بت (لأنه قد نكون قد اخترنا بالمصادفة قيمة قياسية لـ Red25519 تكون أيضًا صالحة كقيمة قياسية لـ Ed25519).
- وجهات Ed25519 القائمة كانت قد كُشِفت على الشبكة في السابق، ويُفترض أن عُقَد floodfills الخبيثة قد قامت بالفعل بتعدادها.

**هام**: ينبغي على المستخدمين القلقين بشأن هذا التخفيض في مستوى الأمان استخدام Red25519 (نوع التوقيع 11) بوصفه sigtype (نوع التوقيع) لِـ Destinations (الوجهات) الخاصة بهم بدلاً من Ed25519 (نوع التوقيع 7).

لاحظ أن الطرح أعلاه لا ينطبق على العدد القياسي لإعادة العشوائية alpha؛ إذ تتسرب معلومات عن المفتاح في كل مرة تُختار فيها alpha منحازة، لأن إعادة العشوائية بالجمع تتصرف مثل شفرة ذات استخدام واحد.

### حالة التدقيق الأمني

**إفصاح مهم**: لم يخضع I2P، بما في ذلك Red25519 (خوارزمية توقيع رقمية مستخدمة في I2P)، مطلقًا لتدقيق أمني رسمي من طرف ثالث. خضع التصميم الأساسي لـ RedDSA (مخطط توقيع رقمي) لمراجعة أمنية من قبل NCC Group (شركة تدقيق أمني) كجزء من تدقيق بروتوكول Zcash Sapling في عام 2018، حيث جرى تحديد المشكلات الأمنية وإصلاحها. ومع ذلك، فإن التطبيق الخاص بـ I2P باستخدام SHA-512 (دالة تجزئة) بدلاً من BLAKE2b-512 (دالة تجزئة) ومع I2P domain separation (آلية فصل المجالات التشفيرية في I2P) لم يخضع لتحليل مستقل.

خضع التطبيق المرجعي ed25519-java الذي طوّره str4d لتدقيق مستقل واحد من طرف ثالث، لكن ذلك سبق تنفيذ Red25519 (امتدادات لـ Ed25519) ولم يشمل سوى وظائف Ed25519 (خوارزمية توقيع رقمية)، دون امتدادات Red25519.

ينبغي على المستخدمين الذين يعتمدون Red25519 (تقنية تشفير) فهم هذا القيد وتقييم المفاضلات الأمنية بناءً على نموذج التهديد الخاص بهم.

## التوافق

ستكون إصدارات I2P التي تدعم Red25519 (نوع توقيع) قادرة على التحقق من هياكل بيانات الشبكة الموقعة به. أما إصدارات I2P التي لا تدعم Red25519 فستتعامل معه كتوقيع غير معروف، وقد تقوم بإسقاط هياكل البيانات.

**الجدول الزمني للنشر**: - **0.9.39** (مارس 2019): أول تنفيذ مع دعم Encrypted LS2 (نسخة LeaseSet2 مشفّرة) في floodfills - **0.9.40** (مايو 2019): تفويض لكل عميل لـ Encrypted LS2 - **0.9.41** (أغسطس 2019): Meta LS2 و Encrypted LS2 بمفاتيح غير متصلة بالإنترنت - **0.9.43** (فبراير 2020): دعم b32 لـ Encrypted LS2 - **0.9.47** (أغسطس 2020): إتمام المواصفات - **2.10.0** (أكتوبر 2025): إصدار الشبكة الحالي (ما يعادل 0.9.67+)

ينبغي للمستخدمين توقّع أن تكون موثوقية هياكل البيانات الموقّعة بـ Red25519 (خوارزمية توقيع) جيدةً لحالات استخدام Encrypted LeaseSet2، إذ إن الشبكة حظيت بأكثر من ست سنوات للترقية منذ التنفيذ الأولي. ومع ذلك، فإن مقاييس التبنّي لاستخدام الوجهات عمومًا غير متاحة علنًا.

**حالة الاستخدام الأساسية**: يُستخدم Red25519 (خوارزمية توقيع تدعم إعماء المفاتيح) أساساً لتمكين وظيفة Encrypted LeaseSet2 حيث يكون إعماء المفاتيح مطلوباً. بالنسبة إلى الوجهات القياسية التي لا تتطلب encrypted leaseset، يظل Ed25519 (نوع التوقيع 7) الخيار الموصى به نظرًا إلى توافقه الأوسع وسجلّه المثبت لفترة أطول.

## ملاحظات التنفيذ

Red25519 مُنفَّذة في I2P Java router في `net.i2p.crypto.eddsa.RedDSAEngine` وتستخدم مكتبة ed25519-java من str4d (Jack Grigg) كتَبعيّة في Maven بالمعرّف `net.i2p.crypto:eddsa` (الإصدارات من 0.1.0 حتى 0.3.0).

يدعم تنفيذ i2pd بلغة C++ أيضًا Red25519 (نوع توقيع رقمي مبني على Ed25519) (signaturetype=11) لنشر LeaseSet مشفّرة.

مثال تهيئة لـ i2pd:

```
signaturetype=11
i2cp.leaseSetType=5
```
**توافق LeaseSet2 المشفّر**: تشترط مواصفة LeaseSet المشفّر أن يكون المفتاح العام للتوقيع في الوجهة غير المُعمّاة من نوع Ed25519 (نوع التوقيع 7) أو Red25519 (نوع التوقيع 11). لا تُدعَم أي أنواع توقيع أخرى لوظائف LeaseSet المشفّر.

## متجهات الاختبار

تُوفَّر متجهات الاختبار التالية للتحقق من صحة التنفيذ. يتضمن كل متجه ما يلي:

- `edsk`: مفتاح Ed25519 خاص (عشوائي)
- `edpk`: مفتاح Ed25519 عام مقابل لـ edsk
- `sk`: CONVERT_ED25519_PRIVATE(edsk)
- `vk`: CONVERT_ED25519_PUBLIC(edpk)
- `msg`: الرسالة المراد توقيعها
- `sig`: SIGN(sk, msg)
- `alpha`: GENERATE_RANDOM()
- `rsk`: RANDOMIZE_PRIVATE(sk, alpha)
- `rvk`: RANDOMIZE_PUBLIC(vk, alpha)
- `rsig`: SIGN(rsk, msg)

**ملاحظة حول التنفيذ**: ينبغي دمج متجهات الاختبار هذه في أجنحة اختبارات الوحدات المؤتمتة بغرض التحقق المستمر. على المنفّذين التحقق من أن جميع التحويلات، والتواقيع، وعمليات إعادة العشوائية تطابق هذه القيم المتوقعة.

### متجه اختبار 1

```
edsk:  0101010101010101010101010101010101010101010101010101010101010101
edpk:  8a88e3dd7409f195fd52db2d3cba5d72ca6709bf1d94121bf3748801b40f6f5c
sk:    58e86efb75fa4e2c410f46e16de9f6acae1a1703528651b69bc176c088bef36e
vk:    8a88e3dd7409f195fd52db2d3cba5d72ca6709bf1d94121bf3748801b40f6f5c
msg:   0202020202020202020202020202020202020202020202020202020202020202
sig:   61f5527f4d3b46de4b2c234390370bf715ae9098907a0d191ba1b44b23a8ac1a
       6a40437a5294e9503faaf9bd2b7f2fe7ba44dec487b3185aba7ff7d7a17cd40f
alpha: ae9ba9cbbc047c442448fca7c9f4e288a202ed520bfad0c784b792b7773cee08
rsk:   8bb85f3c7a494a08890d7d142109c1a3501d04565d80227e2079097800fbe107
rvk:   6fe128737b8e76fa66698a748b0dc0a89168dd8a0601c2b1c0b26835d323e9b3
rsig:  533053074d3b44f08723aab988ede9880a001b7a684d4a98f2d1b88fabee07a5
       b5c9430c69a690321e0cb8365d7aeb6688bcbad2c0780e0c69e8a1b4a45f3001
```
### متجه الاختبار 2

```
edsk:  0202020202020202020202020202020202020202020202020202020202020202
edpk:  8139770ea87d175f56a35466c34c7ecccb8d8a91b4ee37a25df60f5b8fc9b394
sk:    a83c626bc9c38c8c201878ebb1d5b0b50ac40e8986c78793db1d4ef369fca14e
vk:    8139770ea87d175f56a35466c34c7ecccb8d8a91b4ee37a25df60f5b8fc9b394
msg:   0303030303030303030303030303030303030303030303030303030303030303
sig:   0829e58eb5399870f009bd1f0270264e556424bda7a93fbcec99f6d9d75db46d
       5c3cb546d9947ca7c1200876c8775a90c357a2aef3d2f16388242ee1914b1a0a
alpha: 98b615d9027e996cc2796c019d9c8beb46aa7d2b6eea2e5d98eb29eb1584c203
rsk:   9fcfaa734852ca40b3810ebef590e138516e8cb4f4b1b6f0730978de7f806402
rvk:   527e121090158419609e4a0d8de6f7d3271b353a8cd0b8172fe41468ea1e9177
rsig:  9a6961f35ed264a946cd6214b2326a6e6caa426c2a61bc14367fd278e0b5fb51
       3ac065a69210a457f17d12ba8a496cfd835002691affa8efcdecae48135c090f
```
**ملاحظة**: متجهات الاختبار الإضافية 3-10 تتبع نفس التنسيق ويمكن العثور عليها في التنفيذ المرجعي.

## المراجع

- [المقترح 123: إدخالات netDB جديدة](/proposals/123-new-netdb-entries/) - تم تنفيذ أجزاء منها ونشرها في 0.9.38 و0.9.39 والإصدارات اللاحقة
- [مواصفة بروتوكول Zcash، القسم 5.4.6: RedDSA وRedJubjub وRedPallas](https://zips.z.cash/protocol/protocol.pdf) - تم تعريف RedDSA (خوارزمية توقيع رقمية من عائلة EdDSA) كجزء من مواصفة بروتوكول Zcash؛ خضعت لتدقيق أمني من قِبل NCC Group (يناير 2019)
- [RFC 8032: خوارزمية التوقيع الرقمي بمنحنيات إدواردز (EdDSA)](https://www.rfc-editor.org/rfc/rfc8032.html)
- [المقترح 148: RedDSA-BLAKE2b-Ed25519](/proposals/148-eddsa-blake2b-ed25519/) - مُقترَح لكنه غير مُنفَّذ بعد؛ يقترح انتقالًا مستقبليًا إلى BLAKE2b-512
- [مواصفة LeaseSet المُشفَّر](/docs/specs/encryptedleaseset/)
- [مواصفة التشفير منخفض المستوى](/docs/specs/cryptography/)
