---
title: "إعلانات BitTorrent عبر UDP"
description: "مواصفة بروتوكول لإعلانات متتبع BitTorrent القائم على UDP في I2P"
slug: "udp-bittorrent-announces"
lastUpdated: "2025-10"
accurateFor: "2.10.0"
---

## نظرة عامة

توثّق هذه المواصفة بروتوكول إعلانات BitTorrent عبر UDP ضمن I2P. للاطّلاع على المواصفة العامة لـ BitTorrent في I2P، راجع [وثائق BitTorrent عبر I2P](/docs/applications/bittorrent/). للاطّلاع على خلفية ومعلومات إضافية حول تطوير هذه المواصفة، يُرجى مراجعة [المقترح 160](/proposals/160-udp-trackers/).

تمت الموافقة رسميًا على هذا البروتوكول في 24 يونيو 2025 وتم تنفيذُه في I2P الإصدار 2.10.0 (API 0.9.67)، الصادر في 8 سبتمبر 2025. دعم متتبعات UDP قيد التشغيل حاليًا على شبكة I2P مع عدة متتبعات في بيئة الإنتاج ودعم كامل لعميل i2psnark.

## التصميم

تستخدم هذه المواصفة Datagram2 القابل للرد، وDatagram3 القابل للرد، وداتاغرامات خام، كما هو مُعرَّف في [I2P Datagram Specification](/docs/api/datagrams/). Datagram2 وDatagram3 هما متغيران من الداتاغرامات القابلة للرد، ومُعرَّفان في [Proposal 163](/proposals/163-datagram2/). يضيف Datagram2 مقاومة هجمات إعادة الإرسال ودعم التوقيع دون اتصال. Datagram3 أصغر من تنسيق الداتاغرام القديم، لكنه من دون مصادقة.

### BEP 15

للمرجع، يكون تدفق الرسائل المُعرَّف في [BEP 15](http://www.bittorrent.org/beps/bep_0015.html) كما يلي:

```
Client                        Tracker
  Connect Req. ------------->
    <-------------- Connect Resp.
  Announce Req. ------------->
    <-------------- Announce Resp.
  Announce Req. ------------->
    <-------------- Announce Resp.
```
مرحلة الاتصال مطلوبة لمنع انتحال عناوين IP. يُرجِع المتعقّب معرّف اتصال يستخدمه العميل في عمليات announce (طلب إبلاغ المتعقّب) اللاحقة. ينتهي معرّف الاتصال هذا افتراضياً خلال دقيقة واحدة لدى العميل، وخلال دقيقتين لدى المتعقّب.

يستخدم I2P نفس تدفّق الرسائل كما في BEP 15 (اقتراح تحسين BitTorrent رقم 15)، لتسهيل التبنّي في قواعد الشفرة الحالية لبرمجيات العميل الداعمة لـ UDP، ولتحقيق الكفاءة، ولأسباب أمنية تُناقَش أدناه:

```
Client                        Tracker
  Connect Req. ------------->       (Repliable Datagram2)
    <-------------- Connect Resp.   (Raw)
  Announce Req. ------------->      (Repliable Datagram3)
    <-------------- Announce Resp.  (Raw)
  Announce Req. ------------->      (Repliable Datagram3)
    <-------------- Announce Resp.  (Raw)
           ...
```
قد يوفّر هذا وفراً كبيراً في عرض النطاق الترددي مقارنةً بإعلانات التدفق (TCP). وبينما يكون Datagram2 بحجمٍ يقارب حجم SYN (إشارة بدء المصافحة في TCP) عبر التدفق، فإن الاستجابة الخامّة أصغر بكثير من SYN ACK (استجابة الإقرار لطلب SYN في TCP) عبر التدفق. تستخدم الطلبات اللاحقة Datagram3، وتكون الاستجابات اللاحقة خامّة.

تكون طلبات الإعلان من نوع Datagram3 (تنسيق Datagram الإصدار 3) كي لا يضطر المُتعقِّب إلى الاحتفاظ بجدول مطابقة كبير يربط معرّفات الاتصال بوِجهة الإعلان أو بتجزئتها. وبدلاً من ذلك، يمكن للمتعقِّب توليد معرّفات الاتصال بشكلٍ تشفيري انطلاقاً من تجزئة المرسِل، والطابع الزمني الحالي (استناداً إلى فترة زمنية معيّنة)، وقيمة سرّية. عند استلام طلب إعلان، يتحقق المُتعقِّب من صحة معرّف الاتصال، ثم يستخدم تجزئة المرسِل في Datagram3 كوِجهة للإرسال.

### مدة الاتصال

[BEP 15](http://www.bittorrent.org/beps/bep_0015.html) يحدد أن معرف الاتصال ينتهي خلال دقيقة واحدة لدى العميل، وخلال دقيقتين لدى المتتبع. وهو غير قابل للضبط. وهذا يحد من مكاسب الكفاءة المحتملة، ما لم يقم العملاء بتجميع طلبات announce (إبلاغ المتتبع) لتنفيذها جميعا ضمن نافذة زمنية مدتها دقيقة واحدة. لا يقوم i2psnark حاليا بتجميع طلبات announce؛ بل يوزعها على فترات لتجنب اندفاعات مفاجئة في حركة المرور. تفيد التقارير بأن المستخدمين المتقدمين يشغلون آلاف ملفات التورنت في وقت واحد، وإطلاق هذا العدد الكبير من طلبات announce ضمن دقيقة واحدة ليس واقعيا.

نقترح هنا توسيع استجابة الاتصال لإضافة حقل اختياري لمدة الاتصال. إن لم يكن الحقل موجودًا، فالقيمة الافتراضية هي دقيقة واحدة. وإلا، فعلى العميل استخدام المدة المحددة بالثواني، وسيحتفظ المتعقّب بمعرّف الاتصال لدقيقة إضافية.

### التوافق مع BEP 15

يحافظ هذا التصميم على التوافق مع [BEP 15](http://www.bittorrent.org/beps/bep_0015.html) قدر الإمكان لتقليل التغييرات المطلوبة في العملاء والمتتبعات القائمة.

التغيير الوحيد المطلوب هو في تنسيق معلومات الأقران ضمن استجابة الإعلان. إضافة حقل العمر الافتراضي في استجابة الاتصال غير مطلوبة، لكنها موصى بها بشدة لتحسين الكفاءة، كما شُرح أعلاه.

### تحليل الأمن

هدف مهم لبروتوكول الإعلان عبر UDP هو منع انتحال العناوين. يجب أن يكون العميل موجوداً فعلاً وأن يضمّن leaseSet حقيقياً. ويجب أن يمتلك tunnels واردة لتلقي استجابة الاتصال. يمكن أن تكون هذه tunnels zero-hop (بدون قفزات) وتُنشأ فوراً، لكن ذلك سيكشف مُنشئها. يحقق هذا البروتوكول ذلك الهدف.

### المشكلات

هذا البروتوكول لا يدعم الوجهات المُعمّاة، لكن يمكن توسيعه لتحقيق ذلك. انظر أدناه.

## المواصفات

### البروتوكولات والمنافذ

تستخدم Datagram2 (حزمة بيانات) القابلة للرد بروتوكول I2CP رقم 19؛ وتستخدم Datagram3 القابلة للرد بروتوكول I2CP رقم 20؛ وتستخدم datagrams الخام بروتوكول I2CP رقم 18. قد تكون الطلبات Datagram2 أو Datagram3. أما الردود فهي دائماً خام. يجب عدم استخدام تنسيق Datagram القابل للرد الأقدم ("Datagram1") الذي يستخدم بروتوكول I2CP رقم 17 للطلبات أو الردود؛ ويجب إسقاطها إذا استُلمت على منافذ الطلب/الرد. لاحظ أن Datagram1 ببروتوكول 17 لا يزال يُستخدم لبروتوكول DHT.

تستخدم الطلبات قيمة I2CP "to port" (المنفذ الوجهة) المأخوذة من عنوان URL للإعلان؛ انظر أدناه. يتم اختيار "from port" (المنفذ المصدر) للطلب بواسطة العميل، لكن ينبغي أن يكون غير صفري، ومختلفًا عن المنافذ المستخدمة من قِبل DHT (جدول تجزئة موزع)، حتى يسهل تصنيف الاستجابات. ينبغي للمتعقّبات رفض الطلبات التي تُستقبل على منفذ غير صحيح.

تستخدم الاستجابات قيمة "to port" في I2CP من الطلب. يكون "from port" في الاستجابة هو نفسه "to port" من الطلب.

### عنوان URL للإبلاغ

تنسيق عنوان URL الخاص بالإعلان غير مُحدد في [BEP 15](http://www.bittorrent.org/beps/bep_0015.html)، ولكن كما في الشبكة العامة (clearnet)، تكون عناوين UDP الخاصة بالإعلان على الشكل "udp://host:port/path". يتم تجاهل المسار وقد يكون فارغًا، لكنه عادةً يكون "/announce" على الشبكة العامة (clearnet). يجب أن يكون جزء :port موجودًا دائمًا؛ ومع ذلك، إذا تم إهمال جزء ":port"، فاستخدم منفذ I2CP الافتراضي 6969، لأنه المنفذ الشائع على الشبكة العامة (clearnet). قد تُضاف أيضًا معلمات CGI مثل &a=b&c=d؛ ويمكن معالجة تلك وتمريرها في طلب الإعلان، انظر [BEP 41](http://www.bittorrent.org/beps/bep_0041.html). إذا لم تكن هناك معلمات أو مسار، فيمكن أيضًا حذف الشرطة المائلة النهائية /، كما يُفهم ضمنًا في [BEP 41](http://www.bittorrent.org/beps/bep_0041.html).

### تنسيقات Datagram (حزمة بيانات في شبكة عديمة الاتصال)

يتم إرسال جميع القيم بترتيب بايت الشبكة (big endian، حيث يُوضَع البايت الأعلى أهمية أولاً). لا تفترض أن تكون الحزم ذات حجم محدّد تماماً. قد تزيد الامتدادات المستقبلية من حجم الحزم.

#### طلب اتصال

من العميل إلى المتعقب. 16 بايت. يجب أن يكون Datagram2 (حزمة بيانات من الجيل الثاني) قابلاً للرد. مماثل لما في [BEP 15](http://www.bittorrent.org/beps/bep_0015.html). لا تغييرات.

```
Offset  Size            Name            Value
0       64-bit integer  protocol_id     0x41727101980 // magic constant
8       32-bit integer  action          0 // connect
12      32-bit integer  transaction_id
```
#### استجابة الاتصال

من المتتبع إلى العميل. 16 أو 18 بايت. يجب أن تكون بصيغتها الخام. مماثلة لما في [BEP 15](http://www.bittorrent.org/beps/bep_0015.html) باستثناء ما هو مذكور أدناه.

```
Offset  Size            Name            Value
0       32-bit integer  action          0 // connect
4       32-bit integer  transaction_id
8       64-bit integer  connection_id
16      16-bit integer  lifetime        optional  // Change from BEP 15
```
يجب أن تُرسَل الاستجابة إلى "to port" في I2CP (بروتوكول عميل I2P)، والذي استُلم باعتباره "from port" في الطلب.

حقل lifetime اختياري ويشير إلى مدة صلاحية connection_id لدى العميل بالثواني. القيمة الافتراضية 60، والحد الأدنى—إذا تم تحديده—هو 60. الحد الأقصى 65535، أي نحو 18 ساعة. ينبغي على المتعقب الاحتفاظ بـ connection_id لمدة تزيد 60 ثانية على المدة التي يحددها العميل.

#### طلب إعلان

من العميل إلى المتعقّب. 98 بايت كحد أدنى. يجب أن يكون Datagram3 قابلاً للرد (نوع حزمة بيانات يمكن الرد عليها). مماثل لما هو في [BEP 15](http://www.bittorrent.org/beps/bep_0015.html) باستثناء ما هو مذكور أدناه.

قيمة connection_id هي كما تم استلامها في استجابة connect.

```
Offset  Size            Name            Value
0       64-bit integer  connection_id
8       32-bit integer  action          1     // announce
12      32-bit integer  transaction_id
16      20-byte string  info_hash
36      20-byte string  peer_id
56      64-bit integer  downloaded
64      64-bit integer  left
72      64-bit integer  uploaded
80      32-bit integer  event           0     // 0: none; 1: completed; 2: started; 3: stopped
84      32-bit integer  IP address      0     // default, unused in I2P
88      32-bit integer  key
92      32-bit integer  num_want        -1    // default
96      16-bit integer  port                  // must be same as I2CP from port
98      varies          options     optional  // As specified in BEP 41
```
التغييرات مقارنةً بـ [BEP 15](http://www.bittorrent.org/beps/bep_0015.html):

- يتم تجاهل المفتاح
- عنوان IP غير مستخدم
- من المحتمل تجاهل المنفذ، ولكن يجب أن يطابق منفذ I2CP المصدر
- قسم الخيارات، إن وُجد، يكون كما هو معرّف في [BEP 41](http://www.bittorrent.org/beps/bep_0041.html)

يجب حتماً إرسال الاستجابة إلى "to port" الخاص بـ I2CP والذي تم استلامه بوصفه "from port" في الطلب. لا تستخدم المنفذ من طلب الإعلان.

#### استجابة الإعلان

من الـ Tracker (خادوم التعقّب) إلى العميل. 20 بايت كحد أدنى. يجب أن تكون خامًا. مماثل لما ورد في [BEP 15](http://www.bittorrent.org/beps/bep_0015.html) إلا كما هو مبيّن أدناه.

```
Offset  Size            Name            Value
0           32-bit integer  action          1 // announce
4           32-bit integer  transaction_id
8           32-bit integer  interval
12          32-bit integer  leechers
16          32-bit integer  seeders
20   32 * n 32-byte hash    binary hashes     // Change from BEP 15
...                                           // Change from BEP 15
```
التغييرات مقارنةً بـ [BEP 15](http://www.bittorrent.org/beps/bep_0015.html):

- بدلًا من IPv4+port بطول 6 بايت أو IPv6+port بطول 18 بايت، نُرجِع عددًا مضاعفًا من "compact responses" (استجابات مضغّطة) بحجم 32 بايت، مع تجزئات الأقران الثنائية بـ SHA-256. وكما هو الحال مع استجابات TCP المضغّطة، لا نضمّن منفذًا.

يجب إرسال الاستجابة إلى I2CP "to port" الذي تم استلامه كـ "from port" للطلب. لا تستخدم المنفذ الوارد في طلب الإعلان.

يبلغ الحد الأقصى لحجم I2P datagrams (رُزم بيانات مستقلة) نحو 64 KB وهو كبير جداً؛ ومع ذلك، ولضمان تسليم موثوق، ينبغي تجنب datagrams التي تتجاوز 4 KB. ومن أجل كفاءة استخدام النطاق الترددي، يجدر بالمتعقبات تقييد عدد الأقران الأقصى إلى نحو 50، وهو ما يعادل حزمة بحجم يقارب 1600 بايت قبل العبء الإضافي على الطبقات المختلفة، وينبغي أن يبقى ضمن حد الحمولة الخاص برسالتين tunnel بعد التجزئة.

كما في BEP 15، لا يتم تضمين عدد لعناوين النظراء (IP/port في حالة BEP 15، والتجزئات هنا) التي ستأتي لاحقًا. ورغم أن BEP 15 لا يتناول ذلك، يمكن تعريف علامة نهاية للنظراء تتكوّن من أصفار بالكامل للدلالة على اكتمال معلومات النظراء وأن بعض بيانات الامتداد ستليها.

لتمكين التوسعة في المستقبل، ينبغي للعملاء تجاهل قيمة تجزئة بطول 32 بايت كلها أصفار، وأي بيانات تليها. ينبغي لخوادم التتبع رفض طلبات announce الواردة من تجزئة كلها أصفار، مع أن تلك التجزئة محظورة أصلًا بواسطة Java routers.

#### استخلاص البيانات

طلب/استجابة scrape (استعلام إحصاءات التتبع) من [BEP 15](http://www.bittorrent.org/beps/bep_0015.html) غير مطلوبين في هذه المواصفة، ولكن يمكن تنفيذهما عند الرغبة، دون الحاجة إلى أي تغييرات. يجب على العميل الحصول أولاً على معرّف اتصال. يكون طلب scrape دائمًا repliable (قابل للرد) Datagram3 (نسخة Datagram الثالثة). وتكون استجابة scrape دائمًا raw (خام/غير قابل للرد).

#### استجابة خطأ

من المتعقب إلى العميل. 8 بايت كحد أدنى (إذا كانت الرسالة فارغة). يجب أن يكون خامًا. مماثل لما هو في [BEP 15](http://www.bittorrent.org/beps/bep_0015.html). لا تغييرات.

```
Offset  Size            Name            Value
0       32-bit integer  action          3 // error
4       32-bit integer  transaction_id
8       string          message
```
## الامتدادات

لا تُدرج بتات الامتداد أو حقل الإصدار. لا ينبغي للعملاء والمتتبّعات افتراض أن للحزم حجماً معيّناً. وبهذه الطريقة يمكن إضافة حقول إضافية دون الإخلال بالتوافق. يُوصى باستخدام تنسيق الامتدادات المحدد في [BEP 41](http://www.bittorrent.org/beps/bep_0041.html) عند الحاجة.

تم تعديل استجابة الاتصال لإضافة مدة صلاحية اختيارية لمعرّف الاتصال.

إذا كان مطلوباً دعم الوجهة blinded (بتقنية التعمية العمياء)، فيمكننا إما إضافة العنوان blinded بطول 35 بايت إلى نهاية طلب الإعلان، أو طلب التجزئات blinded ضمن الاستجابات، باستخدام تنسيق [BEP 41](http://www.bittorrent.org/beps/bep_0041.html) (المعلمات قيد التحديد). يمكن إضافة مجموعة عناوين الأقران blinded بطول 35 بايت إلى نهاية رد الإعلان، بعد تجزئة بطول 32 بايت كلها أصفار.

## إرشادات التنفيذ

انظر قسم التصميم أعلاه لمناقشة التحديات التي تواجه العملاء غير المدمجين وغير المعتمدين على I2CP والمتعقبات.

### العملاء

بالنسبة لاسم مضيف متتبّع معيّن، ينبغي للعميل تفضيل عناوين URL الخاصة بـ UDP على عناوين HTTP، وألا يُعلِن لكليهما معًا.

العملاء الذين لديهم دعم BEP 15 قائم بالفعل ينبغي ألا يحتاجوا إلا إلى تعديلات طفيفة.

إذا كان العميل يدعم DHT (جدول تجزئة موزع) أو بروتوكولات datagram (رزم بيانات عديمة الاتصال) أخرى، فمن الأفضل أن يختار منفذًا مختلفًا كحقل "from port" في الطلب، بحيث تعود الردود إلى ذلك المنفذ ولا تختلط برسائل DHT. لا يتلقى العميل سوى datagrams خام على شكل ردود. لن ترسل خوادم التتبع مطلقًا datagram2 قابلة للرد إلى العميل.

ينبغي على العملاء الذين لديهم قائمة افتراضية من opentrackers (متعقّبات مفتوحة) تحديث القائمة لإضافة عناوين URL الخاصة بـ UDP بعد التأكد من أنّ opentrackers المعروفة تدعم UDP.

قد يطبّق العملاء إعادة إرسال للطلبات وقد لا يطبّقونها. وإذا نُفِّذت إعادة الإرسال، فينبغي استخدام مهلة أولية لا تقل عن 15 ثانية، مع مضاعفة المهلة في كل مرة تُعاد فيها عملية الإرسال (exponential backoff، تراجع أسي).

يجب على العملاء التراجع بعد تلقي استجابة خطأ.

### خوادم التتبّع

ينبغي ألا تتطلب المتعقّبات ذات الدعم القائم لـ BEP 15 سوى تعديلات طفيفة. تختلف هذه المواصفة عن مقترح عام 2014، إذ يجب على المتعقّب دعم استقبال كل من datagram2 (حزمة بيانات بدون اتصال) وdatagram3 القابلتين للرد على نفس المنفذ.

لتقليل متطلبات موارد المتعقّب، صُمّم هذا البروتوكول لإلغاء أي حاجة إلى أن يحتفظ المتعقّب بعمليات الربط بين قيم التجزئة الخاصة بالعملاء ومعرّفات الاتصال بغرض التحقق لاحقًا. وهذا ممكن لأن حزمة طلب الإعلان هي حزمة Datagram3 (صيغة الحزم الإصدار 3) قابلة للرد، لذا فهي تتضمن تجزئة المُرسِل.

التنفيذ الموصى به هو:

- عرّف الـ epoch (فترة زمنية مرجعية) الحالي باعتباره الوقت الحالي بدقة مساوية لمدة حياة الاتصال، `epoch = now / lifetime`.
- عرّف دالة تجزئة تشفيرية `H(secret, clienthash, epoch)` تولّد مُخرجًا بطول 8 بايت.
- ولّد السر الثابت العشوائي المستخدم لجميع الاتصالات.
- في استجابات الاتصال، ولّد `connection_id = H(secret, clienthash, epoch)`
- في طلبات الإعلان، تحقّق من صحة معرّف الاتصال المستلم ضمن الـ epoch الحالي عبر التحقق من `connection_id == H(secret, clienthash, epoch) || connection_id == H(secret, clienthash, epoch - 1)`

## حالة النشر

تمت الموافقة على هذا البروتوكول في 24 يونيو 2025 وهو يعمل بكامل طاقته على شبكة I2P اعتبارًا من سبتمبر 2025.

### التنفيذات الحالية

**i2psnark**: تم تضمين الدعم الكامل لمتعقّبات UDP في I2P الإصدار 2.10.0 (API 0.9.67)، الصادر في 8 سبتمبر 2025. تتضمن جميع تثبيتات I2P اعتبارًا من هذا الإصدار فصاعدًا دعم متعقّبات UDP افتراضيًا.

**zzzot tracker**: يدعم الإصدار 0.20.0-beta2 وما بعده UDP announces (طلبات الإعلان عبر UDP). اعتباراً من أكتوبر 2025، المتتبعات الإنتاجية التالية قيد التشغيل: - opentracker.dg2.i2p - opentracker.simp.i2p - opentracker.skank.i2p

### ملاحظات حول توافق العميل

**قيود SAM v3.3**: عملاء BitTorrent الخارجيون الذين يستخدمون SAM (Simple Anonymous Messaging — المراسلة المجهولة البسيطة) تتطلب دعم SAM v3.3 لـ Datagram2/3. هذا متوفر في Java I2P ولكنه غير مدعوم حالياً من قبل i2pd (تنفيذ I2P بلغة C++)، مما قد يحد من التبني في العملاء المعتمدين على libtorrent مثل qBittorrent.

**عملاء I2CP**: يمكن للعملاء الذين يستخدمون I2CP مباشرةً (مثل BiglyBT) إضافة دعم لمتعقّبات UDP دون قيود SAM.

## المراجع

- **[BEP15]**: [بروتوكول متعقب UDP الخاص بـ BitTorrent](http://www.bittorrent.org/beps/bep_0015.html)
- **[BEP41]**: [امتدادات بروتوكول متعقب UDP](http://www.bittorrent.org/beps/bep_0041.html)
- **[DATAGRAMS]**: [مواصفة داتاغرامات I2P](/docs/api/datagrams/)
- **[Prop160]**: [مقترح متعقبات UDP](/proposals/160-udp-trackers/)
- **[Prop163]**: [مقترح Datagram2](/proposals/163-datagram2/)
- **[SPEC]**: [BitTorrent عبر I2P](/docs/applications/bittorrent/)
