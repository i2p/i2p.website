### ```markdown
---
title: "تعدد المنازل غير المرئي"
number: "140"
author: "str4d"
created: "2017-05-22"
lastupdated: "2017-07-04"
status: "مفتوح"
thread: "http://zzz.i2p/topics/2335"
---

## نظرة عامة

يقترح هذا الاقتراح تصميم لبروتوكول يمكن عميل أو خدمة I2P أو عملية موازن خارجية من إدارة عدة أجهزة توجيه تستضيف وجهة واحدة شفافية.

الاقتراح حاليًا لا يحدد تنفيذًا ملموسًا. يمكن تنفيذه كامتداد لـ [I2CP]، أو كبروتوكول جديد.


## الدافع

تعدد المنازل هو حيث يتم استخدام عدة أجهزة توجيه لاستضافة نفس الوجهة.
الطريقة الحالية لتعدد المنازل مع I2P هي تشغيل نفس الوجهة على كل جهاز توجيه بشكل مستقل؛ الجهاز الذي يتم استخدامه من قبل العملاء في أي وقت معين هو آخر جهاز ينشر [LeaseSet].

هذه حيلة ومن المحتمل أنها لن تعمل بشكل جيد للمواقع الكبيرة على نطاق واسع. لنقل أنه لدينا 100 جهاز توجيه لتعدد المنازل كل منها لديه 16 نفق. هذا يعني نشر 1600 LeaseSet كل 10 دقائق، أو ما يقرب من 3 في الثانية. الفيضانات ستتغلب عليها والضوابط ستبدأ وتعمل. وهذا قبل حتى أن نذكر حركة المرور الاستطلاعية.

[Prop123] يحل هذه المشكلة مع Meta-LeaseSet، التي تسرد 100 هش من LeaseSets الحقيقية. يصبح البحث عملية من مرحلتين: الأولى تبحث عن  Meta-LeaseSet، ثم عن أحد LeaseSets المسماة. هذا حل جيد لمشكلة حركة المرور الاستطلاعية، لكنه بمفرده يخلق ثغرة خصوصية كبيرة: من الممكن تحديد أي أجهزة توجيه لتعدد المنازل متصلة عبر مراقبة الميتا- LeaseSet المنشورة، لأن كل LeaseSet حقيقية تتوافق مع جهاز توجيه واحد.

نحن بحاجة إلى طريقة تمكن عميل I2P أو الخدمة لتوزيع وجهة واحدة عبر عدة أجهزة توجيه، بطريقة لا يمكن تمييزها عن استخدام جهاز توجيه واحد (من منظور LeaseSet نفسه).


## التصميم

### التعريفات

    المستخدم
        الشخص أو المنظمة التي ترغب في تعدد المنازل لوجهة (وجهات) الخاصة بها. تُعتبر وجهة واحدة هنا بدون فقدان العمومية (WLOG).

    العميل
        التطبيق أو الخدمة التي تعمل خلف الوجهة. قد يكون تطبيقًا للعميل، أو للخادم، أو تطبيقًا نظير لنظير؛ نشير إليه كعميل بمعنى أنه يتصل بأجهزة توجيه I2P.

        يتكون العميل من ثلاثة أجزاء، والتي قد تكون جميعها في نفس العملية أو قد تكون مقسمة عبر عمليات أو أجهزة (في إعداد متعدد العملاء):

        الموازن
            جزء من العميل الذي يدير اختيار الأقران وبناء الأنفاق. هناك موازن واحد في أي وقت، ويتواصل مع جميع أجهزة توجيه I2P. قد يكون هناك موازنات لتبديل الفشل.

        الواجهة الأمامية
            جزء من العميل يمكن تشغيله بالتوازي. كل واجهة أمامية تتواصل مع جهاز توجيه I2P واحد.

        الواجهة الخلفية
            الجزء من العميل الذي يشارك بين جميع الواجهات الأمامية. لا يوجد له اتصال مباشر مع أي جهاز توجيه I2P.

    جهاز التوجيه
        جهاز توجيه I2P يتم تشغيله من قبل المستخدم ويعمل عند حد الشبكة I2P وشبكة المستخدم (يشبه جهاز الحافة في الشبكات المؤسسية). يبني الأنفاق تحت قيادة موازن، ويوجه الحزم للعميل أو الواجهة الأمامية.

### نظرة عامة عالية المستوى

تخيل التكوين المطلوب التالي:

- تطبيق عميل مع وجهة واحدة.
- أربعة أجهزة توجيه، يدير كل منها ثلاثة أنفاق واردة.
- يجب أن يتم نشر جميع الأنفاق الاثني عشر في LeaseSet واحدة.

عميل واحد

```
                -{ [Tunnel 1]===\
                 |-{ [Tunnel 2]====[Router 1]-----
                 |-{ [Tunnel 3]===/               \
                 |                                 \
                 |-{ [Tunnel 4]===\                 \
  [Destination]  |-{ [Tunnel 5]====[Router 2]-----   \
    \            |-{ [Tunnel 6]===/               \   \
     [LeaseSet]--|                               [Client]
                 |-{ [Tunnel 7]===\               /   /
                 |-{ [Tunnel 8]====[Router 3]-----   /
                 |-{ [Tunnel 9]===/                 /
                 |                                 /
                 |-{ [Tunnel 10]==\               /
                 |-{ [Tunnel 11]===[Router 4]-----
                  -{ [Tunnel 12]==/

متعدد العملاء

```
                -{ [Tunnel 1]===\
                 |-{ [Tunnel 2]====[Router 1]---------[Frontend 1]
                 |-{ [Tunnel 3]===/          \                    \
                 |                            \                    \
                 |-{ [Tunnel 4]===\            \                    \
  [Destination]  |-{ [Tunnel 5]====[Router 2]---\-----[Frontend 2]   \
    \            |-{ [Tunnel 6]===/          \   \                \   \
     [LeaseSet]--|                         [Balancer]            [Backend]
                 |-{ [Tunnel 7]===\          /   /                /   /
                 |-{ [Tunnel 8]====[Router 3]---/-----[Frontend 3]   /
                 |-{ [Tunnel 9]===/            /                    /
                 |                            /                    /
                 |-{ [Tunnel 10]==\          /                    /
                 |-{ [Tunnel 11]===[Router 4]---------[Frontend 4]
                  -{ [Tunnel 12]==/

### عملية عميل عامة
- تحميل أو إنشاء وجهة.

- افتح جلسة مع كل جهاز توجيه، مرتبطة بالوجهة.

- دوريًا (حوالي كل عشر دقائق، ولكن أكثر أو أقل بناءً على حياة الأنفاق):

  - احصل على الطبقة السريعة من كل جهاز توجيه.

  - استخدم مجموعة الأقران لبناء الأنفاق إلى/من كل جهاز توجيه.

    - افتراضيًا، الأنفاق إلى/من جهاز توجيه معين ستستخدم الأقران من تلك الطبقة السريعة للجهاز، لكن هذا ليس مفروضًا من قبل البروتوكول.

  - اجمع مجموعة الأنفاق الواردة النشطة من جميع أجهزة التوجيه النشطة، وأنشئ LeaseSet.

  - نشر LeaseSet من خلال واحد أو أكثر من الأجهزة التوجيهية.

### الاختلافات عن I2CP
لإنشاء وإدارة هذا التكوين، يحتاج العميل الوظائف الجديدة التالية بالإضافة إلى ما يوفره حاليًا [I2CP]:

- إخبار جهاز توجيه ببناء أنفاق، بدون إنشاء LeaseSet لها.
- الحصول على قائمة بالأنفاق الحالية في المسبح الوارد.

بالإضافة إلى ذلك، فإن الوظيفة التالية ستمكن من مرونة كبيرة في كيفية إدارة العميل لأنفاقه:

- الحصول على محتويات الطبقة السريعة لجهاز التوجيه.
- إخبار جهاز توجيه ببناء نفق وارد أو صادر باستخدام قائمة محددة من الأقران.

### مخطط البروتوكول

```
         Client                           Router

                    --------------------->  إنشاء جلسة
   حالة الجلسة  <---------------------
                    --------------------->  احصل على الطبقة السريعة
        قائمة الأقران  <---------------------
                    --------------------->  إنشاء نفق
    حالة النفق  <---------------------
                    --------------------->  احصل على مسبح الأنفاق
      قائمة الأنفاق  <---------------------
                    --------------------->  نشر LeaseSet
                    --------------------->  إرسال حزمة
      حالة الإرسال  <---------------------
  تم استلام الحزمة  <---------------------

### الرسائل
    إنشاء جلسة
        إنشاء جلسة للوجهة المعطاة.

    حالة الجلسة
        تأكيد على أن الجلسة قد تم إعدادها، ويمكن للعميل الآن البدء في بناء الأنفاق.

    احصل على الطبقة السريعة
        طلب قائمة بالأقران الذين يعتبرهم جهاز التوجيه حاليًا لبناء الأنفاق من خلالهم.

    قائمة الأقران
        قائمة بالأقران المعروفة لجهاز التوجيه.

    إنشاء نفق
        طلب بناء نفق جديد عبر الأقران المحددين.

    حالة النفق
        نتيجة لبناء نفق معين، بمجرد توفره.

    احصل على مسبح الأنفاق
        طلب قائمة بالأنفاق الحالية في المسبح الوارد أو الصادر للوجهة.

    قائمة الأنفاق
        قائمة بالأنفاق للمسبح المطلوب.

    نشر LeaseSet
        طلب من جهاز التوجيه نشر LeaseSet المقدم من خلال أحد الأنفاق الصادرة للوجهة. لا يلزم رد على الحالة؛ يجب أن يستمر جهاز التوجيه في المحاولة حتى يكون راضيًا عن نشر LeaseSet.

    إرسال حزمة
        حزمة صادرة من العميل. يحدد اختياريًا نفقًا صادرًا يجب (يجب؟) إرسال الحزمة عبره.

    حالة الإرسال
        يُعلم العميل بنجاح أو فشل إرسال حزمة.

    تم استلام الحزمة
        حزمة واردة للعميل. يحدد اختياريًا النفق الوارد الذي تم استقبال الحزمة عبره (?)


## الآثار الأمنية

من منظور أجهزة التوجيه، هذا التصميم مكافئ وظيفيًا للوضع الراهن. لا يزال جهاز التوجيه ينشئ جميع الأنفاق، ويحافظ على ملفات تعريف الأقران الخاصة به، ويفرض الفصل بين عمليات جهاز التوجيه والعميل. في التكوين الافتراضي يكون متطابقًا تمامًا، لأن الأنفاق لذلك الجهاز تم إنشاؤها من طبقته السريعة الخاصة.

من منظور netDB، فإن LeaseSet واحد تم إنشاؤه عبر هذا البروتوكول يكون متطابقًا مع الوضع الراهن، لأنه يستفيد من الوظائف الموجودة مسبقًا.
ومع ذلك، بالنسبة لـ LeaseSets الأكبر التي تقترب من 16 ليز، قد يكون من الممكن للمراقب تحديد أن LeaseSet هي متعددة المنازل:

- الحجم الأقصى الحالي للطبقة السريعة هو 75 قرينًا. يتم اختيار البوابة الواردة (IBGW، العقدة التي يتم نشرها في Lease) من جزء من الطبقة (مجزأ عشوائيًا لكل نفق من المسبح عبر هاش، وليس العد).

      1 قفزة
          الطبقة السريعة بالكامل

      2 قفزات
          نصف الطبقة السريعة
          (الافتراضي حتى منتصف 2014)

      3+ قفزات
          ربع الطبقة السريعة
          (3 هو الافتراضي الحالي)

  وهذا يعني أن المتوسط سيكون IBGWs من مجموعة من 20-30 قرينًا.

- في إعداد واحد للمنزل، سيكون لدى LeaseSet كامل من 16 نفقًا 16 IBGWs يتم اختيارهم عشوائيًا من مجموعة تصل إلى (لنقل) 20 قرينًا.

- في إعداد متعدد المنازل لـ 4 أجهزة توجيه باستخدام التكوين الافتراضي، سيكون لدى LeaseSet كامل من 16 نفقًا 16 IBGWs يتم اختيارهم عشوائيًا من مجموعة تتكون من كحد أقصى 80 قرينًا، على الرغم من أنه من المحتمل أن يكون هناك جزء من الأقران المشتركين بين أجهزة التوجيه.

وبالتالي مع التكوين الافتراضي، قد يكون من الممكن من خلال التحليل الإحصائي معرفة أن LeaseSet يتم إنشاؤه بواسطة هذا البروتوكول. قد يكون أيضًا ممكنًا معرفة عدد أجهزة التوجيه الموجودة، على الرغم من أن تأثير التذبذب على الطبقات السريعة سيقلل من فعالية هذا التحليل.

حيث أن العميل لديه سيطرة كاملة على اختيار الأقران، يمكن تقليل أو التخلص من هذه المعلومات المسربة عن طريق اختيار IBGWs من مجموعة أقران مخفضة.


## التوافق

هذا التصميم متوافق تمامًا مع الشبكة، لأنه لا توجد تغييرات في تنسيق [LeaseSet](http://localhost:63465/en/docs/specs/common-structures/#leaseset). يجب أن تكون جميع أجهزة التوجيه على دراية بالبروتوكول الجديد، لكن هذا ليس مصدر قلق حيث سيتم التحكم بها جميعاً من نفس الكيان.


## ملاحظات الأداء والتوسعية

الحد الأقصى البالغ 16 [Leases](http://localhost:63465/en/docs/specs/common-structures/#lease) لكل LeaseSet لم يتغير بسبب هذا الاقتراح. بالنسبة للوجهات التي تتطلب المزيد من الأنفاق أكثر من هذا، هناك تعديلان محتملان للشبكة:

- زيادة الحد الأقصى لحجم LeaseSets. سيكون هذا أبسط في التنفيذ (على الرغم من أنه لا يزال يتطلب دعم الشبكة بشكل شامل قبل أن يتم استخدامه على نطاق واسع)، ولكن يمكن أن يؤدي إلى عمليات بحث أبطأ بسبب حجم الحزم الأكبر. الحد الأقصى للحجم الممكن لـ LeaseSet معرف بواسطة MTU للنقلات الأساسية، وبالتالي يكون حوالي 16 كيلو بايت.

- تنفيذ [Prop123] ل LeaseSets المصفاة. بالتزامن مع هذا الاقتراح، يمكن توزيع الوجهات لـ sub-LeaseSets عبر أجهزة توجيه متعددة، مما يعمل فعلاً وكأنه عناوين IP متعددة لخدمة الانترنت النظيفة.


## اعترافات

شكرًا لـ psi على النقاش الذي أدى إلى هذا الاقتراح.
