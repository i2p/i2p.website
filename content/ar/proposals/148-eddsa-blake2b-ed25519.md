---
title: "RedDSA-BLAKE2b-Ed25519"
number: "148"
author: "zzz"
created: "2019-03-12"
lastupdated: "2019-04-11"
status: "Open"
thread: "http://zzz.i2p/topics/2689"
---

## نظرة عامة

يضيف هذا الاقتراح نوع توقيع جديد باستخدام BLAKE2b-512 مع سلاسل التخصيص والملح، ليحل محل SHA-512. هذا سيقضي على ثلاث فئات من الهجمات المحتملة.

## الدافع

خلال المناقشات وتصميم NTCP2 (الاقتراح 111) وLS2 (الاقتراح 123)، أجرينا دراسة سريعة لمختلف الهجمات الممكنة، وكيفية منعها. ثلاثة من هذه الهجمات هي هجمات تمديد الطول، وهجمات البروتوكول المتداخل، وهجمات التعرف على الرسائل المكررة.

لكلا من NTCP2 وLS2، قررنا أن هذه الهجمات ليست ذات صلة مباشرة بالاقتراحات المتاحة، وأن أي حلول تعارض الهدف من تقليل البدائل الجديدة. أيضًا، قررنا أن سرعة دوال التجزئة في هذه البروتوكولات لم تكن عاملًا مهمًا في قراراتنا. لذلك، أجلنا الحل إلى اقتراح منفصل في الغالب. بينما أضفنا بعض ميزات التخصيص إلى مواصفة LS2، لم نشترط أي دوال تجزئة جديدة.

تستخدم العديد من المشاريع، مثل ZCash [ZCASH]، خوارزميات التوقيع ودوال التجزئة المبنية على خوارزميات أحدث ليست عرضة للهجمات التالية.

### هجمات تمديد الطول

SHA-256 وSHA-512 عرضة لهجمات تمديد الطول (LEA) [LEA]. يحدث هذا عندما يتم توقيع البيانات الفعلية، وليس تجزئتها. في معظم بروتوكولات I2P (التدفقات، والبتات، وقاعدة البيانات الشبكية، وغيرها)، يتم توقيع البيانات الفعلية. هناك استثناء واحد هو ملفات SU3، حيث يتم توقيع التجزئة. الاستثناء الآخر هو البتات الموقعة لـ DSA (نوع التوقيع 0) فقط، حيث يتم توقيع التجزئة. لأصناف البتات الموقعة الأخرى، يتم توقيع البيانات.

### هجمات البروتوكول المتداخل

قد تكون البيانات الموقعة في بروتوكولات I2P عرضة لهجمات البروتوكول المتداخل (CPA) بسبب عدم وجود فصل في النطاق. هذا يسمح للمهاجم باستخدام البيانات المتلقاة في سياق واحد (مثل البت الموقع) وتقديمها على أنها بيانات موقعة صالحة في سياق آخر (مثل التدفق أو قاعدة البيانات الشبكية). رغم أنه من غير المحتمل أن يتم تحليل البيانات الموقعة من سياق واحد كبيانات صالحة في سياق آخر، يصعب أو يستحيل تحليل جميع الحالات لمعرفة ذلك على وجه اليقين. بالإضافة إلى ذلك، في بعض السياقات، قد يكون من الممكن للمهاجم دفع الضحية لتوقيع بيانات مصممة خصيصًا قد تكون بيانات صالحة في سياق آخر. مرة أخرى، يصعب أو يستحيل تحليل جميع الحالات لمعرفة ذلك على وجه اليقين.

### هجمات التعرف على الرسائل المكررة

قد تكون بروتوكولات I2P عرضة لهجمات التعرف على الرسائل المكررة (DMI). هذا قد يسمح للمهاجم بالتعرف على أن رسالتين موقعتين لديهما نفس المحتوى، حتى إذا كانت هذه الرسائل وتواقيعها مشفرة. رغم أنه من غير المحتمل بسبب طرق التشفير المستخدمة في I2P، يصعب أو يستحيل تحليل جميع الحالات لمعرفة ذلك على وجه اليقين. باستخدام دالة تجزئة توفر طريقة لإضافة ملح عشوائي، ستكون جميع التواقيع مختلفة حتى عند توقيع نفس البيانات. بينما يقوم Red25519 كما هو معرف في الاقتراح 123 بإضافة ملح عشوائي إلى دالة التجزئة، فإن هذا لا يحل المشكلة لمجموعات الإيجار غير المشفرة.

### السرعة

رغم أنها ليست الدافع الرئيسي لهذا الاقتراح، فإن SHA-512 بطيئة نسبيًا، وهناك دوال تجزئة أسرع متاحة.

## الأهداف

- منع الهجمات المذكورة أعلاه
- تقليل استخدام بدائل التشفير الجديدة
- استخدام بدائل التشفير الثابتة والمثبتة
- استخدام المنحنيات القياسية
- استخدام البدائل الأسرع إذا كانت متاحة

## التصميم

قم بتعديل نوع التوقيع الحالي RedDSA_SHA512_Ed25519 لاستخدام BLAKE2b-512 بدلاً من SHA-512. أضف سلاسل تخصيص فريدة لكل استخدام. يمكن استخدام نوع التوقيع الجديد لكل من مجموعات الإيجار غير المشفرة والمغطاة.

## المبررات

- BLAKE2b غير عرضة لـ LEA [BLAKE2].
- BLAKE2b يوفر طريقة قياسية لإضافة سلاسل التخصيص لفصل النطاق
- BLAKE2b يوفر طريقة قياسية لإضافة ملح عشوائي لمنع DMI.
- BLAKE2b أسرع من SHA-256 وSHA-512 (وMD5) على الأجهزة الحديثة، وفقاً لـ [BLAKE2].
- Ed25519 لا يزال نوع توقيعنا الأسرع، أسرع بكثير من ECDSA، على الأقل في جافا.
- Ed25519 [ED25519-REFS] يتطلب دالة تجزئة مشفرة بطول 512 بت. لا يحدد SHA-512. BLAKE2b مناسب تمامًا لدالة التجزئة.
- BLAKE2b متاح على نطاق واسع في المكتبات للعديد من لغات البرمجة، مثل Noise.

## المواصفات

استخدم BLAKE2b-512 غير المشفر كما هو موضح في [BLAKE2] مع الملح والتخصيص. كل استخدامات توقيعات BLAKE2b ستستخدم سلسلة تخصيص بطول 16 حرفًا.

عند استخدامه في توقيع RedDSA_BLAKE2b_Ed25519، يُسمح بملح عشوائي لكنه ليس ضروريًا، حيث تضيف خوارزمية التوقيع 80 بايت من البيانات العشوائية (انظر الاقتراح 123). إذا رغبت، عند تجزئة البيانات لحساب r، قم بتعيين ملح عشوائي جديد BLAKE2b ذات 16 بايت لكل توقيع. عند حساب S، أعد تعيين الملح إلى القيمة الافتراضية لصفر.

عند استخدامه في التحقق من RedDSA_BLAKE2b_Ed25519، لا تستخدم ملحًا عشوائيًا، استخدم القيمة الافتراضية لصفر.

ملامح الملح والتخصيص لم يتم تحديدها في [RFC-7693]؛ استخدم هذه المميزات كما هو موضح في [BLAKE2].

### نوع التوقيع

بالنسبة لـ RedDSA_BLAKE2b_Ed25519، استبدل دالة التجزئة SHA-512 في RedDSA_SHA512_Ed25519 (نوع التوقيع 11، كما هو محدد في الاقتراح 123) بـ BLAKE2b-512. لا تغييرات أخرى.

لا نحتاج بديلاً لـ EdDSA_SHA512_Ed25519ph (نوع التوقيع 8) لملفات su3، لأن الإصدار المسبق التجزئة من EdDSA ليس عرضة لـ LEA. EdDSA_SHA512_Ed25519 (نوع التوقيع 7) ليس مدعومًا لملفات su3.

=======================  ===========  ======  =====
        النوع             كود النوع    منذ   الاستخدام
=======================  ===========  ======  =====
RedDSA_BLAKE2b_Ed25519       12        TBD    للهوية في الموجهات، والوجهات ومستوعبات الإيجار المشفرة فقط؛ لم تستخدم أبدًا للهويات في الموجهات
=======================  ===========  ======  =====

### أطوال بيانات الهيكل الشائع

ينطبق ما يلي على نوع التوقيع الجديد.

==================================  =============
            نوع البيانات             الطول    
==================================  =============
تجزئة                                     64      
مفتاح خاص                              32      
مفتاح عام                               32      
توقيع                                    64      
==================================  =============

### التخصيصات

لتوفير فصل النطاق لاستخدامات التواقيع المختلفة،
سنستخدم ميزة التخصيص في BLAKE2b.

جميع استخدامات توقيعات BLAKE2b ستستخدم سلسلة تخصيص من 16 حرفًا.
أي استخدامات جديدة يجب إضافتها إلى الجدول هنا، مع تخصيص فريد.

### الهيكل المشترك لأطوال البيانات
==================================  ==========================
         الاستخدام                    تخصيص 16 بايت
==================================  ==========================
ضبط الجلسة I2CP                   "I2CP_SessionConf"
إدخالات شبكة البيانات (RI، LS، LS2)    "network_database"
المصافحة NTCP 1                   "NTCP_1_handshake"
البتات الموقعة                     "sign_datagramI2P"
التدفق                             "streaming_i2psig"
المصافحة SSU                      "SSUHandshakeSign"
ملفات SU3                         غير مدعومة
الاختبارات الواحدة                    "test1234test5678"
==================================  ==========================

## الملاحظات

## القضايا

- بديل 1: الاقتراح 146؛ يوفر مقاومة LEA
- بديل 2: Ed25519ctx في RFC 8032؛ يوفر مقاومة LEA والتخصيص. معيارية، لكن هل يستخدمها أحد؟
  انظر [RFC-8032] و[ED25519CTX].
- هل التجزئة "المشفرة" مفيدة لنا؟

## الترحيل

نفس عملية الطرح لأنواع التوقيع السابقة.

نخطط لتغيير الموجهات الجديدة من النوع 7 إلى النوع 12 كافتراضي. نخطط لترحيل الموجهات الحالية من النوع 7 إلى النوع 12، باستخدام عملية "إعادة تعيين المفتاح" المستخدمة بعد تقديم النوع 7. نخطط لتغيير الوجهات الجديدة من النوع 7 إلى النوع 12 كافتراضي. نخطط لتغيير الوجهات المشفرة الجديدة من النوع 11 إلى النوع 13 كافتراضي.

سنقوم بدعم التعتيم من الأنواع 7، 11، و12 إلى النوع 12. لن ندعم التعتيم من النوع 12 إلى النوع 11.

يمكن للموجهات الجديدة أن تبدأ باستخدام النوع الجديد من التوقيع كافتراضي بعد بضعة أشهر. يمكن للوجهات الجديدة أن تبدأ باستخدام النوع الجديد كافتراضي بعد ربما عام.

بالنسبة لنسخة الموجه الأقل 0.9.TBD، يجب على الموجهات التأكد من:

- عدم تخزين (أو نشر) RI أو LS مع النوع الجديد للموجهات الأقل من النسخة 0.9.TBD.
- عند التحقق من تخزين الشبكة، لا تقم بجلب RI أو LS بالنوع الجديد من الموجهات الأقل من النسخة 0.9.TBD.
- لا يمكن للموجهات بالنوع الجديد في RI الاتصال بالموجهات الأقل من النسخة 0.9.TBD، إما باستخدام NTCP، NTCP2، أو SSU.
- لن تعمل الاتصالات البثية والبتات الموقعة للموجهات الأقل من النسخة 0.9.TBD، لكن لا توجد طريقة لمعرفة ذلك، لذا يجب ألا يتم استخدام النوع الجديد كافتراضي لفترة من الوقت بعد إصدار 0.9.TBD تكون بمدة أشهر أو سنوات.

## المراجع

.. [BLAKE2]
   https://blake2.net/blake2.pdf

.. [ED25519CTX]
   https://moderncrypto.org/mail-archive/curves/2017/000925.html

.. [ED25519-REFS]
    "التواقيع الأمنية عالية السرعة" لدانيال
    جي. بيرنشتاين، نيلز ديف، تانجا لانج، بيتر شابي، و
    بو-يين يانغ. http://cr.yp.to/papers.html#ed25519

.. [EDDSA-FAULTS]
   https://news.ycombinator.com/item?id=15414760

.. [LEA]
   https://en.wikipedia.org/wiki/Length_extension_attack

.. [RFC-7693]
   https://tools.ietf.org/html/rfc7693

.. [RFC-8032]
   https://tools.ietf.org/html/rfc8032

.. [ZCASH]
   https://github.com/zcash/zips/tree/master/protocol/protocol.pdf
