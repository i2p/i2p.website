---
title: "Podpisové schéma Red25519"
description: "Rerandomizovatelné podpisové schéma pro vytváření zaslepených destinací"
slug: "red25519"
lastUpdated: "2025-10"
accurateFor: "2.10.0"
---

## Přehled

Tento dokument specifikuje re-randomizovatelné podpisové schéma vhodné pro vytváření Destinací, které lze zaslepit. Kromě toho jej lze použít k zaslepení existujících Destinací Ed25519, avšak s mírným snížením účinnosti.

Red25519 je v I2P routerech plně funkční od verze 0.9.39 (vydáno 21. března 2019). Tato specifikace byla po 17 měsících produkčního nasazení dokončena ve verzi 0.9.47 (srpen 2020). Schéma podpisu v síti I2P funguje jako typ podpisu 11 (RedDSA_SHA512_Ed25519).

## Motivace

Návrh 123 (New netDB Entries) definuje šifrovaný formát LeaseSet2, který ztělesňuje princip minimálních oprávnění: každý účastník sítě dostává pouze informace nezbytné pro svou roli. Konkrétně šifrovaný LeaseSet2 publikovaný do floodfillu neprozrazuje Destination (cílová identita), pro kterou je určen, a Leases (záznamy pronájmu tunelu) si může zobrazit pouze ten, kdo má předchozí znalost této Destination. Floodfilly však stále musí být schopny ověřit šifrované LeaseSet2 při jejich publikování a klienti navíc musí zajistit, že ověření bylo vynuceno samotnou Destination.

Toho dosahuje Návrh 123 zaslepením podpisových klíčů Destinací. Zaslepené klíče lze použít k vytváření podpisů, které mohou floodfills ověřit, a klienti si mohou být jisti, že tyto podpisy mohla vytvořit pouze daná Destinace. Je proto nutné specifikovat podpisové schéma, které lze použít pro zaslepení.

**Poznámka ke stavu návrhu 123**: Části návrhu 123 byly postupně implementovány a nasazovány od verze 0.9.38, přičemž podpora Red25519 byla přidána ve verzi 0.9.39. Šifrovaná funkcionalita LeaseSet2 (datová struktura I2P popisující dosažitelnost služby) je připravena pro produkční nasazení a je v síti I2P aktivně využívána pro skryté služby se zvýšeným soukromím.

## Návrh

### Základní podpisové schéma

Podpisové schéma specifikované zde, Red25519, je instancí RedDSA, jak je definováno v oddíle 5.4.6 dokumentu Zcash Protocol Specification (Sapling and later). RedDSA je podpisové schéma založené na Schnorrově konstrukci, které podporuje key re-randomization (re-randomizaci klíče). Má následující funkce:

**GENERATE_PRIVATE()** : Vrací rovnoměrně náhodný soukromý klíč.

**DERIVE_PUBLIC(sk)** : Vrátí veřejný klíč odpovídající danému soukromému klíči.

**GENERATE_RANDOM()** : Vrací náhodný skalár vhodný pro re-randomizing (opětovné náhodnění) klíčového páru.

**RANDOMIZE_PRIVATE(sk, alpha)** : Znovu náhodně upraví soukromý klíč pomocí tajné skalární hodnoty alpha.

**RANDOMIZE_PUBLIC(vk, alpha)** : Re-randomizuje veřejný klíč s použitím tajné skalární hodnoty alpha.

**SIGN(sk, m)** : Vrátí podpis vytvořený soukromým klíčem sk nad zadanou zprávou m.

**VERIFY(vk, m, sig)** : Ověří podpis sig vůči veřejnému klíči vk a zprávě m. Vrátí true, pokud je podpis platný, jinak false.

Pro danou dvojici klíčů (sk, vk) platí následující vztah:

```
RANDOMIZE_PUBLIC(vk, alpha) == DERIVE_PUBLIC(RANDOMIZE_PRIVATE(sk, alpha))
```
### Převod klíčů Ed25519 na Red25519

Klíče Ed25519 MOHOU být dočasně jednosměrně převedeny na klíče Red25519, za účelem podpory opětovné randomizace existujících Ed25519 Destinations (adresy v I2P). Jiné typy podpisů nejsou kompatibilní.

Definujeme následující převodní funkce:

**CONVERT_ED25519_PRIVATE(privkey)** : Vrací soukromý klíč Red25519 odpovídající zadanému soukromému klíči Ed25519.

**CONVERT_ED25519_PUBLIC(pubkey)** : Vrátí veřejný klíč Red25519 odpovídající danému veřejnému klíči Ed25519.

Pro daný klíčový pár Ed25519 (privkey, pubkey) platí následující vztah:

```
CONVERT_ED25519_PUBLIC(pubkey) == DERIVE_PUBLIC(CONVERT_ED25519_PRIVATE(privkey))
```
## Specifikace

### Definice

**B** : Základní bod Ed25519 podle [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).

**L** : Řád Ed25519 2^252 + 27742317777372353535851937790883648493 podle [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).

**[s] B** : Skalární násobení s pevnou bází základního bodu skalárem s.

**[s] A** : Skalární násobení s proměnlivou bází A skalárem s.

**x || y** : Zřetězí dvě bajtová pole x a y.

### Red25519 (označení pro variantu založenou na křivce Ed25519)

Schéma Red25519 specializuje RedDSA pomocí:

- G := skupina bodů na Edwardsově formě křivky Curve25519. Konkrétně to znamená, že Red25519 používá podskupinu o prvočíselném řádu L a koefaktor h_G je 8.
- P_G := základní bod Ed25519 B.
- l_H := 512
- H(x) := SHA-512("I2P_Red25519H(x)" || x)

**Poznámka k volbě hašovací funkce**: Red25519 používá SHA-512 namísto BLAKE2b-512 (jak je tomu v Zcash RedDSA). Toto konstrukční rozhodnutí je vyváženo ochranou length-prefixing (prefixování délkou) popsanou níže. I2P Proposal 148 navrhuje do budoucna přechod na BLAKE2b-512 pro posílení ochrany proti Duplicate Message Identification (DMI, identifikace duplicitních zpráv) a Length Extension Attacks (LEA, útoky rozšířením délky), a také pro zlepšení výkonu.

RedDSA předpokládá, že H(x) je realizována kryptografickou hashovací funkcí, která je odolná vůči útokům prodloužením délky. SHA-512 tento požadavek sama o sobě nesplňuje. Abychom to napravili, požadujeme, aby před každou zprávou byla uvedena její délka v prefixově jednoznačném kódování:

```
len_u16(M) || M
```
kde `len_u16(M)` je dvoubajtová reprezentace délky M v little-endian (uspořádání bajtů od nejméně významného k nejvíce významnému), aby byla v souladu s little-endian kódováním skalárů a bodů.

Zprávy nesmí být delší než 65534 bajtů. Délka 65535 je vyhrazena pro možné budoucí rozšíření.

**Bezpečnostní poznámka**: Zahrnutí veřejného klíče (vk) do hashovací funkce, v kombinaci s 80 náhodnými bajty při podepisování, zajišťuje ochranu proti zranitelnostem typu SURK-CMA (Strong Unforgeability with Re-randomized Keys under Chosen Message Attack – silná nefalšovatelnost s přerandomizovanými klíči při útoku s volbou zprávy) objeveným v raných návrzích RedDSA. Tato implementace zahrnuje bezpečnostní opravy z auditu NCC Group pro Zcash (Finding NCC-Zcash2018-009).

### Kódování a dekódování

Soukromé klíče Red25519 jsou skalární hodnoty modulo L, kódované v reprezentaci little-endian. Definujeme funkce `DECODE_SCALAR` a `ENCODE_SCALAR` pro převod mezi polem bajtů a celočíselnou formou skalární hodnoty.

Veřejné klíče Red25519 jsou body na Edwardsově formě křivky Curve25519. Kódují se jako 255bitová little-endian reprezentace souřadnice y, následovaná jediným bitem udávajícím znaménko souřadnice x. Jde o stejné kódování jako u Ed25519. Definujeme funkce `DECODE_POINT` a `ENCODE_POINT` pro převod mezi bajtovým polem a souřadnicovým vyjádřením bodu.

### Funkce RedDSA (digitální podpisové schéma)

Pro usnadnění implementace níže výslovně uvádíme funkce RedDSA (digitální podpisové schéma), stejně jako několik pomocných funkcí, již specializované pro Red25519. Implementátoři by měli pro obecnou specifikaci funkcí RedDSA nahlédnout do oddílu 5.4.6 dokumentu Zcash Protocol Specification.

```
HStar(prefix1, prefix2, m) :=
    h = SHA-512()
    h.input("I2P_Red25519H(x)")
    h.input(prefix1)
    h.input(prefix2)

    h.input(len(m) & 0xff)
    h.input((len(m) >> 8) & 0xff)
    h.input(m)

    s = h.digest()
    return s mod L

GENERATE_PRIVATE :=
    s = 64 random bytes
    return s mod L

DERIVE_PUBLIC(sk) := [sk] B

GENERATE_RANDOM :=
    s = 64 random bytes
    return s mod L

RANDOMIZE_PRIVATE(sk, alpha) := (sk + alpha) mod L

RANDOMIZE_PUBLIC(vk, alpha) := vk + [alpha] B

SIGN(sk, m) :=
    T = 80 random bytes
    vkBytes = ENCODE_POINT(DERIVE_PUBLIC(sk))
    r = HStar(T, vkBytes, m)

    R = [r] B
    Rbytes = ENCODE_POINT(R)

    c = HStar(Rbytes, vkBytes, m)
    S = (r + (c * sk)) mod L

    return Rbytes || ENCODE_SCALAR(S)

VERIFY(vk, m, sig) :=
    Rbytes = sig[0..32]
    Sbytes = sig[32..64]

    R = DECODE_POINT(Rbytes)
    if R is invalid:
        return false

    S = DECODE_SCALAR(Sbytes)
    if S >= L:
        return false

    vkBytes = ENCODE_POINT(vk)
    c = HStar(Rbytes, vkBytes, m)
    return ((-[S] B) + R + ([c] vk)).multiplyByCofactor().isIdentity()
```
### Konverzní funkce

```
CONVERT_ED25519_PRIVATE(privkey) :=
    s = SHA-512(privkey)[0..32]
    s[0] = s[0] & 248
    s[31] = (s[31] & 63) | 64
    return s

CONVERT_ED25519_PUBLIC(pubkey) := pubkey
```
Všimněte si, že implementace `CONVERT_ED25519_PRIVATE` je ekvivalentní výpočtu tajné skalární hodnoty s, který se provádí při odvozování veřejného klíče Ed25519 z privátního klíče Ed25519, jak je specifikováno v krocích 1-3 v oddílu 5.1.5 [RFC 8032](https://www.rfc-editor.org/rfc/rfc8032.html).

## Bezpečnostní dopady

Rerandomizace Red25519 Destination (identifikátor cíle v I2P) a následné vytváření podpisů pomocí ní neprozrazuje žádné informace o Destination, protože pravděpodobnostní rozdělení soukromých klíčů Red25519 generovaných pomocí `RANDOMIZE_PRIVATE` je totožné s rozdělením soukromých klíčů generovaných pomocí `GENERATE_PRIVATE` a `DERIVE_PUBLIC` je deterministická.

Převod soukromých klíčů Ed25519 (schéma digitálního podpisu na eliptické křivce) na Red25519 (odvozený formát klíčů) pomocí `CONVERT_ED25519_PRIVATE` nevede ke stejnému rozdělení. Snížení bezpečnosti však považujeme z následujících důvodů za přijatelné:

- Prostor skalárů Ed25519 je přibližně poloviční oproti prostoru skalárů Red25519 (existuje 2^251 možných skalárů Ed25519 a L ~= 2^252 možných skalárů Red25519). Ztráta bezpečnosti je tedy nanejvýš přibližně dvojnásobná, tj. zhruba o 1 bit (protože jsme mohli náhodou zvolit skalár Red25519, který je zároveň platným skalárem Ed25519).
- Existující destinace Ed25519 byly v minulosti na síti již vystaveny a mělo by se předpokládat, že je škodlivé floodfills již zmapovaly.

**Důležité**: Uživatelé, kteří se obávají tohoto oslabení bezpečnosti, by měli jako sigtype pro své Destinations (identifikátory služeb v I2P) používat Red25519 (signature type 11) místo Ed25519 (signature type 7).

Všimněte si, že výše uvedený argument se nevztahuje na rerandomizační skalár alpha; při každé volbě zkreslené alpha unikají informace o klíči, protože aditivní rerandomizace se chová jako jednorázová šifra.

### Stav bezpečnostního auditu

**Důležité sdělení**: I2P, včetně Red25519, nikdy neprošlo formálním bezpečnostním auditem provedeným třetí stranou. Základní návrh RedDSA prošel bezpečnostní revizí společností NCC Group jako součást auditu protokolu Zcash Sapling v roce 2018, při níž byly identifikovány a opraveny bezpečnostní problémy. Konkrétní implementace I2P se SHA-512 (namísto BLAKE2b-512) a doménovou separací I2P však nebyla nezávisle analyzována.

Referenční implementace ed25519-java od str4d prošla jedním nezávislým auditem třetí strany, ale ten předcházel implementaci Red25519 a pokrýval pouze funkcionalitu Ed25519, nikoli rozšíření Red25519.

Uživatelé, kteří nasazují Red25519, by měli rozumět tomuto omezení a vyhodnotit bezpečnostní kompromisy podle svého modelu hrozeb.

## Kompatibilita

Verze I2P, které podporují Red25519 (verze 0.9.39 a novější), budou schopny ověřit síťové datové struktury, které jsou jím podepsané. Verze I2P, které Red25519 nepodporují, budou takový podpis považovat za neznámý a SMÍ tyto datové struktury zahodit.

**Časová osa nasazení**: - **0.9.39** (březen 2019): První implementace s podporou Encrypted LS2 ve floodfills - **0.9.40** (květen 2019): Autorizace na úrovni klienta pro Encrypted LS2 - **0.9.41** (srpen 2019): Meta LS2 a Encrypted LS2 s offline klíči - **0.9.43** (únor 2020): Podpora b32 pro Encrypted LS2 - **0.9.47** (srpen 2020): Finalizace specifikace - **2.10.0** (říjen 2025): Aktuální verze sítě (ekvivalent k 0.9.67+)

Uživatelé by měli očekávat, že spolehlivost datových struktur podepsaných pomocí Red25519 (typ digitálního podpisu) bude pro případy použití Encrypted LeaseSet2 dobrá, protože síť měla od počáteční implementace více než šest let na aktualizaci. Metriky adopce pro obecné používání destinací však nejsou veřejně dostupné.

**Hlavní případ použití**: Red25519 se primárně používá pro funkci Encrypted LeaseSet2, kde je vyžadováno zaslepení klíče. Pro standardní destinace bez požadavků na šifrovaný leaseset zůstává Ed25519 (typ podpisu 7) doporučenou volbou díky širší kompatibilitě a delší prokázané historii.

## Poznámky k implementaci

Implementace Red25519 je v I2P Java routeru v `net.i2p.crypto.eddsa.RedDSAEngine` a používá knihovnu ed25519-java od str4d (Jack Grigg) jako Maven závislost `net.i2p.crypto:eddsa` (ve verzích 0.1.0 až 0.3.0).

Implementace i2pd v C++ také podporuje Red25519 (signaturetype=11) pro publikování šifrovaného LeaseSetu.

Příklad konfigurace pro i2pd:

```
signaturetype=11
i2cp.leaseSetType=5
```
**Kompatibilita Encrypted LeaseSet2**: Specifikace Encrypted LeaseSet vyžaduje, aby podpisový veřejný klíč v unblinded destination (nezaslepený cíl) byl typu Ed25519 (typ podpisu 7) nebo Red25519 (typ podpisu 11). Žádné jiné typy podpisů nejsou podporovány pro funkcionalitu encrypted leaseset.

## Testovací vektory

Následující testovací vektory jsou k dispozici pro ověření implementace. Každý vektor obsahuje:

- `edsk`: soukromý klíč Ed25519 (náhodný)
- `edpk`: veřejný klíč Ed25519 odpovídající edsk
- `sk`: CONVERT_ED25519_PRIVATE(edsk)
- `vk`: CONVERT_ED25519_PUBLIC(edpk)
- `msg`: zpráva k podepsání
- `sig`: SIGN(sk, msg)
- `alpha`: GENERATE_RANDOM()
- `rsk`: RANDOMIZE_PRIVATE(sk, alpha)
- `rvk`: RANDOMIZE_PUBLIC(vk, alpha)
- `rsig`: SIGN(rsk, msg)

**Poznámka k implementaci**: Tyto testovací vektory by měly být integrovány do automatizovaných sad jednotkových testů pro průběžné ověřování. Implementátoři by měli ověřit, že všechny konverze, podpisy a operace re-randomization (opětovné náhodnění) odpovídají těmto očekávaným hodnotám.

### Testovací vektor 1

```
edsk:  0101010101010101010101010101010101010101010101010101010101010101
edpk:  8a88e3dd7409f195fd52db2d3cba5d72ca6709bf1d94121bf3748801b40f6f5c
sk:    58e86efb75fa4e2c410f46e16de9f6acae1a1703528651b69bc176c088bef36e
vk:    8a88e3dd7409f195fd52db2d3cba5d72ca6709bf1d94121bf3748801b40f6f5c
msg:   0202020202020202020202020202020202020202020202020202020202020202
sig:   61f5527f4d3b46de4b2c234390370bf715ae9098907a0d191ba1b44b23a8ac1a
       6a40437a5294e9503faaf9bd2b7f2fe7ba44dec487b3185aba7ff7d7a17cd40f
alpha: ae9ba9cbbc047c442448fca7c9f4e288a202ed520bfad0c784b792b7773cee08
rsk:   8bb85f3c7a494a08890d7d142109c1a3501d04565d80227e2079097800fbe107
rvk:   6fe128737b8e76fa66698a748b0dc0a89168dd8a0601c2b1c0b26835d323e9b3
rsig:  533053074d3b44f08723aab988ede9880a001b7a684d4a98f2d1b88fabee07a5
       b5c9430c69a690321e0cb8365d7aeb6688bcbad2c0780e0c69e8a1b4a45f3001
```
### Testovací vektor 2

```
edsk:  0202020202020202020202020202020202020202020202020202020202020202
edpk:  8139770ea87d175f56a35466c34c7ecccb8d8a91b4ee37a25df60f5b8fc9b394
sk:    a83c626bc9c38c8c201878ebb1d5b0b50ac40e8986c78793db1d4ef369fca14e
vk:    8139770ea87d175f56a35466c34c7ecccb8d8a91b4ee37a25df60f5b8fc9b394
msg:   0303030303030303030303030303030303030303030303030303030303030303
sig:   0829e58eb5399870f009bd1f0270264e556424bda7a93fbcec99f6d9d75db46d
       5c3cb546d9947ca7c1200876c8775a90c357a2aef3d2f16388242ee1914b1a0a
alpha: 98b615d9027e996cc2796c019d9c8beb46aa7d2b6eea2e5d98eb29eb1584c203
rsk:   9fcfaa734852ca40b3810ebef590e138516e8cb4f4b1b6f0730978de7f806402
rvk:   527e121090158419609e4a0d8de6f7d3271b353a8cd0b8172fe41468ea1e9177
rsig:  9a6961f35ed264a946cd6214b2326a6e6caa426c2a61bc14367fd278e0b5fb51
       3ac065a69210a457f17d12ba8a496cfd835002691affa8efcdecae48135c090f
```
**Poznámka**: Další testovací vektory 3-10 mají stejný formát a lze je nalézt v referenční implementaci.

## Reference

- [Návrh 123: Nové záznamy netDB](/proposals/123-new-netdb-entries/) - Částečně implementováno a nasazeno ve verzích 0.9.38, 0.9.39 a novějších
- [Specifikace protokolu Zcash, oddíl 5.4.6: RedDSA, RedJubjub a RedPallas](https://zips.z.cash/protocol/protocol.pdf) - RedDSA je definován jako součást specifikace protokolu Zcash; bezpečnostní audit provedla společnost NCC Group (leden 2019)
- [RFC 8032: Algoritmus digitálního podpisu na Edwardsově křivce (EdDSA)](https://www.rfc-editor.org/rfc/rfc8032.html)
- [Návrh 148: RedDSA-BLAKE2b-Ed25519](/proposals/148-eddsa-blake2b-ed25519/) - Navrženo, ale dosud neimplementováno; navrhuje budoucí migraci na BLAKE2b-512
- [Specifikace šifrovaného LeaseSet](/docs/specs/encryptedleaseset/)
- [Specifikace kryptografie na nízké úrovni](/docs/specs/cryptography/)
