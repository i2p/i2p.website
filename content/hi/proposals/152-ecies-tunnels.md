```markdown
---
title: "ECIES सुरंगें"
number: "152"
author: "chisana, zzz, orignal"
created: "2019-07-04"
lastupdated: "2025-03-05"
status: "Closed"
thread: "http://zzz.i2p/topics/2737"
target: "0.9.48"
implementedin: "0.9.48"
---

## नोट
नेटवर्क परिनियोजन और परीक्षण जारी है।
छोटे संशोधनों के अधीन है।
आधिकारिक विनिर्देश के लिए [SPEC](/en/docs/spec/) देखें।


## अवलोकन

यह दस्तावेज़ [ECIES-X25519](/en/docs/spec/ecies/) द्वारा पेश किए गए क्रिप्टो प्रिमिटिव का उपयोग करके सुरंग निर्माण संदेश एन्क्रिप्शन में बदलाव का प्रस्ताव करता है।
यह ElGamal से ECIES-X25519 कुंजी में राउटर को बदलने के लिए समग्र प्रस्ताव [Prop156](/en/proposals/156-ecies-routers/) का एक हिस्सा है।

ElGamal + AES256 से ECIES + ChaCha20 में नेटवर्क को बदलने के उद्देश्य से,
मिश्रित ElGamal और ECIES राउटर वाली सुरंगों की आवश्यकता है।
मिश्रित सुरंग हॉप्स के प्रबंधन के लिए विनिर्देश प्रदान किए गए हैं।
ElGamal हॉप्स के प्रारूप, प्रसंस्करण, या एन्क्रिप्शन में कोई बदलाव नहीं किया जाएगा।

ElGamal सुरंग निर्माता को प्रत्येक हॉप के लिए अस्थायी X25519 कीपेयर बनानी होगी, और
ECIES हॉप्स को शामिल करने वाली सुरंग को बनाने के लिए इस विनिर्देश का पालन करना होगा।

यह प्रस्ताव ECIES-X25519 सुरंग निर्माण के लिए आवश्यक बदलावों को निर्दिष्ट करता है।
ECIES राउटर के लिए आवश्यक सभी परिवर्तनों का अवलोकन करने के लिए, प्रस्ताव 156 [Prop156](/en/proposals/156-ecies-routers/) देखें।

यह प्रस्ताव संगतता के लिए सुरंग निर्माण रिकॉर्ड का समान आकार बनाए रखता है।
छोटे निर्माण रिकॉर्ड और संदेश बाद में लागू किए जाएंगे - [Prop157](/en/proposals/157-new-tbm/) देखें।


### क्रिप्टोग्राफिक प्रिमिटिव्स

कोई नया क्रिप्टोग्राफिक प्रिमिटिवस पेश नहीं किया गया है। इस प्रस्ताव को लागू करने के लिए आवश्यक प्रिमिटिव्स हैं:

- [Cryptography](/en/docs/spec/cryptography/) में जैसा AES-256-CBC
- STREAM ChaCha20/Poly1305 फंक्शंस:
  ENCRYPT(k, n, plaintext, ad) और DECRYPT(k, n, ciphertext, ad) - [NTCP2](/en/docs/spec/ntcp2/) [ECIES-X25519](/en/docs/spec/ecies/) और [RFC-7539](https://tools.ietf.org/html/rfc7539) में जैसा
- X25519 DH फंक्शंस - [NTCP2](/en/docs/spec/ntcp2/) और [ECIES-X25519](/en/docs/spec/ecies/) में जैसा
- HKDF(salt, ikm, info, n) - [NTCP2](/en/docs/spec/ntcp2/) और [ECIES-X25519](/en/docs/spec/ecies/) में जैसा

अन्य Noise फंक्शंस जो अन्यत्र परिभाषित हैं:

- MixHash(d) - [NTCP2](/en/docs/spec/ntcp2/) और [ECIES-X25519](/en/docs/spec/ecies/) में जैसा
- MixKey(d) - [NTCP2](/en/docs/spec/ntcp2/) और [ECIES-X25519](/en/docs/spec/ecies/) में जैसा


### लक्ष्य

- क्रिप्टो ऑपरेशन्स की गति बढ़ाएं
- ElGamal + AES256/CBC को सुरंग बनाना अनुरोध रिकॉर्ड्स और उत्तर रिकॉर्ड्स के लिए ECIES प्रिमिटिव्स से बदलें।
- एनक्रिप्टेड निर्माण अनुरोध रिकॉर्ड्स और उत्तर रिकॉर्ड्स के आकार (528 बाइट्स) में कोई बदलाव नहीं, संगतता के लिए
- कोई नया I2NP संदेश नहीं
- संगतता के लिए एनक्रिप्टेड निर्माण रिकॉर्ड आकार बनाए रखें
- सुरंग निर्माण संदेशों के लिए अग्रेषण गोपनीयता जोड़ें।
- प्रमाणीकृत एनक्रिप्शन जोड़ें
- हॉप्स के पुन: क्रमबद्ध निर्माण अनुरोध रिकॉर्ड्स का पता लगाएं
- समय स्टैम्प के रिजॉल्यूशन को बढ़ाएं ताकि ब्लूम फिल्टर का आकार घटाया जा सके
- सुरंग समाप्ति के लिए फ़ील्ड जोड़ें ताकि विभिन्न सुरंग जीवनकाल संभव हो (सभी-ECIES सुरंगें ही)
- भविष्य की विशेषताओं के लिए भविष्य उन्मुख विकल्प फ़ील्ड जोड़ें
- मौजूदा क्रिप्टोग्राफिक प्रिमिटिव्स का पुन: उपयोग करें
- संगतता बनाए रखते हुए जहाँ संभव हो सुरंग निर्माण संदेश सुरक्षा में सुधार करें
- मिश्रित ElGamal/ECIES साथियों के साथ सुरंगों का समर्थन करें
- निर्माण संदेशों पर "टैगिंग" हमलों के खिलाफ बचाव में सुधार करें
- हॉप्स को अगले हॉप के प्रसंस्करण से पहले एन्क्रिप्शन प्रकार जानने की जरूरत नहीं, क्योंकि वे उस समय अगले हॉप का RI न रख सकते हैं
- वर्तमान नेटवर्क के साथ अधिकतम संगतता
- ElGamal राउटर के लिए सुरंग निर्माण AES अनुरोध/उत्तर एन्क्रिप्शन में कोई बदलाव नहीं
- सुरंग AES "परत" एन्क्रिप्शन में कोई बदलाव नहीं, इसके लिए [Prop153](/en/proposals/153-chacha20-layer-encryption/) देखें
- दोनों 8-रिकॉर्ड TBM/TBRM और परिवर्तनीय आकार VTBM/VTBRM का समर्थन जारी रखें
- पूरे नेटवर्क के लिए "फ्लैग दिवस" उन्नयन की आवश्यकता नहीं है


### गैर-लक्ष्य

- सुरंग निर्माण संदेशों का पूर्ण पुनर्रचना जो "फ्लैग दिवस" की आवश्यकता है।
- सुरंग निर्माण संदेशों को छोटा करना (सभी-ECIES हॉप्स की आवश्यकता होती है और एक नए प्रस्ताव की आवश्यकता होती है)
- [Prop143](/en/proposals/143-build-message-options/) में परिभाषित सुरंग निर्माण विकल्प का उपयोग, केवल छोटे संदेशों के लिए आवश्यक
- द्विदिश सुरंग - इसके लिए [Prop119](/en/proposals/119-bidirectional-tunnels/) देखें
- छोटे सुरंग निर्माण संदेश - इसके लिए [Prop157](/en/proposals/157-new-tbm/) देखें


## खतरा मॉडल

### डिज़ाइन लक्ष्य

- कोई हॉप्स सुरंग के जनक को निर्धारित करने में सक्षम नहीं हैं।

- मध्य हॉप्स सुरंग की दिशा या सुरंग में उनकी स्थिति निर्धारित करने में सक्षम नहीं होना चाहिए।

- कोई हॉप्स अन्य अनुरोध या उत्तर रिकॉर्ड के किसी सामग्री को नहीं पढ़ सकता है,
  अगले हॉप के लिए काटा हुआ राउटर हैश और अस्थायी कुंजी को छोड़कर

- आउटबाउंड निर्माण के लिए उत्तर सुरंग का कोई सदस्य किसी भी उत्तर रिकॉर्ड को नहीं पढ़ सकता।

- इनबाउंड निर्माण के लिए आउटबाउंड सुरंग का कोई सदस्य किसी भी अनुरोध रिकॉर्ड को नहीं पढ़ सकता, सिवाय इसके कि OBEP अगला हॉप के लिए काटा हुआ राउटर हैश और अस्थायी कुंजी देख सकता है




### टैगिंग आक्रमण

सुरंग निर्माण डिज़ाइन का प्रमुख लक्ष्य यह कठिन बनाना है कि
छलवाली राउटर X और Y ये जान सकें कि वे एक ही सुरंग में हैं।
यदि राउटर X हॉप m पर है और राउटर Y हॉप m+1 पर है, तो वे स्पष्ट रूप से जानेंगे।
लेकिन यदि राउटर X हॉप m पर है और राउटर Y हॉप m+n पर है जहाँ n>1, तो यह बहुत कठिन होना चाहिए।

टैगिंग हमले वह हैं जहाँ मध्य-हॉप राउटर X सुरंग निर्माण संदेश को इस तरीके से बदल देता है कि
राउटर Y संदेश को प्राप्त करते समय परिवर्तन का पता लगा सके।
लक्ष्य यह है कि X और Y के बीच के राउटर द्वारा कोई परिवर्तन किया गया संदेश राउटर Y तक पहुँचने से पहले गिरा दिया जाए।
उन संशोधनों के लिए जो राउटर Y तक पहुँचने से पहले नहीं गिराए गए हैं, सुरंग निर्माता को प्रतिक्रिया में भ्रष्टाचार का पता लगाना चाहिए
और सुरंग को त्याग देना चाहिए।

संभावित हमले:

- एक निर्माण रिकॉर्ड को बदलना
- एक निर्माण रिकॉर्ड को बदलना
- एक निर्माण रिकॉर्ड को जोड़ना या हटाना
- निर्माण रिकॉर्ड्स को पुन: क्रमबद्ध करना





TODO: क्या वर्तमान डिज़ाइन इन सभी हमलों को रोकता है?






## डिज़ाइन

### शोर प्रोटोकॉल फ्रेमवर्क

यह प्रस्ताव शोर प्रोटोकॉल फ्रेमवर्क [NOISE](https://noiseprotocol.org/noise.html) (संशोधन 34, 2018-07-11) के आधार पर आवश्यकताओं को प्रदान करता है।
शोर के मुहावरे में, एलिस प्रारंभकर्ता होती है, और बॉब प्रत्युत्तरकर्ता।

यह प्रस्ताव शोर प्रोटोकॉल Noise_N_25519_ChaChaPoly_SHA256 पर आधारित है।
यह शोर प्रोटोकॉल निम्न प्रिमिटिव्स का उपयोग करता है:

- एकतरफा हैंडशेक पैटर्न: N
  एलिस अपनी स्थिर कुंजी बॉब को नहीं भेजती (N)

- DH फंक्शन: X25519
  X25519 DH 32 बाइट्स की कुंजी लंबाई के साथ जैसा [RFC-7748](https://tools.ietf.org/html/rfc7748) में निर्दिष्ट है।

- साइफर फंक्शन: ChaChaPoly
  AEAD_CHACHA20_POLY1305 जैसा [RFC-7539](https://tools.ietf.org/html/rfc7539) के खंड 2.8 में निर्दिष्ट है।
  12 बाइट्स का नॉनस, जिसमें पहले 4 बाइट्स को शून्य पर सेट किया गया है।
  [NTCP2](/en/docs/spec/ntcp2/) में जैसा।

- हैश फंक्शन: SHA256
  मानक 32-बाइट हैश, जो I2P में व्यापक रूप से प्रयोग में है।


फ्रेमवर्क में जोड़
````````````````````````````````````

कोई नहीं।


### हैंडशेक पैटर्न

हैंडशेक [Noise](https://noiseprotocol.org/noise.html) हैंडशेक पैटर्न का उपयोग करते हैं।

निम्नलिखित वर्णमाला मानचित्र का उपयोग किया गया है:

- e = एक-समय अस्थायी कुंजी
- s = स्थैतिक कुंजी
- p = संदेश पेलोड

निर्माण अनुरोध शोर N पैटर्न के समान है।
यह [NTCP2](/en/docs/spec/ntcp2/) में उपयोग किए गए XK पैटर्न के पहले (सत्र अनुरोध) संदेश के बराबर भी है।


.. कच्चा:: html

  ```dataspec

<- s
  ...
  e es p ->




  ```


### अनुरोध एन्क्रिप्शन

निर्माण अनुरोध रिकॉर्ड्स सुरंग निर्माता द्वारा बनाए जाते हैं और व्यक्तिगत हॉप के लिए विषम रूप से एन्क्रिप्ट किए जाते हैं।
अनुरोध रिकॉर्ड्स का यह विषम एन्क्रिप्शन वर्तमान में [क्रिप्टोग्राफी](/en/docs/spec/cryptography/) में परिभाषित ElGamal है
और इसमें SHA-256 चेकसम शामिल है। यह डिज़ाइन अग्रेषण गोपनीय नहीं है।

नई डिज़ाइन एकतरफा शोर पैटर्न "N" का उपयोग करेगी जिसमें ECIES-X25519 अस्थायी-स्थैतिक DH, के साथ एक HKDF, और
आगे की गोपनीयता, अखंडता और प्रमाणीकरण के लिए ChaCha20/Poly1305 AEAD।
एलिस सुरंग निर्माण अनुरोधकर्ता है। सुरंग में प्रत्येक हॉप एक बॉब है।


(पेलोड सुरक्षा गुणधर्म)

.. कच्चा:: html

  ```text

N:                      प्रमाणीकरण   गोपनीयता
    -> e, es                  0                2

    प्रमाणीकरण: कोई नहीं (0)।
    यह पेलोड किसी भी पार्टी द्वारा भेजा गया हो सकता है, जिसमें एक सक्रिय हमलावर भी शामिल है।

    गोपनीयता: 2।
    ज्ञात प्राप्तकर्ता को एन्क्रिप्शन, केवल प्रेषक के समझौते के लिए अग्रेषण गोपनीयता,
    रिप्ले के लिए असुरक्षित। यह पेलोड केवल प्राप्तकर्ता की स्थिर कुंजी जोड़ी के साथ
    संबंधित DH पर आधारित एन्क्रिप्शन है। यदि प्राप्तकर्ता की स्थिर निजी कुंजी समझौता की गई, 
    यहां तक कि बाद की तारीख में, इस पेलोड को डिक्रिप्ट किया जा सकता है। यह संदेश 
    दोहराया भी जा सकता है, क्योंकि इसमें प्राप्तकर्ता का कोई अस्थायी योगदान नहीं है।

    "e": एलिस एक नई अस्थायी कुंजी जोड़ी बनाती है और इसे e चर में संग्रहीत करती है,
         संदेश बफर में अस्थायी सार्वजनिक कुंजी को स्पष्ट रूप में लिखती है, और नए h को 
         प्राप्त करने के लिए पुराने h के साथ सार्वजनिक कुंजी को हैश करती है।

    "es": एलिस की अस्थायी कुंजी जोड़ी और बॉब की स्थैतिक कुंजी जोड़ी के बीच एक DH 
          प्रदर्शन किया जाता है। परिणाम को नए ck और k को प्राप्त करने के लिए पुराने ck के 
          साथ हैश किया जाता है, और n को शून्य पर सेट किया जाता है।





  ```



### उत्तर एन्क्रिप्शन

निर्माण उत्तर रिकॉर्ड्स हॉप के निर्माता द्वारा बनाए जाते हैं और निर्माता के लिए सममिति रूप से 
एन्क्रिप्ट किए जाते हैं।
उत्तर रिकॉर्ड्स का यह सममिति एन्क्रिप्शन वर्तमान में AES के साथ एक प्रिपेंड SHA-256 चेकसम के साथ है।
और इसमें एक SHA-256 चेकसम शामिल है। यह डिज़ाइन अग्रेषण गोपनीय नहीं है।

नई डिज़ाइन अखंडता और प्रमाणीकरण के लिए ChaCha20/Poly1305 AEAD का उपयोग करेगी।


### औचित्य

अनुरोध में अस्थायी सार्वजनिक कुंजी को AES
या एलिगेटर 2 से अस्पष्ट करने की आवश्यकता नहीं होती। पिछला हॉप ही केवल इसे देख सकता है, 
और वह हॉप जानता है कि अगला हॉप ECIES है।

उत्तर रिकॉर्ड्स को पूर्ण विषम एन्क्रिप्शन की आवश्यकता नहीं होती है।



## विनिर्देश



### निर्माण अनुरोध रिकॉर्ड्स

एन्क्रिप्टेड निर्माण अनुरोध रिकॉर्ड्स संगतता के लिए दोनों ElGamal और ECIES के लिए 528 बाइट्स हैं।


अनुरोध रिकॉर्ड असंप्रेषित (ElGamal)
`````````````````````````````````````````

संदर्भ के लिए, यह [I2NP](/en/docs/spec/i2np/) से लिए गए ElGamal राउटरों के लिए सुरंग निर्माण अनुरोध रिकॉर्ड का वर्तमान विनिर्देश है।
असंप्रेषित डेटा को एक गैर-शून्य बाइट और डेटा के SHA-256 हैश के साथ प्रिपेंड किया जाता है 
एन्क्रिप्शन से पहले, जैसा कि [क्रिप्टोग्राफी](/en/docs/spec/cryptography/) में परिभाषित है।

सभी फ़ील्ड्स बिग-एंडियन हैं।

असंप्रेषित आकार: 222 बाइट्स

.. कच्चा:: html

  ```dataspec


bytes     0-3: सुरंग आईडी प्राप्त करने के लिए संदेश के रूप में, गैर-शून्य
  bytes    4-35: स्थानीय राउटर पहचान हैश
  bytes   36-39: अगली सुरंग आईडी, गैर-शून्य
  bytes   40-71: अगली राउटर पहचान हैश
  bytes  72-103: AES-256 सुरंग परत कुंजी
  bytes 104-135: AES-256 सुरंग IV कुंजी
  bytes 136-167: AES-256 उत्तर कुंजी
  bytes 168-183: AES-256 उत्तर IV
  byte      184: ध्वज
  bytes 185-188: अनुरोध समय (युग के बाद घंटे, नीचे गोल)
  bytes 189-192: अगला संदेश आईडी
  bytes 193-221: अप्रयुक्त / यादृच्छिक पैडिंग




  ```


अनुरोध रिकॉर्ड एन्क्रिप्टेड (ElGamal)
```````````````````````````````````````

संदर्भ के लिए, यह [I2NP](/en/docs/spec/i2np/) से लिए गए ElGamal राउटरों के लिए सुरंग निर्माण अनुरोध रिकॉर्ड का वर्तमान विनिर्देश है।

एन्क्रिप्टेड आकार: 528 बाइट्स

.. कच्चा:: html

  ```dataspec


bytes    0-15: हॉप की छोटी हुई पहचान हैश
  bytes  16-528: ElGamal एन्क्रिप्टेड निर्माण अनुरोध रिकॉर्ड




  ```




अनुरोध रिकॉर्ड असंप्रेषित (ECIES)
`````````````````````````````````````````

यह ECIES-X25519 राउटरों के लिए सुरंग निर्माण अनुरोध रिकॉर्ड का प्रस्तावित विनिर्देश है।
परिवर्तनों का सारांश:

- अप्रयुक्त 32-बाइट राउटर हैश को हटाएं
- अनुरोध समय को घंटों से मिनटों में बदलें
- भविष्य के परिवर्तनीय सुरंग समय के लिए समाप्ति क्षेत्र जोड़ें
- ध्वज के लिए अधिक स्थान जोड़ें
- भविष्य के निर्माण विकल्पों के लिए मैपिंग जोड़ें
- उत्तर रिकॉर्ड के लिए AES-256 उत्तर कुंजी और IV का उपयोग नहीं किया जाता है
- असंप्रेषित रिकॉर्ड लंबा होता है क्योंकि इसमें कम एन्क्रिप्शन ओवरहेड होता है


अनुरोध रिकॉर्ड में कोई ChaCha उत्तर कुंजी शामिल नहीं होती है।
उन कुंजियों को KDF से प्राप्त किया जाता है। नीचे देखें।

सभी फ़ील्ड्स बिग-एंडियन हैं।

असंप्रेषित आकार: 464 बाइट्स

.. कच्चा:: html

  ```dataspec


bytes     0-3: सुरंग आईडी प्राप्त करने के लिए संदेशों के रूप में, गैर-शून्य
  bytes     4-7: अगली सुरंग आईडी, गैर-शून्य
  bytes    8-39: अगली राउटर पहचान हैश
  bytes   40-71: AES-256 सुरंग परत कुंजी
  bytes  72-103: AES-256 सुरंग IV कुंजी
  bytes 104-135: AES-256 उत्तर कुंजी
  bytes 136-151: AES-256 उत्तर IV
  byte      152: ध्वज
  bytes 153-155: अधिक ध्वज, अप्रयुक्त, संगतता के लिए 0 पर सेट करें
  bytes 156-159: अनुरोध समय (युग के बाद मिनट, नीचे गोल)
  bytes 160-163: अनुरोध समाप्ति (निर्माण के बाद सेकंड में)
  bytes 164-167: अगला संदेश आईडी
  bytes   168-x: सुरंग निर्माण विकल्प (मैपिंग)
  bytes     x-x: ध्वज या विकल्पों द्वारा संकेतित अन्य डेटा
  bytes   x-463: यादृच्छिक पैडिंग




  ```

ध्वज फ़ील्ड [Tunnel-Creation](/en/docs/spec/tunnel-creation/) में परिभाषित के रूप में वही है और इसमें निम्नलिखित शामिल हैं::

 बिट क्रम: 76543210 (बिट 7 MSB है)
 bit 7: यदि सेट है, तो किसी से भी संदेश स्वीकार करें
 bit 6: यदि सेट है, तो किसी को भी संदेश भेजने की अनुमति है, और 
        उत्तर को सुरंग निर्माण उत्तर संदेश में निर्दिष्ट अगली हॉप पर भेजें
 bits 5-0: अपरिभाषित, भविष्य के विकल्पों के साथ संगतता के लिए 0 पर सेट करना आवश्यक है

Bit 7 इंगित करता है कि हॉप एक इनबाउंड गेटवे (IBGW) होगा।  Bit 6
इंगित करता है कि हॉप एक आउटबाउंड एंडपॉइंट (OBEP) होगा।  यदि कोई भी बिट 
सेट नहीं किया गया, तो हॉप एक मध्यवर्ती प्रतिभागी होगा।  दोनों को एक साथ सेट नहीं किया जा सकता।

अनुरोध समाप्ति भविष्य के परिवर्तनीय सुरंग अवधि के लिए है।
अभी के लिए, केवल समर्थित मान 600 (10 मिनट) है।

सुरंग निर्माण विकल्प [Common](/en/docs/spec/common-structures/) में परिभाषित के रूप में एक मैपिंग संरचना है।
यह भविष्य के उपयोग के लिए है। वर्तमान में कोई विकल्प परिभाषित नहीं हैं।
यदि मैपिंग संरचना खाली है, तो यह दो बाइट्स 0x00 0x00 है।
मैपिंग की अधिकतम लंबाई (लंबाई फ़ील्ड सहित) 296 बाइट्स है,
और मैपिंग लंबाई फ़ील्ड का अधिकतम मान 294 है।



अनुरोध रिकॉर्ड एन्क्रिप्टेड (ECIES)
`````````````````````````````````````

सभी फ़ील्ड्स बिग-एंडियन हैं सिवाय अस्थायी सार्वजनिक कुंजी के, जो लिटिल-एंडियन है।

एन्क्रिप्टेड आकार: 528 बाइट्स

.. कच्चा:: html

  ```dataspec


bytes    0-15: हॉप की छोटी हुई पहचान हैश
  bytes   16-47: प्रेषक की अस्थायी X25519 सार्वजनिक कुंजी
  bytes  48-511: ChaCha20 एन्क्रिप्टेड निर्माण अनुरोध रिकॉर्ड
  bytes 512-527: Poly1305 MAC




  ```



### निर्माण उत्तर रिकॉर्ड्स

एन्क्रिप्टेड निर्माण उत्तर रिकॉर्ड संगतता के लिए दोनों ElGamal और ECIES के लिए 528 बाइट्स हैं।


उत्तर रिकॉर्ड असंप्रेषित (ElGamal)
`````````````````````````````````````
ElGamal उत्तर AES के साथ एन्क्रिप्ट किए जाते हैं।

सभी फ़ील्ड्स बिग-एंडियन हैं।

असंप्रेषित आकार: 528 बाइट्स

.. कच्चा:: html

  ```dataspec


bytes   0-31: बाइट्स 32-527 का SHA-256 हैश
  bytes 32-526: यादृच्छिक डेटा
  byte     527: उत्तर

  कुल लंबाई: 528




  ```


उत्तर रिकॉर्ड असंप्रेषित (ECIES)
`````````````````````````````````````
यह ECIES-X25519 राउटरों के लिए सुरंग निर्माण उत्तर रिकॉर्ड का प्रस्तावित विनिर्देश है।
परिवर्तनों का सारांश:

- निर्माण उत्तर विकल्पों के लिए मैपिंग जोड़ें
- असंप्रेषित रिकॉर्ड लंबा होता है क्योंकि इसमें कम एन्क्रिप्शन ओवरहेड होता है

ECIES उत्तर ChaCha20/Poly1305 से एन्क्रिप्ट किए जाते हैं।

सभी फ़ील्ड्स बिग-एंडियन हैं।

असंप्रेषित आकार: 512 बाइट्स

.. कच्चा:: html

  ```dataspec


bytes    0-x: सुरंग निर्माण उत्तर विकल्प (मैपिंग)
  bytes    x-x: विकल्पों द्वारा संकेतित अन्य डेटा
  bytes  x-510: यादृच्छिक पैडिंग
  byte     511: उत्तर बाइट




  ```

सुरंग निर्माण उत्तर विकल्प [Common](/en/docs/spec/common-structures/) में परिभाषित के जैसे एक मैपिंग संरचना है।
यह भविष्य के उपयोग के लिए है। वर्तमान में कोई विकल्प परिभाषित नहीं हैं।
यदि मैपिंग संरचना खाली है, तो यह दो बाइट्स 0x00 0x00 है।
मैपिंग की अधिकतम लंबाई (लंबाई फ़ील्ड सहित) 511 बाइट्स है,
और मैपिंग लंबाई फ़ील्ड का अधिकतम मान 509 है।

उत्तर बाइट निम्नलिखित मूल्यों में से एक है
[Tunnel-Creation](/en/docs/spec/tunnel-creation/) में वर्णित है ताकि फिंगरप्रिंटिंग से बचा जा सके:

- 0x00 (स्वीकार करें)
- 30 (TUNNEL_REJECT_BANDWIDTH)


उत्तर रिकॉर्ड एन्क्रिप्टेड (ECIES)
`````````````````````````````````````

एन्क्रिप्टेड आकार: 528 बाइट्स

.. कच्चा:: html

  ```dataspec


bytes   0-511: ChaCha20 एनक्रिप्टेड निर्माण उत्तर रिकॉर्ड
  bytes 512-527: Poly1305 MAC




  ```

सभी-ECIES रिकॉर्ड्स में पूर्ण संक्रमण के बाद, अनुरोध रिकॉर्ड्स के लिए समान रेंज पैडिंग नियम होंगे।


### रिकॉर्ड्स के सममिति एन्क्रिप्शन

मिश्रित सुरंगों की अनुमति है, और ElGamal से ECIES में परिवर्तन के लिए आवश्यक है।
संक्रमणकालीन अवधि के दौरान, ECIES कुंजी के तहत एक बढ़ती हुई संख्या में राउटर होंगे।

सममिति कूटलेखन पूर्वप्रसंस्करण उसी तरह चलेगा:

- "एन्क्रिप्शन":

  - साइफर डीक्रिप्शन मोड में चलाया जाता है
  - अनुरोध रिकॉर्ड्स पहले से ही प्रसंस्करण में डिक्रिप्ट किए जाते हैं (एन्क्रिप्टेड अनुरोध रिकॉर्ड्स को छुपाना)

- "डीक्रिप्शन":

  - साइफर एन्क्रिप्शन मोड में चलाया जाता है
  - प्रतिभागी हॉप्स द्वारा अनुरोध रिकॉर्ड्स को एन्क्रिप्ट किया जाता है (अगला पठ्य अनुरोध रिकॉर्ड प्रकट करना)

- ChaCha20 का कोई "मोड" नहीं होता, इसलिए इसे तीन बार चलाया जाता है:

  - पूर्वप्रसंस्करण में एक बार
  - हॉप द्वारा एक बार
  - अंतिम उत्तर प्रसंस्करण पर एक बार

जब मिश्रित सुरंगों का उपयोग किया जाता है, सुरंग निर्माता को 
BuildRequestRecord के सममिति एन्क्रिप्शन को वर्तमान और पिछले हॉप के एन्क्रिप्शन प्रकार पर आधारित करने की आवश्यकता होगी।

प्रत्येक हॉप उत्तर रिकॉर्ड्स को एन्क्रिप्ट करने के लिए अपना एन्क्रिप्शन प्रकार का उपयोग करेगा, और 
वेरिएबल तत्व निर्माण संदेश (VTBM) में अन्य रिकॉर्ड्स को।

उत्तर पथ पर, अंतिम बिंदु (प्रेषक) को [Multiple-Encryption](https://en.wikipedia.org/wiki/Multiple_encryption) को पूर्ववर्ती करना होगा, प्रत्येक हॉप के उत्तर कुंजी का उपयोग करके।

एक स्पष्ट उदाहरण के रूप में, चलिए एक आउटबाउंड सुरंग को देखते हैं जिसमें ECIES ElGamal से घिरा हुआ है:

- प्रेषक (OBGW) -> ElGamal (H1) -> ECIES (H2) -> ElGamal (H3)

सभी निर्माण अनुरोध रिकॉर्ड्स उनकी एन्क्रिप्टेड स्थिति में होते हैं (ElGamal या ECIES का उपयोग करके)।

AES256/CBC साइफर, जब भी उपयोग किया जाता है, प्रत्येक रिकॉर्ड के लिए उपयोग किया जाता है, 
बिना कई रिकॉर्ड्स में चेनिंग के।

इसी प्रकार, ChaCha20 प्रत्येक रिकॉर्ड को एन्क्रिप्ट करने के लिए उपयोग किया जाता है, 
पूरे VTBM में स्ट्रीमिंग नहीं।

अनुरोध रिकॉर्ड्स को प्रेषक (OBGW) द्वारा पूर्वप्रसंस्करण किया जाता है:

- H3 का रिकॉर्ड "एन्क्रिप्टेड" होता है:

  - H2 की उत्तर कुंजी (ChaCha20)
  - H1 की उत्तर कुंजी (AES256/CBC)

- H2 का रिकॉर्ड "एन्क्रिप्टेड" होता है:

  - H1 की उत्तर कुंजी (AES256/CBC)

- H1 का रिकॉर्ड बिना सममिति एन्क्रिप्शन के बाहर जाता है

केवल H2 उत्तर एन्क्रिप्शन ध्वज की जांच करता है, और देखता है कि वह AES256/CBC द्वारा अनुसरण किया गया है।

प्रत्येक हॉप द्वारा संसाधित होने के बाद, रिकॉर्ड्स "डिक्रिप्टेड" स्थिति में होते हैं:

- H3 का रिकॉर्ड "डिक्रिप्टेड" होता है:

  - H3 की उत्तर कुंजी (AES256/CBC)

- H2 का रिकॉर्ड "डिक्रिप्टेड" होता है:

  - H3 की उत्तर कुंजी (AES256/CBC)
  - H2 की उत्तर कुंजी (ChaCha20-Poly1305)

- H1 का रिकॉर्ड "डिक्रिप्टेड" होता है:

  - H3 की उत्तर कुंजी (AES256/CBC)
  - H2 की उत्तर कुंजी (ChaCha20)
  - H1 की उत्तर कुंजी (AES256/CBC)

सुरंग निर्माता, इनबाउंड एंडपॉइंट (IBEP), उत्तर को पोस्टप्रोसेस करता है:

- H3 का रिकॉर्ड "एन्क्रिप्टेड" होता है:

  - H3 की उत्तर कुंजी (AES256/CBC)

- H2 का रिकॉर्ड "एन्क्रिप्टेड" होता है:

  - H3 की उत्तर कुंजी (AES256/CBC)
  - H2 की उत्तर कुंजी (ChaCha20-Poly1305)

- H1 का रिकॉर्ड "एन्क्रिप्टेड" होता है:

  - H3 की उत्तर कुंजी (AES256/CBC)
  - H2 की उत्तर कुंजी (ChaCha20)
  - H1 की उत्तर कुंजी (AES256/CBC)


### अनुरोध रिकॉर्ड कुंजियां (ECIES)

ये कुंजियां ElGamal निर्माण अनुरोध रिकॉर्ड्स में स्पष्ट रूप से शामिल हैं।
ECIES निर्माण अनुरोध रिकॉर्ड्स के लिए, सुरंग कुंजियां और AES उत्तर कुंजियां शामिल होती हैं,
लेकिन ChaCha उत्तर कुंजियां DH विनिमय से प्राप्त की जाती हैं।
राउटर स्थिर ECIES कुंजियों के विवरण के लिए [Prop156](/en/proposals/156-ecies-routers/) देखें।

नीचे यह बताया गया है कि कैसे उन कुंजियों को प्राप्त करें जो पहले अनुरोध रिकॉर्ड्स में प्रेषित की गई होती थीं।


प्रारंभिक ck और h के लिए KDF
````````````````````````````

यह "N" पैटर्न के साथ मानक [NOISE](https://noiseprotocol.org/noise.html) है जिसमें मानक प्रोटोकॉल नाम है।

.. कच्चा:: html

  ```text

यह "e" संदेश पैटर्न है:

  // प्रोटोकॉल नाम संदर्भित करें।
  प्रोटोकॉल नाम को सेट करें = "Noise_N_25519_ChaChaPoly_SHA256"
  (31 बाइट्स, US-ASCII एन्कोडेड, बिना NULL टर्मिनेशन के)।

  // हाश h = 32 बाइट्स परिभाषित करें
  // 32 बाइट्स तक पैड करें। इसे हैश न करें, क्योंकि यह 32 बाइट्स से ज्यादा नहीं है
  h = प्रोटोकॉल नाम || 0

  परिभाषित ck = 32 बाइट्स की चेनिंग कुंजी। h डेटा को ck में कॉपी करें।
  चेनकी को सेट करें = h

  // MixHash(null प्रोलॉग)
  h = SHA256(h);

  // यहां तक की यह सब सभी राउटर्स द्वारा पूर्वगणना की जा सकती है।




  ```


अनुरोध रिकॉर्ड के लिए KDF
````````````````````````````

ElGamal सुरंग निर्माता प्रत्येक
ECIES हॉप के लिए सुरंग में एक अस्थायी X25519 कीपेयर उत्पन्न करते हैं, और अपने निर्माण अनुरोध रिकॉर्ड को एन्क्रिप्ट करने के लिए ऊपर
दिए गए तरीके का उपयोग करते हैं।
ElGamal सुरंग निर्माता ElGamal हॉप्स को एन्क्रिप्ट करने के लिए इस विनिर्देशन से पहले परिभाषित योजना का उपयोग करेंगे।

ECIES सुरंग निर्माता ElGamal हॉप के सार्वजनिक कुंजी का उपयोग करके
[Tunnel-Creation](/en/docs/spec/tunnel-creation/) में परिभाषित योजना का उपयोग करेंगे।
ECIES सुरंग निर्माता
ECIES हॉप्स को एन्क्रिप्ट करने के लिए ऊपर दी गई योजना का उपयोग करेंगे।

इसका मतलब यह है कि सुरंग हॉप्स केवल अपनी समान एन्क्रिप्शन प्रकार की एन्क्रिप्टेड रिकॉर्ड्स देखेंगे।

ElGamal और ECIES सुरंग निर्माताओं के लिए, वे
ECIES हॉप्स को एन्क्रिप्ट करने के लिए प्रति-हॉप अद्वितीय अस्थायी X25519 कीपेयर उत्पन्न करेंगे।

**महत्वपूर्ण**:
अस्थायी कुंजियां प्रत्येक ECIES हॉप के लिए अद्वितीय होनी चाहिए, और प्रत्येक निर्माण रिकॉर्ड के लिए।
अद्वितीय कुंजी का उपयोग न करने से संशयास्पद हॉप्स के लिए एक आक्रमण वेक्टर खुल जाता है जिससे वे पुष्टि कर सकें कि वे एक ही सुरंग में हैं।


.. कच्चा:: html

  ```dataspec


// प्रत्येक हॉप की X25519 स्थिर कीपियर (hesk, hepk) Router Identity से
  hesk = GENERATE_PRIVATE()
  hepk = DERIVE_PUBLIC(hesk)

  // MixHash(hepk)
  // || का मतलब है जोड़ना
  h = SHA256(h || hepk);

  // यहां तक की यह सब प्रत्येक राउटर द्वारा
  // सभी आने वाले निर्माण अनुरोधों के लिए पूर्वगणना की जा सकती है।

  // प्रेषक प्रत्येक ECIES हॉप में एक अस्थायी X25519 कीपियर उत्पन्न करता है VTBM (sesk, sepk)
  sesk = GENERATE_PRIVATE()
  sepk = DERIVE_PUBLIC(sesk)

  // MixHash(sepk)
  h = SHA256(h || sepk);

  "e" संदेश पैटर्न का अंत।

  यह "es" संदेश पैटर्न है:

  // Noise es
  // प्रेषक हॉप की स्थिर सार्वजनिक कुंजी के साथ एक X25519 DH प्रदर्शन करता है।
  // प्रत्येक हॉप, उनके काटे हुए पहचान हैश के साथ रिकॉर्ड पाता है,
  // और एन्क्रिप्टेड रिकॉर्ड के पहले प्रेषक की अस्थायी कुंजी निकालता है।
  sharedSecret = DH(sesk, hepk) = DH(hesk, sepk)

  // MixKey(DH())
  //[chainKey, k] = MixKey(sharedSecret)
  // चाचा पॉली पैरामीटर एन्क्रिप्ट/डिक्रिप्ट करने के लिए
  keydata = HKDF(chainKey, sharedSecret, "", 64)
  // उत्तर रिकॉर्ड KDF के लिए सहेजें
  chainKey = keydata[0:31]

  // AEAD पैरामीटर
  k = keydata[32:63]
  n = 0
  plaintext = 464 बाइट्स की निर्माण अनुरोध रिकॉर्ड
  ad = h

  ciphertext = ENCRYPT(k, n, plaintext, ad)

  "es" संदेश पैटर्न का अंत।

  // MixHash(ciphertext)
  // उत्तर रिकॉर्ड KDF के लिए सहेजें
  h = SHA256(h || ciphertext)




  ```

``replyKey``, ``layerKey`` और ``layerIV`` को अभी भी ElGamal रिकॉर्ड्स के अंदर शामिल होना चाहिए,
और यादृच्छिक रूप से उत्पन्न किया जा सकत 


### अनुरोध रिकॉर्ड एन्क्रिप्शन (ElGamal)

जैसा [Tunnel-Creation](/en/docs/spec/tunnel-creation/) में परिभाषित है।
ElGamal हॉप्स के लिए एन्क्रिप्शन में कोई परिवर्तन नहीं है।




### उत्तर रिकॉर्ड एन्क्रिप्शन (ECIES)

उत्तर रिकॉर्ड ChaCha20/Poly1305 से एन्क्रिप्ट किया जाता है।

.. कच्चा:: html

  ```dataspec


// AEAD पैरामीटर
  k = निर्माण अनुरोध से चेनकी
  n = 0
  plaintext = 512 बाइट्स की निर्माण उत्तर रिकॉर्ड
  ad = निर्माण अनुरोध से h

  ciphertext = ENCRYPT(k, n, plaintext, ad)




  ```



### उत्तर रिकॉर्ड एन्क्रिप्शन (ElGamal)

जैसा [Tunnel-Creation](/en/docs/spec/tunnel-creation/) में परिभाषित है।
ElGamal हॉप्स के लिए एन्क्रिप्शन में कोई परिवर्तन नहीं है।



### सुरक्षा विश्लेषण

ElGamal सुरंग निर्माण संदेशों के लिए अग्रेषण गोपनीयता प्रदान नहीं करता।

AES256/CBC में थोड़ा बेहतर सुरक्षा है, केवल एक सैद्धांतिक कमजोरता के लिए
ज्ञात पाठ्य `बिक्लिक` हमले से असंवेदनशील।

AES256/CBC के खिलाफ एकमात्र ज्ञात व्यावहारिक हमला एक पैडिंग ओरेकल हमला है, जब
IV हमलावर के लिए ज्ञात होता है।

हमलावर को अगली हॉप के ElGamal एन्क्रिप्शन को तोड़ने की आवश्यकता होगी ताकि AES256/CBC कुंजी जानकारी प्राप्त की जा सके (उत्तर कुंजी और IV)।

ElGamal ECIES की तुलना में काफी अधिक CPU-गहन है, जो संभावित संसाधन थकावट की ओर ले जाता है।

ECIES, प्रति-BuildRequestRecord या वेरिएबल तत्व निर्माण संदेश के साथ नए अस्थायी कुंजी के साथ उपयोग की जाती है, अग्रेषण गोपनीयता प्रदान करती है।

ChaCha20Poly1305 AEAD एन्क्रिप्शन प्रदान करता है, जिससे प्राप्तकर्ता संदेश अखंडता को सत्यापित कर सकता है इससे पहले कि वह पहुंच के प्रयास करें।


## औचित्य

यह डिज़ाइन मौजूदा क्रिप्टोग्राफिक प्रिमिटिव्स, प्रोटोकॉल्स और कोड के पुन: उपयोग को अधिकतम करता है।
यह डिज़ाइन खतरे को न्यूनतम करता है।


## कार्यान्वयन टिप्पणियाँ

* पुराने राउटर हॉप के एन्क्रिप्शन प्रकार की जांच नहीं करते हैं और ElGamal-एन्क्रिप्टेड
  रिकॉर्ड्स भेजेंगे। कुछ हाल के राउटर खराबी वाले होते हैं और विभिन्न प्रकार के
  खराबी वाले रिकॉर्ड्स भेजते हैं।
 कार्यान्वायकों को DH ऑपरेशन से पहले इन रिकॉर्ड्स का पता लगाना और उन्हें अस्वीकार करना चाहिए
  यदि संभव हो, तो सीपीयू उपयोग को कम करने के लिए।


## मुद्दे



## प्रवास

[Prop156](/en/proposals/156-ecies-routers/) देखें। 



