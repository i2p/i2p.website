<!DOCTYPE html>
<html lang="en" data-theme="light">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Garlic Farm Protocol | I2P - The Invisible Internet Project</title>

    <meta name="description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta name="keywords" content="i2p, privacy, anonymity, dark net, encryption, security">

    
    <meta property="og:title" content="Garlic Farm Protocol | I2P - The Invisible Internet Project">
    <meta property="og:description" content="The Invisible Internet Project - A privacy-focused, anonymous network layer">
    <meta property="og:type" content="website">
    <meta property="og:url" content="//localhost:1313/en/proposals/150-garlic-farm-protocol/">

    
    <link rel="icon" type="image/png" href="../../../images/i2plogo.png">

    
    
    
        
        <link rel="stylesheet" href="../../../css/main.min.css">
    

    
    <link rel="stylesheet" href="https://feedback.stormycloud.org/widgets/styles.css">

    
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>

    
    <script>(function(w,d,s,n,a){if(!w[n]){var l='call,catch,on,once,set,then,track,openCheckout'
    .split(','),i,o=function(n){return'function'==typeof n?o.l.push([arguments])&&o
    :function(){return o.l.push([n,arguments])&&o}},t=d.getElementsByTagName(s)[0],
    j=d.createElement(s);j.async=!0;j.src='https://cdn.fundraiseup.com/widget/'+a+'';
    t.parentNode.insertBefore(j,t);o.s=Date.now();o.v=5;o.h=w.location.href;o.l=[];
    for(i=0;i<8;i++)o[l[i]]=o(l[i]);w[n]=o}
    })(window,document,'script','FundraiseUp','AAYKECHT');</script>
    

    
</head>
<body>
    <header class="site-header">
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="../../../en/" class="logo-link">
                    <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="logo logo-light">
                    <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="logo logo-dark">
                </a>
            </div>

            
            <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
                <span class="hamburger"></span>
            </button>

            <div class="nav-menu">
                <ul class="nav-links">
                    <li class="nav-dropdown">
                        <a href="../../../en/about/" class="">About</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../en/about/">Overview</a></li>
                            <li><a href="../../../en/papers/">Research Papers</a></li>
                            <li><a href="../../../en/about/media/">Press</a></li>
                            <li><a href="../../../en/contact/">Contact Us</a></li>
                        </ul>
                    </li>
                    <li><a href="../../../en/docs/" class="">Docs</a></li>
                    <li><a href="../../../en/downloads/" class="">Downloads</a></li>
                    <li><a href="../../../en/blog/" class="">Blog</a></li>
                    <li class="nav-dropdown">
                        <a href="../../../en/get-involved/" class="">Get Involved</a>
                        <ul class="dropdown-menu">
                            <li><a href="../../../en/get-involved/">Overview</a></li>
                            <li><a href="../../../en/feedback/">Feature Suggestions</a></li>
                        </ul>
                    </li>
                </ul>

                <div class="nav-actions">
                    
                    <div class="language-selector">
                        <button class="language-toggle" aria-label="Select language" title="Language">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                <path d="M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            <span class="current-lang">en</span>
                        </button>
                        <div class="language-dropdown">
                            
                            
                            
                                
                                
                                
                                    
                                    <a href="../../../en/proposals/150-garlic-farm-protocol/" class="lang-option active">English</a>
                                
                            
                                
                                
                                
                                    <a href="../../../es/" class="lang-option">Espa√±ol</a>
                                
                            
                                
                                
                                
                                    <a href="../../../ko/" class="lang-option">ÌïúÍµ≠Ïñ¥</a>
                                
                            
                                
                                
                                
                                    <a href="../../../de/" class="lang-option">Deutsch</a>
                                
                            
                        </div>
                    </div>

                    
                    <button class="theme-toggle" aria-label="Toggle dark mode" title="Toggle theme">
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="2"/>
                            <path d="M10 2V4M10 16V18M18 10H16M4 10H2M15.657 4.343L14.243 5.757M5.757 14.243L4.343 15.657M15.657 15.657L14.243 14.243M5.757 5.757L4.343 4.343" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                        </svg>
                    </button>

                    
                    <a href="#XTLSAXYD" style="display: none"></a>

                    
                    <a href="../../../en/downloads/" class="btn btn-primary">Get I2P</a>
                </div>
            </div>
        </nav>
    </div>
</header>


    <main id="main-content">
        

<div class="proposals-page">
    <div class="container">
        
        <nav class="breadcrumbs">
            <a href="../../../en/">Home</a>
            <span class="separator">/</span>
            <a href="../../../en/proposals/">Proposals</a>
            <span class="separator">/</span>
            <span class="current">Garlic Farm Protocol</span>
        </nav>

        
        <header class="proposal-header">
            <div class="proposal-title-section">
                <h1 class="proposal-title">Garlic Farm Protocol</h1>
                <div class="proposal-number">Proposal 150</div>
            </div>

            
            <div class="proposal-meta-box">
                <div class="proposal-status status-open">
                    Open
                </div>

                
                <div class="proposal-info-grid">
                    
                    <div class="info-item">
                        <span class="info-label">Author</span>
                        <span class="info-value">zzz</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Created</span>
                        <span class="info-value">2019-05-02</span>
                    </div>
                    

                    
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value">2019-05-20</span>
                    </div>
                    

                    

                    
                </div>

                
                
            </div>
        </header>

        
        <article class="proposal-content">
            <h2 id="overview">Overview</h2>
<p>This is the spec for the Garlic Farm wire protocol,
based on JRaft, its &ldquo;exts&rdquo; code for implementation over TCP,
and its &ldquo;dmprinter&rdquo; sample application [JRAFT]<em>.
JRaft is an implementation of the Raft protocol [RAFT]</em>.</p>
<p>We were unable to find any implementation with a documented wire protocol.
However, the JRaft implementation is simple enough that we could
inspect the code and then document its protocol.
This proposal is the result of that effort.</p>
<p>This will be the backend for coordination of routers publishing
entries in a Meta LeaseSet. See proposal 123.</p>
<h2 id="goals">Goals</h2>
<ul>
<li>Small code size</li>
<li>Based on existing implementation</li>
<li>No serialized Java objects or any Java-specific features or encoding</li>
<li>Any bootstrapping is out-of-scope. At least one other server is assumed
to be hardcoded, or configured out-of-band of this protocol.</li>
<li>Support both out-of-band and in-I2P use cases.</li>
</ul>
<h2 id="design">Design</h2>
<p>The Raft protocol is not a concrete protocol; it defines only a state machine.
Therefore we document the concrete protocol of JRaft and base our protocol on it.
There are no changes to the JRaft protocol other than the addition of
an authentication handshake.</p>
<p>Raft elects a Leader whose job is to publish a log.
The log contains Raft Configuration data and Application data.
Application data contains the status of each Server&rsquo;s Router and the Destination
for the Meta LS2 cluster.
The servers use a common algorithm to determine the publisher and contents
of the Meta LS2.
The publisher of the Meta LS2 is NOT necessarily the Raft Leader.</p>
<h2 id="specification">Specification</h2>
<p>The wire protocol is over SSL sockets or non-SSL I2P sockets.
I2P sockets are proxied through the HTTP Proxy.
There is no support for clearnet non-SSL sockets.</p>
<h3 id="handshake-and-authentication">Handshake and authentication</h3>
<p>Not defined by JRaft.</p>
<p>Goals:</p>
<ul>
<li>User/password authentication method</li>
<li>Version identifier</li>
<li>Cluster identifier</li>
<li>Extensible</li>
<li>Ease of proxying when used for I2P sockets</li>
<li>Do not unnecessarily expose server as a Garlic Farm server</li>
<li>Simple protocol so a full web server implementation is not required</li>
<li>Compatible with common standards, so implementations may use
standard libraries if desired</li>
</ul>
<p>We will use an websocket-like handshake [WEBSOCKET]_ and
HTTP Digest authentication [RFC-2617]<em>.
RFC 2617 Basic authentication is NOT supported.
When proxying through the HTTP proxy, communicate with
the proxy as specified in [RFC-2616]</em>.</p>
<p>Credentials</p>
<pre tabindex="0"><code>
Whether usernames and passwords are per-cluster, or
per-server, is implementation-dependent.


HTTP Request 1
</code></pre><p>The originator will send the following.</p>
<p>All lines are teriminated with CRLF as required by HTTP.</p>
<p>.. raw:: html</p>
<p>{% highlight %}</p>
<p>GET /GarlicFarm/CLUSTER/VERSION/websocket HTTP/1.1
Host: (ip):(port)
Cache-Control: no-cache
Connection: close
(any other headers ignored)
(blank line)</p>
<p>CLUSTER is the name of the cluster (default &ldquo;farm&rdquo;)
VERSION is the Garlic Farm version (currently &ldquo;1&rdquo;)</p>
<p>{% endhighlight %}</p>
<p>HTTP Response 1</p>
<pre tabindex="0"><code>
If the path is not correct, the recipient will send a standard &#34;HTTP/1.1 404 Not Found&#34; response,
as in [RFC-2616]_.

If the path is correct, the recipient will send a standard &#34;HTTP/1.1 401 Unauthorized&#34; response,
including the WWW-Authenticate HTTP digest authentication header,
as in [RFC-2617]_.

Both parties will then close the socket.


HTTP Request 2
``````````````

The originator will send the following,
as in [RFC-2617]_ and [WEBSOCKET]_.

All lines are teriminated with CRLF as required by HTTP.

.. raw:: html

  {% highlight %}

GET /GarlicFarm/CLUSTER/VERSION/websocket HTTP/1.1
  Host: (ip):(port)
  Cache-Control: no-cache
  Connection: keep-alive, Upgrade
  Upgrade: websocket
  (Sec-Websocket-* headers if proxied)
  Authorization: (HTTP digest authorization header as in RFC 2617)
  (any other headers ignored)
  (blank line)

  CLUSTER is the name of the cluster (default &#34;farm&#34;)
  VERSION is the Garlic Farm version (currently &#34;1&#34;)

{% endhighlight %}


HTTP Response 2
</code></pre><p>If the authentication is not correct, the recipient will send another standard &ldquo;HTTP/1.1 401 Unauthorized&rdquo; response,
as in [RFC-2617]_.</p>
<p>If the authentication is correct, the recipient will send the following response,
as in [WEBSOCKET]_.</p>
<p>All lines are teriminated with CRLF as required by HTTP.</p>
<p>.. raw:: html</p>
<p>{% highlight %}</p>
<p>HTTP/1.1 101 Switching Protocols
Connection: Upgrade
Upgrade: websocket
(Sec-Websocket-* headers)
(any other headers ignored)
(blank line)</p>
<p>{% endhighlight %}</p>
<p>After this is received, the socket remains open.
The Raft protocol as defined below commences, on the same socket.</p>
<p>Caching</p>
<pre tabindex="0"><code>
Credentials shall be cached for at least one hour, so that
subsequent connections may jump directly to
&#34;HTTP Request 2&#34; above.



### Message Types

There are two types of messages, requests and responses.
Requests may contain Log Entries, and are variable-sized;
responses do not contain Log Entries, and are fixed-size.

Message types 1-4 are the standard RPC messages defined by Raft.
This is the core Raft protocol.

Message types 5-15 are the extended RPC messages defined by
JRaft, to support clients, dynamic server changes, and
efficient log synchronization.

Message types 16-17 are the Log Compaction RPC messages defined
in Raft section 7.


========================  ======  ===========  =================   =====================================
Message                   Number  Sent By      Sent To             Notes
========================  ======  ===========  =================   =====================================
RequestVoteRequest           1    Candidate    Follower            Standard Raft RPC; must not contain log entries
RequestVoteResponse          2    Follower     Candidate           Standard Raft RPC
AppendEntriesRequest         3    Leader       Follower            Standard Raft RPC
AppendEntriesResponse        4    Follower     Leader / Client     Standard Raft RPC
ClientRequest                5    Client       Leader / Follower   Response is AppendEntriesResponse; must contain Application log entries only
AddServerRequest             6    Client       Leader              Must contain a single ClusterServer log entry only
AddServerResponse            7    Leader       Client              Leader will also send a JoinClusterRequest
RemoveServerRequest          8    Follower     Leader              Must contain a single ClusterServer log entry only
RemoveServerResponse         9    Leader       Follower
SyncLogRequest              10    Leader       Follower            Must contain a single LogPack log entry only
SyncLogResponse             11    Follower     Leader
JoinClusterRequest          12    Leader       New Server          Invitation to join; must contain a single Configuration log entry only
JoinClusterResponse         13    New Server   Leader
LeaveClusterRequest         14    Leader       Follower            Command to leave
LeaveClusterResponse        15    Follower     Leader
InstallSnapshotRequest      16    Leader       Follower            Raft Section 7; Must contain a single SnapshotSyncRequest log entry only
InstallSnapshotResponse     17    Follower     Leader              Raft Section 7
========================  ======  ===========  =================   =====================================


### Establishment

After the HTTP handshake, the establishment sequence is as follows:

.. raw:: html

  {% highlight %}

New Server Alice              Random Follower Bob

  ClientRequest   -------&gt;
          &lt;---------   AppendEntriesResponse

  If Bob says he is the leader, continue as below.
  Else, Alice must disconnect from Bob and connect to the leader.


  New Server Alice              Leader Charlie

  ClientRequest   -------&gt;
          &lt;---------   AppendEntriesResponse
  AddServerRequest   -------&gt;
          &lt;---------   AddServerResponse
          &lt;---------   JoinClusterRequest
  JoinClusterResponse  -------&gt;
          &lt;---------   SyncLogRequest
                       OR InstallSnapshotRequest
  SyncLogResponse  -------&gt;
  OR InstallSnapshotResponse

{% endhighlight %}

Disconnect Sequence:

.. raw:: html

  {% highlight %}

Follower Alice              Leader Charlie

  RemoveServerRequest   -------&gt;
          &lt;---------   RemoveServerResponse
          &lt;---------   LeaveClusterRequest
  LeaveClusterResponse  -------&gt;

{% endhighlight %}

Election Sequence:

.. raw:: html

  {% highlight %}

Candidate Alice               Follower Bob

  RequestVoteRequest   -------&gt;
          &lt;---------   RequestVoteResponse

  if Alice wins election:

  Leader Alice                Follower Bob

  AppendEntriesRequest   -------&gt;
  (heartbeat)
          &lt;---------   AppendEntriesResponse

{% endhighlight %}


### Definitions

- Source: Identifies the originator of the message
- Destination: Identifies the recipient of the message
- Terms: See Raft. Initialized to 0, increases monotonically
- Indexes: See Raft. Initialized to 0, increases monotonically



### Requests

Requests contain a header and zero or more log entries.
Requests contain a fixed-size header and optional Log Entries of variable size.


Request Header
</code></pre><p>The request header is 45 bytes, as follows.
All values are unsigned big-endian.</p>
<p>.. raw:: html</p>
<p>{% highlight lang=&lsquo;dataspec&rsquo; %}</p>
<p>Message type:      1 byte
Source:            ID, 4 byte integer
Destination:       ID, 4 byte integer
Term:              Current term (see notes), 8 byte integer
Last Log Term:     8 byte integer
Last Log Index:    8 byte integer
Commit Index:      8 byte integer
Log entries size:  Total size in bytes, 4 byte integer
Log entries:       see below, total length as specified</p>
<p>{% endhighlight %}</p>
<h4 id="notes">Notes</h4>
<p>In the RequestVoteRequest, Term is the candidate&rsquo;s term.
Otherwise, it is the leader&rsquo;s current term.</p>
<p>In the AppendEntriesRequest, when the log entries size is zero,
this message is a heartbeat (keepalive) message.</p>
<p>Log Entries</p>
<pre tabindex="0"><code>
The log contains zero or more log entries.
Each log entry is as follows.
All values are unsigned big-endian.

.. raw:: html

  {% highlight lang=&#39;dataspec&#39; %}

Term:           8 byte integer
  Value type:     1 byte
  Entry size:     In bytes, 4 byte integer
  Entry:          length as specified

{% endhighlight %}


Log Contents
</code></pre><p>All values are unsigned big-endian.</p>
<p>========================  ======
Log Value Type            Number
========================  ======
Application                  1
Configuration                2
ClusterServer                3
LogPack                      4
SnapshotSyncRequest          5
========================  ======</p>
<h4 id="application">Application</h4>
<p>Application contents are UTF-8 encoded [JSON]_.
See the Application Layer section below.</p>
<h4 id="configuration">Configuration</h4>
<p>This is used for the leader to serialize a new cluster configuration and replicate to peers.
It contains zero or more ClusterServer configurations.</p>
<p>.. raw:: html</p>
<p>{% highlight lang=&lsquo;dataspec&rsquo; %}</p>
<p>Log Index:  8 byte integer
Last Log Index:  8 byte integer
ClusterServer Data for each server:
ID:                4 byte integer
Endpoint data len: In bytes, 4 byte integer
Endpoint data:     ASCII string of the form &ldquo;tcp://localhost:9001&rdquo;, length as specified</p>
<p>{% endhighlight %}</p>
<h4 id="clusterserver">ClusterServer</h4>
<p>The configuration information for a server in a cluster.
This is included only in a AddServerRequest or RemoveServerRequest message.</p>
<p>When used in a AddServerRequest Message:</p>
<p>.. raw:: html</p>
<p>{% highlight lang=&lsquo;dataspec&rsquo; %}</p>
<p>ID:                4 byte integer
Endpoint data len: In bytes, 4 byte integer
Endpoint data:     ASCII string of the form &ldquo;tcp://localhost:9001&rdquo;, length as specified</p>
<p>{% endhighlight %}</p>
<p>When used in a RemoveServerRequest Message:</p>
<p>.. raw:: html</p>
<p>{% highlight lang=&lsquo;dataspec&rsquo; %}</p>
<p>ID:                4 byte integer</p>
<p>{% endhighlight %}</p>
<h4 id="logpack">LogPack</h4>
<p>This is included only in a SyncLogRequest message.</p>
<p>The following is gzipped before transmission:</p>
<p>.. raw:: html</p>
<p>{% highlight lang=&lsquo;dataspec&rsquo; %}</p>
<p>Index data len: In bytes, 4 byte integer
Log data len:   In bytes, 4 byte integer
Index data:     8 bytes for each index, length as specified
Log data:       length as specified</p>
<p>{% endhighlight %}</p>
<h4 id="snapshotsyncrequest">SnapshotSyncRequest</h4>
<p>This is included only in a InstallSnapshotRequest message.</p>
<p>.. raw:: html</p>
<p>{% highlight lang=&lsquo;dataspec&rsquo; %}</p>
<p>Last Log Index:  8 byte integer
Last Log Term:   8 byte integer
Config data len: In bytes, 4 byte integer
Config data:     length as specified
Offset:          The offset of the data in the database, in bytes, 8 byte integer
Data len:        In bytes, 4 byte integer
Data:            length as specified
Is Done:         1 if done, 0 if not done (1 byte)</p>
<p>{% endhighlight %}</p>
<h3 id="responses">Responses</h3>
<p>All responses are 26 bytes, as follows.
All values are unsigned big-endian.</p>
<p>.. raw:: html</p>
<p>{% highlight lang=&lsquo;dataspec&rsquo; %}</p>
<p>Message type:   1 byte
Source:         ID, 4 byte integer
Destination:    Usually the actual destination ID (see notes), 4 byte integer
Term:           Current term, 8 byte integer
Next Index:     Initialized to leader last log index + 1, 8 byte integer
Is Accepted:    1 if accepted, 0 if not accepted (see notes), 1 byte</p>
<p>{% endhighlight %}</p>
<p>Notes</p>
<pre tabindex="0"><code>
The Destination ID is usually the actual destination for this message.
However, for AppendEntriesResponse, AddServerResponse, and RemoveServerResponse,
it is the ID of the current leader.

In the RequestVoteResponse, Is Accepted is 1 for a vote for the candidate (requestor),
and 0 for no vote.


## Application Layer

Each Server periodically posts Application data to the log in a ClientRequest.
Application data contains the status of each Server&#39;s Router and the Destination
for the Meta LS2 cluster.
The servers use a common algorithm to determine the publisher and contents
of the Meta LS2.
The server with the &#34;best&#34; recent status in the log is the Meta LS2 publisher.
The publisher of the Meta LS2 is NOT necessarily the Raft Leader.


### Application Data Contents

Application contents are UTF-8 encoded [JSON]_,
for simplicity and extensibility.
The full specification is TBD.
The goal is to provide enough data to write an algorithm to determine the &#34;best&#34;
router to publish the Meta LS2, and for the publisher to have sufficient information
to weight the Destinations in the Meta LS2.
The data will contain both router and Destination statistics.

The data may optionally contain remote sensing data on the health of the
other servers, and the ability to fetch the Meta LS.
These data would not be supported in the first release.

The data may optionally contain configuration information posted
by an administrator client.
These data would not be supported in the first release.

If &#34;name: value&#34; is listed, that specifies the JSON map key and value.
Otherwise, specification is TBD.


Cluster data (top level):

- cluster: Cluster name
- date: Date of this data (long, ms since the epoch)
- id: Raft ID (integer)

Configuration data (config):

- Any configuration parameters

MetaLS publishing status (meta):

- destination: the metals destination, base64
- lastPublishedLS: if present, base64 encoding of the last published metals
- lastPublishedTime: in ms, or 0 if never
- publishConfig: Publisher config status off/on/auto
- publishing: metals publisher status boolean true/false

Router data (router):

- lastPublishedRI: if present, base64 encoding of the last published router info
- uptime: Uptime in ms
- Job lag
- Exploratory tunnels
- Participating tunnels
- Configured bandwidth
- Current bandwidth

Destinations (destinations):
List

Destination data:

- destination: the destination, base64
- uptime: Uptime in ms
- Configured tunnels
- Current tunnels
- Configured bandwidth
- Current bandwidth
- Configured connections
- Current connections
- Blacklist data

Remote router sensing data:

- Last RI version seen
- LS Fetch time
- Connection test data
- Closest floodfills profile data
  for time periods yesterday, today, and tomorrow

Remote destination sensing data:

- Last LS version seen
- LS Fetch time
- Connection test data
- Closest floodfills profile data
  for time periods yesterday, today, and tomorrow

Meta LS sensing data:

- Last version seen
- Fetch time
- Closest floodfills profile data
  for time periods yesterday, today, and tomorrow


## Administration Interface

TBD, possibly a separate proposal.
Not required for the first release.

Requirements of an admin interface:

- Support for multiple master destinations, i.e. multiple virtual clusters (farms)
- Provide comprehensive view of shared cluster state - all stats published by members, who is the current leader, etc.
- Ability to force removal of a participant or leader from the cluster
- Ability to force publish metaLS (if current node is publisher)
- Ability to exclude hashes from metaLS (if current node is publisher)
- Configuration import/export functionality for bulk deployments



## Router Interface

TBD, possibly a separate proposal.
i2pcontrol is not required for the first release and detailed changes will be included in a separate proposal.

Requirements for Garlic Farm to router API (in-JVM java or i2pcontrol)

- getLocalRouterStatus()
- getLocalLeafHash(Hash masterHash)
- getLocalLeafStatus(Hash leaf)
- getRemoteMeasuredStatus(Hash masterOrLeaf) // probably not in MVP
- publishMetaLS(Hash masterHash, List&lt;MetaLease&gt; contents) // or signed MetaLeaseSet? Who signs?
- stopPublishingMetaLS(Hash masterHash)
- authentication TBD?


## Justification

Atomix is too large and won&#39;t allow customization for us to route
the protocol over I2P. Also, its wire format is undocumented, and depends
on Java serialization.


## Notes



## Issues

- There&#39;s no way for a client to find out about and connect to an unknown leader.
  It would be a minor change for a Follower to send the Configuration as a Log Entry in the AppendEntriesResponse.



## Migration

No backward compatibility issues.




## References

.. [JRAFT]
    https://github.com/datatechnology/jraft

.. [JSON]
    https://json.org/

.. [RAFT]
    https://ramcloud.stanford.edu/wiki/download/attachments/11370504/raft.pdf

.. [RFC-2616]
    https://tools.ietf.org/html/rfc2616

.. [RFC-2617]
    https://tools.ietf.org/html/rfc2617

.. [WEBSOCKET]
    https://en.wikipedia.org/wiki/WebSocket
</code></pre>
        </article>

        
        <nav class="page-nav">
            <a href="../../../en/proposals/" class="page-nav-link">
                ‚Üê Back to Proposals
            </a>
            
            <a href="../../../proposals/150-garlic-farm-protocol.txt" class="page-nav-link" download>
                üìÑ Download Source (.txt)
            </a>
            
        </nav>
    </div>
</div>

<style>
.proposals-page {
    min-height: 100vh;
    padding: var(--spacing-xl) 0;
}

.breadcrumbs {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    margin-bottom: var(--spacing-lg);
    font-size: 0.875rem;
    color: var(--color-text-muted);
}

.breadcrumbs a {
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
}

.breadcrumbs a:hover {
    color: var(--color-primary);
}

.separator {
    color: var(--color-border);
}

.current {
    color: var(--color-text);
}

 
.proposal-header {
    margin-bottom: var(--spacing-2xl);
}

.proposal-title-section {
    margin-bottom: var(--spacing-lg);
}

.proposal-title {
    font-size: 2.5rem;
    margin: 0 0 var(--spacing-sm) 0;
    color: var(--color-text);
}

.proposal-number {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
}

 
.proposal-meta-box {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
}

.proposal-status {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-md);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

 
.status-open {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-open {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-accepted {
    background: #dbeafe;
    color: #0369a1;
}

.dark .status-accepted {
    background: #0c4a6e;
    color: #7dd3fc;
}

.status-finished {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-finished {
    background: #164e63;
    color: #86efac;
}

.status-closed {
    background: #dcfce7;
    color: #15803d;
}

.dark .status-closed {
    background: #164e63;
    color: #86efac;
}

.status-rejected {
    background: #fee2e2;
    color: #991b1b;
}

.dark .status-rejected {
    background: #7f1d1d;
    color: #fca5a5;
}

.status-draft,
.status-needs-revision,
.status-dead,
.status-needs-research {
    background: #fef3c7;
    color: #92400e;
}

.dark .status-draft,
.dark .status-needs-revision,
.dark .status-dead,
.dark .status-needs-research {
    background: #78350f;
    color: #fde047;
}

.status-meta,
.status-informational,
.status-reserve {
    background: #e9d5ff;
    color: #6b21a8;
}

.dark .status-meta,
.dark .status-informational,
.dark .status-reserve {
    background: #581c87;
    color: #e879f9;
}

 
.proposal-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.info-label {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
}

.info-value {
    font-size: 0.9375rem;
    color: var(--color-text);
    font-weight: 500;
}

 
.proposal-relationships {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-md);
}

.relationship {
    display: flex;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-sm);
}

.relationship:last-child {
    margin-bottom: 0;
}

.relationship-label {
    font-weight: 600;
    color: var(--color-text-muted);
    min-width: 120px;
}

.relationship-value {
    color: var(--color-text);
}

 
.proposal-content {
    line-height: 1.8;
    color: var(--color-text);
    max-width: 900px;
    margin: var(--spacing-2xl) 0;
}

.proposal-content h2 {
    margin-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-md);
    font-size: 1.75rem;
}

.proposal-content h3 {
    margin-top: var(--spacing-xl);
    margin-bottom: var(--spacing-sm);
    font-size: 1.375rem;
}

.proposal-content h4 {
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-xs);
    font-size: 1.125rem;
}

.proposal-content p {
    margin-bottom: var(--spacing-md);
}

.proposal-content ul,
.proposal-content ol {
    margin-bottom: var(--spacing-md);
    padding-left: var(--spacing-xl);
}

.proposal-content li {
    margin-bottom: var(--spacing-xs);
}

.proposal-content code {
    background: var(--color-bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    font-family: 'Courier New', monospace;
}

.proposal-content pre {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    margin-bottom: var(--spacing-md);
    font-size: 0.875rem;
}

.proposal-content pre code {
    background: none;
    padding: 0;
}

.proposal-content blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-md);
    margin-left: 0;
    margin-bottom: var(--spacing-md);
    font-style: italic;
    color: var(--color-text-secondary);
}

.proposal-content a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color var(--transition-fast);
}

.proposal-content a:hover {
    border-bottom-color: var(--color-primary);
}

.proposal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--spacing-md);
}

.proposal-content table th {
    background: var(--color-bg-secondary);
    padding: var(--spacing-sm);
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--color-border);
}

.proposal-content table td {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--color-border);
}

.proposal-content img {
    max-width: 100%;
    height: auto;
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    margin: var(--spacing-lg) 0;
    display: block;
}

 
.page-nav {
    margin-top: var(--spacing-2xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid var(--color-border);
}

.page-nav-link {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text);
    text-decoration: none;
    transition: all var(--transition-fast);
}

.page-nav-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

 
@media (max-width: 768px) {
    .proposal-title {
        font-size: 1.75rem;
    }

    .proposal-info-grid {
        grid-template-columns: 1fr;
    }
}
</style>


    </main>

    <footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div class="footer-col footer-brand">
                <img src="../../../images/i2plogo_lightmode.svg" alt="I2P Logo" class="footer-logo logo-light">
                <img src="../../../images/i2plogo_darkmode.svg" alt="I2P Logo" class="footer-logo logo-dark">
                <p class="footer-tagline">Privacy. Security. Freedom.</p>
                <p class="footer-description">The Invisible Internet Project - A privacy-focused, anonymous network layer</p>

                <div class="footer-social-newsletter">
                    <div class="social-links">
                        <a href="https://mastodon.social/@i2p" target="_blank" rel="noopener" aria-label="Mastodon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z"/>
                            </svg>
                        </a>
                        <a href="https://twitter.com/GetI2P" target="_blank" rel="noopener" aria-label="Twitter">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://old.reddit.com/r/i2p" target="_blank" rel="noopener" aria-label="Reddit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                            </svg>
                        </a>
                        <a href="https://signal.group/#CjQKIOSUTtxlhbumAKcRsthPFkxkTUrkWcX39bbN6njLEgAIEhCTNsR0KDuiehAXZnkt42v5" target="_blank" rel="noopener" aria-label="Signal" class="signal-link">
                            <img src="../../../images/Signal-Logo-Black.svg" alt="Signal" class="signal-logo signal-logo-light">
                            <img src="../../../images/Signal-Logo-White.svg" alt="Signal" class="signal-logo signal-logo-dark">
                        </a>
                    </div>

                    
                    <div class="footer-newsletter-inline">
                        <p class="newsletter-description">Stay updated with I2P news:</p>
                        <div id="mailing-list-widget"
                             data-api-url="https://feedback.stormycloud.org"
                             data-button-text="Subscribe"
                             data-placeholder="Enter your email">
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer-col">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="../../../en/financial-support/">Donate</a></li>
                    <li><a href="../../../en/docs/overview/intro/">I2P Introduction</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Community</h3>
                <ul>
                    <li><a href="../../../en/get-involved/">Get Involved</a></li>
                    <li><a href="../../../en/blog/">Blog</a></li>
                    <li><a href="http://i2pforum.net/" target="_blank" rel="noopener">Official Forums</a></li>
                    <li><a href="../../../en/contact/">Contact</a></li>
                </ul>
            </div>

            <div class="footer-col">
                <h3>Resources</h3>
                <ul>
                    <li><a href="https://i2p-metrics.np-tokumei.net/" target="_blank" rel="noopener">I2P Metrics</a></li>
                    <li><a href="../../../en/papers/">Research</a></li>
                    <li><a href="https://i2pgit.org/" target="_blank" rel="noopener">GitLab</a></li>
                    <li><a href="https://www.stormycloud.org/" target="_blank" rel="noopener">StormyCloud</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p class="copyright">&copy; 2025 The Invisible Internet Project. Licensed under Creative Commons.</p>
            <div class="footer-links">
                <a href="../../../en/privacy/">Privacy</a>
                <a href="../../../en/terms/">Terms</a>
                <a href="../../../en/impressum/">Impressum</a>
                <a href="../../../en/about/media/">Press</a>
            </div>
        </div>
    </div>
</footer>


    
    
    
        
        <script src="../../../js/main.min.js"></script>
    

    
    <script src="https://feedback.stormycloud.org/widgets/mailing-list.js"></script>

    
    <script src="https://feedback.stormycloud.org/widgets/features.js"></script>

    
</body>
</html>
